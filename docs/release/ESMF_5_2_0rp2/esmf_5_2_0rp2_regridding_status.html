<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">


<HTML>
<HEAD>
<meta name="description" content="ESMF Project NCAR">
<TITLE>Regridding Status</TITLE>
<link rel=stylesheet type="text/css" href="/esmf.css">

<!--#include virtual="/header.shtml"-->
<!--#include virtual="/esmf_releases/last/side_nav.html"-->
<div class="main">

<STYLE TYPE="text/css">

td.supported{background-color:green;}
td.mantested{background-color:lime;}
td.untested{background-color:yellow;}
td.unsupported{background-color:red;}

/* this is the regridding table structure */
table.special_regrid{
border-collapse:   collapse;
border-style:      solid;
border-width:      1px;
margin-bottom:     20px;
margin-left:       10px;
padding:           20px;
width:             70%;
}
table.special_regrid tr td{
border-style:      solid;
border-width:      1px;
padding:           5px;
margin-right:      auto;
vertical-align:    top;
}
table.special_regrid th{
border-style:      solid;
padding:           3px;
text-align:        left;
vertical-align:    top;
background:        #F7FFCE;
font-weight:       bold;
}

/*this is the supported grids table structure */
table.special_grids{
border-collapse:   collapse;
border-style:      solid;
border-width:      1px;
margin-bottom:     20px;
margin-left:       10px;
padding:           20px;
width:             720px;
}
table.special_grids td{
border-style:      solid;
border-width:      1px;
vertical-align:    center;
text-align:        center;
padding:           0px;
}
table.special_grids tr{
border-style:      solid;
border-width:      1px;
vertical-align:    center;
text-align:        center;
padding:           0px;
}

td.srccell{width: 120px;vertical-align:center;}
td.dstcell{height: 30px;vertical-align:center;}
td.gridcell{width: 120px;height: 30px;vertical-align:center;}
td.imgcell{width: 240px;height: 60px;vertical-align:center;}


</STYLE>

<h1>ESMF_5_2_0rp1/rp2 regridding: features, grids, and numerical results</h1>

<p>
This page describes the regridding functionality provided by ESMF.  
Regridding, also called remapping or interpolation, is the process of changing the grid that underlies data values while preserving qualities of the original data.  
Different kinds of transformations are appropriate for different problems.  
Regridding may be needed when communicating data between Earth system model components such as land and atmosphere, or between different data sets to support operations such as visualization.
</p>

<p>
Regridding can be broken into two stages.  The first stage is generation of an interpolation weight matrix that describes how points in the source grid contribute to points in the destination grid.  The second stage is the multiplication of values on the source grid by the interpolation weight matrix to produce values on the destination grid.  This occurs through a parallel sparse matrix multiply.
</p>

<p>
There are two options for accessing ESMF regridding functionality: integrated and offline. Integrated regridding means that interpolation weights are generated via subroutine calls during the execution of the user's code.  The integrated regridding can also perform the sparse matrix multiply.  Offline regridding means that interpolation weights are generated by a separate ESMF application, not within the user code.  Offline interpolation weight generation is provided by the <a href="http://www.earthsystemmodeling.org/esmf_releases/public/ESMF_5_2_0rp1/ESMF_refdoc/node3.html#SECTION03020000000000000000">ESMF_RegridWeightGen application</a>, which internally uses the integrated ESMF regridding.
</p>


<p>
The tables on this page show the capabilities supported by ESMF regridding.  The first tables show the level of regridding support for a variety of source and destination grids.  The integrated regridding can currently support both Cartesian and spherical coordinate systems, while the offline regridding supports only spherical coordinates.  More details on specific features and numerical results are provided below that, along with references.
</p>

<h2>Legend</h2>

<table border="1" style="text-align:left;">
<tr>
<td class="supported" width=20px></td>
<td>Supported (completely and automatically tested)</td>
</tr>

<tr>
<td class="mantested"></td>
<td>Supported (partially and/or manually tested)</td>
</tr>

<tr>
<td class="untested"></td>
<td>Should work, but not yet tested</td>
</tr>

<tr>
<td class="unsupported"></td>
<td>Not supported</td>
</tr>

</table>

<h2>Supported grids in the integrated regridding</h2>

<p>
2D meshes with elements that can be represented by combinations of triangles or quadrilaterals are supported.  
Cubed sphere grids are supported as an ESMF Mesh.  
Two coordinate systems are currently supported in the integrated regridding, Cartesian and spherical.  
These tables cover testing of generating and applying interpolation weights.
</p>

<h3>Cartesian</h3>

<table class="special_grids">
<tr>

<td class="imgcell" colspan="2" rowspan="2"><img class="nopadding" src="/images/source_dest2.png"></img></td>
<!--
<td colspan="2" rowspan="2" style="border-style:none solid solid none;"></td>
-->
<td class="dstcell" colspan="2">2D regional grids</td>
<td class="dstcell" colspan="2">3D regional grids</td>
</tr>

<tr>
<td class="gridcell">Logically rectangular</td>
<td class="gridcell">Mesh</td>
<td class="gridcell">Logically rectangular</td>
<td class="gridcell">Mesh</td>
</tr>

<tr>
<td class="srccell" rowspan="2">2D regional grids</td>
<td class="gridcell">Logically rectangular</td>
<td class="supported"></td>
<td class="supported"></td>
<td class="unsupported"></td>
<td class="unsupported"></td>
</tr>

<td class="gridcell">Mesh</td>
<td class="supported"></td>
<td class="supported"></td>
<td class="unsupported"></td>
<td class="unsupported"></td>
</tr>

<tr>
<td class="srccell" rowspan="2">3D regional grids</td>
<td class="gridcell">Logically rectangular</td>
<td class="unsupported"></td>
<td class="unsupported"></td>
<td class="supported"></td>
<td class="mantested"></td>
</tr>

<td class="gridcell">Mesh</td>
<td class="unsupported"></td>
<td class="unsupported"></td>
<td class="supported"></td>
<td class="mantested"></td>
</tr>

</td>
</table>

<br>

<h3>Spherical</h3>

<table class="special_grids">
<tr>

<td class="imgcell" colspan="2" rowspan="2"><img class="nopadding" src="/images/source_dest2.png"></img></td>
<!--
<td colspan="2" rowspan="2" style="border-style:none solid solid none;"></td>
-->
<td class="dstcell" colspan="2">2D global grids</td>
<td class="dstcell" colspan="2">2D regional grids</td>
</tr>

<tr>
<td class="gridcell">Logically rectangular</td>
<td class="gridcell">Mesh</td>
<td class="gridcell">Logically rectangular</td>
<td class="gridcell">Mesh</td>
</tr>


<tr>
<td class="srccell" rowspan="2">2D global grids</td>
<td class="gridcell">Logically rectangular</td>
<td class="supported"></td>
<td class="mantested"></td>
<td class="mantested"></td>
<td class="mantested"></td>
</tr>

<td class="gridcell">Mesh</td>
<td class="mantested"></td>
<td class="mantested"></td>
<td class="mantested"></td>
<td class="mantested"></td>
</tr>

<tr>
<td class="srccell" rowspan="2">2D regional grids</td>
<td class="gridcell">Logically rectangular</td>
<td class="mantested"></td>
<td class="mantested"></td>
<td class="mantested"></td>
<td class="mantested"></td>
</tr>

<td class="gridcell">Mesh</td>
<td class="mantested"></td>
<td class="mantested"></td>
<td class="mantested"></td>
<td class="mantested"></td>
</tr>

</td>
</table>

<br>

<h2>Supported grids in the offline regridding</h2>

<p>
2D meshes with elements that can be represented by combinations of triangles or quadrilaterals are supported.  
This includes meshes with elements that are pentagons, hexagons, and other polygons.  
The user does not have to decompose their elements into triangles and quadrilaterals since ESMF does it for them internally. 
Cubed sphere grids are supported as an ESMF Mesh.  
The offline regridding is currently restricted to spherical coordinate systems.  
This table covers testing of generating interpolation weights.
</p>

<h3>Spherical</h3>

<table class="special_grids">
<tr>

<td class="imgcell" colspan="2" rowspan="2"><img class="nopadding" src="/images/source_dest2.png"></img></td>
<!--
<td colspan="2" rowspan="2" style="border-style:none solid solid none;"></td>
-->
<td class="dstcell" colspan="2">2D global grids</td>
<td class="dstcell" colspan="2">2D regional grids</td>
</tr>

<tr>
<td class="gridcell">Logically rectangular</td>
<td class="gridcell">Mesh</td>
<td class="gridcell">Logically rectangular</td>
<td class="gridcell">Mesh</td>
</tr>


<tr>
<td class="srccell" rowspan="2">2D global grids</td>
<td class="gridcell">Logically rectangular</td>
<td class="supported"></td>
<td class="supported"></td>
<td class="supported"></td>
<td class="mantested"></td>
</tr>

<td class="gridcell">Mesh</td>
<td class="supported"></td>
<td class="supported"></td>
<td class="supported"></td>
<td class="mantested"></td>
</tr>

<tr>
<td class="srccell" rowspan="2">2D regional grids</td>
<td class="gridcell">Logically rectangular</td>
<td class="supported"></td>
<td class="supported"></td>
<td class="supported"></td>
<td class="mantested"></td>
</tr>

<td class="gridcell">Mesh</td>
<td class="mantested"></td>
<td class="mantested"></td>
<td class="mantested"></td>
<td class="mantested"></td>
</tr>

</td>
</table>

<h2>
Capabilities of ESMF regridding
</h2>

<p>
There are
several different capabilities available in each of these applications.  The following
symbols and keywords are used:
</p>
<b>Bilinear</b> - Linear interpolation in 2 or 3 dimensions. [1] <br>
<br>
<b>Patch</b> - Patch rendezvous method of taking the least squares fit of the surrounding surface patches. [2,3] <br>
<br>
<b>Conservative</b> - First order area averaged conservation is based on the ratio of source cell area overlapped with the corresponding destination cell area.<br>
<br>
<b>Destination masking</b> - Allow some points (usually representative of land masses) of the destination grid to not be included in the interpolation.<br>
<br>
<b>Source masking</b> - Allow some points of the source grid to not be included in the interpolation.<br>
<br>
<b>Ignore unmapped points</b> - ESMF option to ignore points which lie outside of the interpolation space instead of issuing an error.<br>
<br>
<b>Full circle average</b> - ESMF option to use all of the latitude points directly surrounding a pole to calculate an artificial pole value.<br>
<br>
<b>N-point average</b> - ESMF option for a user to specify the number of points of the latitude line directly surrounding a pole to calculate an artificial pole value.  This option is useful when the full circle average may yield a zero valued vector field. <br>
<br>
<b>No pole</b> - ESMF option to not use a pole value at all, the grid ends at the top and bottom rows of latitude points that are given.<br>
<br>
<br>

<h3>Integrated regridding capabilities</h3>

<table  class="special_regrid">
<tr>
<th width="150">Capabilities</th>
<th width="150">Description</th>
<th width="85" align="center">Bilinear</th>
<th width="85" align="center">Patch</th>
<th width="85" align="center">Conservative</th>
</tr>

<tr>
<td>Regridding</td>
<td></td>
<td class="supported"></td>
<td class="supported"></td>
<td class="supported"></td>
</tr>

<tr>
<td rowspan="3">Masking<br>(Logically rectangular grids only)</td>
<td>Destination</td>
<td class="supported"></td>
<td class="supported"></td>
<td class="supported"></td>
</tr>

<td>Source</td>
<td class="supported"></td>
<td class="supported"></td>
<td class="supported"></td>
</tr>

<td>Ignore unmapped points</td>
<td class="supported"></td>
<td class="supported"></td>
<td class="supported"></td>
</tr>

<tr>
<td rowspan="3">Pole options</td>
<td>Full circle average</td>
<td class="supported"></td>
<td class="supported"></td>
<td>N/A</td>
</tr>

<tr>
<td>N-point average</td>
<td class="supported"></td>
<td class="mantested"></td>
<td>N/A</td>
</tr>

<tr>
<td>No pole</td>
<td class="supported"></td>
<td class="mantested"></td>
<td class="supported"></td>
</tr>

</td>
</table>

<h3>Offline regridding capabilities</h3>

<table  class="special_regrid">
<tr>
<th width="150">Capabilities</th>
<th width="150">Description</th>
<th width="85" align="center">Bilinear</th>
<th width="85" align="center">Patch</th>
<th width="85" align="center">Conservative</th>
</tr>

<tr>
<td>Regridding</td>
<td></td>
<td class="supported"></td>
<td class="supported"></td>
<td class="supported"></td>
</tr>

<tr>
<td rowspan="3">Masking<br>(Logically rectangular grids only)</td>
<td>Destination</td>
<td class="supported"></td>
<td class="supported"></td>
<td class="supported"></td>
</tr>

<td>Source</td>
<td class="supported"></td>
<td class="supported"></td>
<td class="supported"></td>
</tr>

<td>Ignore unmapped points</td>
<td class="supported"></td>
<td class="supported"></td>
<td class="supported"></td>
</tr>

<tr>
<td rowspan="3">Pole options</td>
<td>Full circle average</td>
<td class="supported"></td>
<td class="supported"></td>
<td>N/A</td>
</tr>

<tr>
<td>N-point average</td>
<td class="supported"></td>
<td class="supported"></td>
<td>N/A</td>
</tr>

<tr>
<td>No pole</td>
<td class="supported"></td>
<td class="supported"></td>
<td class="supported"></td>
</tr>

</td>
</table>

<br>

<h1>Numerical results of ESMF regridding</h1>

<p>
The following table presents some specific examples of numerical results
of the ESMF regridding capabilities.  The numerical test cases that were evaluated
for this table were computed using global grids.  
The results were collected from the 
<a href="/users/code_examples/external_demos/ESMF_RegridWeightGenCheck_ed.shtml">ESMF_RegridWeightGenCheck external demo</a>.
All of the results in this table were generated by regridding a second order
spherical harmonic-like field F = 2 + cos^2(theta)*cos(2*phi).
</p>

<br>
<br>

<table  class="special" style="width:785" >
<tr>
<th>Methods</th>
<th>Grids<br/>[source <b>to</b> destination]</th>
<th>Largest negative weight</th>
<th>Interpolation average error</th>
<th>Conservation relative error</th>
<th>Notes</th>
</tr>

<tr>
<td rowspan="2">Bilinear</td>
<td align=center>Lat-lon 1 degree<br/>to<br/>Lat-lon 2.5 degree</td>
<td>-5.99e-15</td>
<td>3.00e-05</td>
<td>N/A</td>
<td>This test was done with no masking and the full circle average pole option. </td>
</tr>

<tr>
<td align=center>Cubed sphere grid (ne30np4-t2.nc)<br/>to<br/>Lat-lon 1.9x2.5 degree (fv1.9x2.5_050503.nc)</td>
<td>0</td>
<td>4.11e-05</td>
<td>N/A</td>
<td></td>
</tr>

<tr>
<td rowspan="2">Patch</td>
<td align=center>Lat-lon 1 degree<br/>to<br/>Lat-lon 2.5 degree</td>
<td>-6.20e-02</td>
<td>2.92e-05</td>
<td>N/A</td>
<td>This test was done with no masking and the full circle average pole option.</td>
</tr>

<tr>
<td align=center>Cubed sphere grid (ne30np4-t2.nc)<br/>to<br/>Lat-lon 1.9x2.5 degree (fv1.9x2.5_050503.nc)</td>
<td>-6.40e-02</td>
<td>3.52e-05</td>
<td>N/A</td>
<td></td>
</tr>

<tr>
<td rowspan="2">Conservative</td>
<td align=center>Lat-lon 1 degree<br/>to<br/>Lat-lon 2.5 degree</td>
<td>0</td>
<td>2.47e-04</td>
<td>3.34e-13</td>
<td>This test was done with no masking and the no pole option.</td>
</tr>

<tr>
<td align=center>Cubed sphere grid (ne30np4-t2.nc)<br/>to<br/>Lat-lon 1.9x2.5 degree (fv1.9x2.5_050503.nc)</td>
<td>0</td>
<td>3.76e-04</td>
<td>2.59e-13</td>
<td></td>
</tr>

</td>

</table>

<h2>
References
</h2>
<b>[1]</b>  W.H. Press, S.A. Teukolsky, W.T. Vetterling, B.P. Flannery. <br>
Numerical Recipes in C - The Art of Scientific Computing, Second Edition, pp. 123-128. <br>
New York, Cambridge University Press, 1999. <br>
<br>
<b>[2]</b>  Khoei S.A. Gharehbaghi A, R. <br>
The superconvergent patch recovery technique and data transfer operators in 3d plasticity problems. <br>
Finite Elements in Analysis and Design, 43(8), 2007. <br>
<br>
<b>[3]</b>  K.C. Hung, H. Gu, Z. Zong. <br>
A modified superconvergent patch recovery method and its application to large deformation problems. <br>
Finite Elements in Analysis and Design, 40(5-6), 2004. <br>
<br>
<!--<b>[4]</b>  J.F. Remacle, J.E. Flaherty, M.S. Shepard. <br>
An adaptive discontinuous galerkin technique with an orthogonal basis applied to compressible flow problems. <br>
SIAM Review, 45(1), 2003. <br>
<br>
<b>[5]</b>  Z. Zhang. <br>
Moving Mesh Method with Conservative Interpolation Based on L2-Projection. <br>
Communications in Computational Physics, 1(5), 2006.<br>
<br>-->

</div>
<!--#include virtual="/footer.html"-->


</body>
</html>
