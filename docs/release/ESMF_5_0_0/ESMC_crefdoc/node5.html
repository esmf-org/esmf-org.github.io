<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002 (1.67)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>4 Infrastructure: Utilities</TITLE>
<META NAME="description" CONTENT="4 Infrastructure: Utilities">
<META NAME="keywords" CONTENT="ESMC_crefdoc">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="LaTeX2HTML v2002">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="ESMC_crefdoc.css">

<LINK REL="next" HREF="node6.html">
<LINK REL="previous" HREF="node4.html">
<LINK REL="up" HREF="ESMC_crefdoc.html">
<LINK REL="next" HREF="node6.html">
</HEAD>

<BODY BGCOLOR=white LINK=#083194 VLINK=#21004A>
<!--Navigation Panel-->
<A NAME="tex2html354"
  HREF="node6.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html350"
  HREF="ESMC_crefdoc.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html344"
  HREF="node4.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html352"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html355"
  HREF="node6.html">Bibliography</A>
<B> Up:</B> <A NAME="tex2html351"
  HREF="ESMC_crefdoc.html">ESMC_crefdoc</A>
<B> Previous:</B> <A NAME="tex2html345"
  HREF="node4.html">3 Infrastructure: Fields and</A>
 &nbsp <B>  <A NAME="tex2html353"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><UL>
<LI><A NAME="tex2html356"
  HREF="node5.html#SECTION05010000000000000000">16 Overview of Infrastructure Utility Classes</A>
<LI><A NAME="tex2html357"
  HREF="node5.html#SECTION05020000000000000000">17 Time Manager Utility</A>
<UL>
<LI><A NAME="tex2html358"
  HREF="node5.html#SECTION05021000000000000000">17.1 Time Manager Classes</A>
<LI><A NAME="tex2html359"
  HREF="node5.html#SECTION05022000000000000000">17.2 Calendar</A>
<LI><A NAME="tex2html360"
  HREF="node5.html#SECTION05023000000000000000">17.3 Time Instants and TimeIntervals</A>
<LI><A NAME="tex2html361"
  HREF="node5.html#SECTION05024000000000000000">17.4 Clocks and Alarms</A>
</UL>
<LI><A NAME="tex2html362"
  HREF="node5.html#SECTION05030000000000000000">18 Calendar Class</A>
<UL>
<LI><A NAME="tex2html363"
  HREF="node5.html#SECTION05031000000000000000">18.1 Description</A>
<LI><A NAME="tex2html364"
  HREF="node5.html#SECTION05032000000000000000">18.2 Class API</A>
<UL>
<LI><A NAME="tex2html365"
  HREF="node5.html#SECTION05032100000000000000">18.2.1 ESMC_CalendarCreate</A>
<LI><A NAME="tex2html366"
  HREF="node5.html#SECTION05032200000000000000">18.2.2 ESMC_CalendarDestroy</A>
<LI><A NAME="tex2html367"
  HREF="node5.html#SECTION05032300000000000000">18.2.3 ESMC_CalendarPrint</A>
</UL>
</UL>
<LI><A NAME="tex2html368"
  HREF="node5.html#SECTION05040000000000000000">19 Time Class</A>
<UL>
<LI><A NAME="tex2html369"
  HREF="node5.html#SECTION05041000000000000000">19.1 Description</A>
<LI><A NAME="tex2html370"
  HREF="node5.html#SECTION05042000000000000000">19.2 Class API</A>
<LI><A NAME="tex2html371"
  HREF="node5.html#SECTION05043000000000000000">19.3 C++:  Class Interface ESMC_Time - Public C interface to the ESMF Time class (Source File: ESMC_Time.h)</A>
</UL>
<LI><A NAME="tex2html372"
  HREF="node5.html#SECTION05050000000000000000">20 TimeInterval Class</A>
<UL>
<LI><A NAME="tex2html373"
  HREF="node5.html#SECTION05051000000000000000">20.1 Description</A>
<LI><A NAME="tex2html374"
  HREF="node5.html#SECTION05052000000000000000">20.2 Class API</A>
<LI><A NAME="tex2html375"
  HREF="node5.html#SECTION05053000000000000000">20.3 C++:  Class Interface ESMC_TimeInterval - Public C interface to the ESMF TimeInterval class (Source File: ESMC_TimeInterval.h)</A>
</UL>
<LI><A NAME="tex2html376"
  HREF="node5.html#SECTION05060000000000000000">21 Clock Class</A>
<UL>
<LI><A NAME="tex2html377"
  HREF="node5.html#SECTION05061000000000000000">21.1 Description</A>
<LI><A NAME="tex2html378"
  HREF="node5.html#SECTION05062000000000000000">21.2 Class API</A>
<LI><A NAME="tex2html379"
  HREF="node5.html#SECTION05063000000000000000">21.3 C++:  Class Interface ESMC_Clock - Public C interface to the ESMF Clock class (Source File: ESMC_Clock.h)</A>
</UL>
<LI><A NAME="tex2html380"
  HREF="node5.html#SECTION05070000000000000000">22 Alarm Class</A>
<UL>
<LI><A NAME="tex2html381"
  HREF="node5.html#SECTION05071000000000000000">22.1 Description</A>
<LI><A NAME="tex2html382"
  HREF="node5.html#SECTION05072000000000000000">22.2 Class API</A>
</UL>
<LI><A NAME="tex2html383"
  HREF="node5.html#SECTION05080000000000000000">23 Config Class</A>
<UL>
<LI><A NAME="tex2html384"
  HREF="node5.html#SECTION05081000000000000000">23.1 Description</A>
<UL>
<LI><A NAME="tex2html385"
  HREF="node5.html#SECTION05081100000000000000">23.1.1 Package History</A>
</UL>
<LI><A NAME="tex2html386"
  HREF="node5.html#SECTION05082000000000000000">23.2 Class API</A>
<LI><A NAME="tex2html387"
  HREF="node5.html#SECTION05083000000000000000">23.3 C++:  Class Interface ESMC_Config - C++ interface to the F90 Config object (Source File: ESMC_Config.h)</A>
</UL>
<LI><A NAME="tex2html388"
  HREF="node5.html#SECTION05090000000000000000">24 LogErr Class</A>
<UL>
<LI><A NAME="tex2html389"
  HREF="node5.html#SECTION05091000000000000000">24.1 Description</A>
<LI><A NAME="tex2html390"
  HREF="node5.html#SECTION05092000000000000000">24.2 Class API</A>
<LI><A NAME="tex2html391"
  HREF="node5.html#SECTION05093000000000000000">24.3 C++:  Class Interface ESMC_LogErr - Public C interface to the ESMF LogErr class (Source File: ESMC_LogErr.h)</A>
</UL>
<LI><A NAME="tex2html392"
  HREF="node5.html#SECTION050100000000000000000">25 DELayout Class</A>
<UL>
<LI><A NAME="tex2html393"
  HREF="node5.html#SECTION050101000000000000000">25.1 Description</A>
<LI><A NAME="tex2html394"
  HREF="node5.html#SECTION050102000000000000000">25.2 Class API</A>
</UL>
<LI><A NAME="tex2html395"
  HREF="node5.html#SECTION050110000000000000000">26 VM Class</A>
<UL>
<LI><A NAME="tex2html396"
  HREF="node5.html#SECTION050111000000000000000">26.1 Description</A>
<LI><A NAME="tex2html397"
  HREF="node5.html#SECTION050112000000000000000">26.2 Class API</A>
<LI><A NAME="tex2html398"
  HREF="node5.html#SECTION050113000000000000000">26.3 C++:  Class Interface ESMC_VM - Public C interface to the ESMF VM class (Source File: ESMC_VM.h)</A>
</UL>
<LI><A NAME="tex2html399"
  HREF="node5.html#SECTION050120000000000000000">27 References</A>
</UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION05000000000000000000">
4 Infrastructure:  Utilities</A>
</H1>

<P>

<P>

<P>

<H1><A NAME="SECTION05010000000000000000">
16 Overview of Infrastructure Utility Classes</A>
</H1>

<P>
The ESMF utilities are
a set of tools for quickly assembling modeling applications.
The Time Management Library
provides utilities for time and date representation and calculation,
and higher-level utilities that control model time stepping and alarming.

<P>
The Array class offers an efficient, language-neutral way 
of storing and manipulating data arrays.

<P>
The Communications/Memory/Kernel library provides utilities for isolating system-dependent functions to ease
platform portability.  It provides services to represent a particular machine's
characteristics and to organize these into processor lists and layouts to
allow for optimal allocation of resources to an ESMF component. Also provided
is a unified interface for system-dependent communication services such as
MPI or pthreads. 

<P>
ESMF Configuration Management is based on NASA DAO's Inpak package, a collection of routines for accessing files containing
input parameters stored in an ASCII format.

<P>

<P>

<P>

<H1><A NAME="SECTION05020000000000000000">
17 Time Manager Utility</A>
</H1>
  
<P>
The ESMF Time Manager utility includes software for time and date 
representation and calculations, model time advancement, and the 
identification of unique and periodic events.  Since multi-component 
geophysical applications often require synchronization across
the time management schemes of the individual components, the 
Time Manager's standard calendars and consistent time representation 
promote component interoperability.
<DIV ALIGN="CENTER">
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=432>
<BR>
<B>Key Features</B></TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=432>Drift-free timekeeping through an integer-based internal time 
representation.  Both integers and reals can be specified at the interface.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=432>The ability to represent time as a rational fraction, to support 
exact timekeeping in applications that involve grid refinement.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=432>Support for many calendar types, including user-customized calendars.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=432>Support for both concurrent and sequential modes of component execution.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=432>Support for varying and negative time steps.</TD>
</TR>
</TABLE>
</DIV>

<P>

<H2><A NAME="SECTION05021000000000000000">
17.1 Time Manager Classes</A>
</H2>
There are five ESMF classes that represent time concepts:

<UL>
<LI><B>Calendar</B>  A Calendar can be used to keep track of the 
date as an ESMF Gridded Component advances in time. Standard calendars 
(such as Gregorian and 360-day) and user-specified calendars are 
supported.  Calendars can be queried for quantities such as seconds 
per day, days per month, and days per year.  
</LI>
<LI><B>Time</B> A Time represents a time instant in a particular
calendar, such as November 28, 1964, at 7:31pm EST in the Gregorian 
calendar.  The Time class can be used 
to represent the start and stop time of a time integration.
</LI>
<LI><B>TimeInterval</B> TimeIntervals represent a period 
of time, such as 300 milliseconds.  Time steps can be represented 
using TimeIntervals.  
</LI>
<LI><B>Clock</B> Clocks collect the parameters and 
methods used for model time advancement into a convenient 
package.  A Clock can be queried for quantities such
as start time, stop time, current time, and time step.  Clock
methods include incrementing the current time, and determining
if it is time to stop.  
</LI>
<LI><B>Alarm</B> Alarms identify unique or periodic events
by ``ringing'' - returning a true value - at specified times.  
For example, an Alarm might be set to ring on the day of the 
year when leaves start falling from the trees in a climate model.
</LI>
</UL>

<P>
<DIV ALIGN="CENTER">
<IMG
 WIDTH="749" HEIGHT="215" ALIGN="BOTTOM" BORDER="0"
 SRC="img11.png"
 ALT="\includegraphics[]{TimeMgr_desc}">

</DIV>

<P>
In the remainder of this section, we briefly summarize the 
functionality that the Time Manager classes provide.  Detailed 
descriptions and usage examples precede the API listing for each 
class.

<P>

<H2><A NAME="SECTION05022000000000000000">
17.2 Calendar</A>
</H2>
An ESMF Calendar can be queried for seconds per day, days per month 
and days per year.  The flexible definition of Calendars allows them
to be defined for planetary bodies other than Earth.  The set of supported 
calendars includes:
<DL>
<DT><STRONG>Gregorian</STRONG></DT>
<DD>The standard Gregorian calendar.
</DD>
<DT><STRONG>no-leap</STRONG></DT>
<DD>The Gregorian calendar with no leap years.
</DD>
<DT><STRONG>Julian</STRONG></DT>
<DD>The standard Julian date calendar.
</DD>
<DT><STRONG>Julian Day</STRONG></DT>
<DD>The standard Julian days calendar.
</DD>
<DT><STRONG>Modified Julian Day</STRONG></DT>
<DD>The Modified Julian days calendar.
</DD>
<DT><STRONG>360-day</STRONG></DT>
<DD>A 30-day-per-month, 12-month-per-year calendar.
</DD>
<DT><STRONG>no calendar</STRONG></DT>
<DD>Tracks only elapsed model time in hours, minutes, seconds.
</DD>
</DL>
See Section&nbsp;<A HREF="node5.html#sec:Calendar">18.1</A> for more details on supported standard 
calendars, and how to create a customized ESMF Calendar.

<P>

<H2><A NAME="SECTION05023000000000000000">
17.3 Time Instants and TimeIntervals</A>
</H2>

<P>
<A NAME="subsec:Time_Instants_and_TimeIntervals"></A>TimeIntervals and Time instants (simply called Times) are the computational 
building blocks of the Time Manager utility.  TimeIntervals support operations
such as add, subtract, compare size, reset value, copy value, and subdivide
by a scalar.  Times, which are moments in time associated with specific
Calendars, can be incremented or decremented by TimeIntervals, compared to
determine which of two Times is later, differenced to obtain the TimeInterval
between two Times, copied, reset, and manipulated in other useful ways.
Times support a host of different queries, both for values of individual Time 
components such as year, month, day, and second, and for derived values such 
as day of year, middle of current month and Julian day.  It is also possible 
to retrieve the value of the hardware realtime clock in the form of a 
Time.  See Sections&nbsp;<A HREF="node5.html#sec:Time">19.1</A> and&nbsp;<A HREF="node5.html#sec:TimeInterval">20.1</A>, respectively,
for use and examples of Times and TimeIntervals.

<P>
Since climate modeling, numerical weather prediction and other 
Earth and space applications have widely varying time scales and require 
different sorts of calendars, Times and TimeIntervals must support 
a wide range of time specifiers, spanning nanoseconds to years.  The
interfaces to these time classes are defined so that the user can specify a time
using a combination of units selected from the list shown in 
Table&nbsp;<A HREF="#table:timeOpts"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>.  

<P>

<H2><A NAME="SECTION05024000000000000000">
17.4 Clocks and Alarms</A>
</H2>
Although it is possible to repeatedly step a Time forward by a 
TimeInterval using arithmetic on these basic types, it is useful to 
identify a higher-level concept to represent this function.  We refer to 
this capability as a Clock, and include in its required features the 
ability to store the start and stop times of 
a model run, to check when time advancement should cease, 
and to query the value of quantities such as the current time and the
time at the previous time step.  The Time Manager includes a class 
with methods that return a true value when a periodic or unique event 
has taken place; we refer to these as Alarms.  Applications may contain 
temporary or multiple Clocks and Alarms.  Sections&nbsp;<A HREF="node5.html#sec:Clock">21.1</A> and
<A HREF="node5.html#sec:Alarm">22.1</A> describe the use of Clocks and Alarms in detail.

<P>

<P>

<H1><A NAME="SECTION05030000000000000000">
18 Calendar Class</A>
</H1>

<P>

<H2><A NAME="SECTION05031000000000000000">
18.1 Description</A>
</H2>

<P>
<A NAME="sec:Calendar"></A>The Calendar class represents the standard calendars used in 
geophysical modeling:  Gregorian, Julian, Julian Day, Modified Julian Day, 
no-leap, 360-day, and no-calendar.  It also supports a user-customized 
calendar.  Brief descriptions are provided for each calendar below.  For more 
information on standard calendars, see&nbsp;[] and&nbsp;[].

<P>

<H2><A NAME="SECTION05032000000000000000">
18.2 Class API</A>
</H2>

<P>

<P>

<P>

<H3><A NAME="SECTION05032100000000000000">
18.2.1 ESMC_CalendarCreate - Create a Calendar</A>
</H3>

<P>

<P><P>
<BR>
<I>INTERFACE:</I>
<PRE> ESMC_Calendar ESMC_CalendarCreate(const char *name,
                                   enum ESMC_CalendarType calendarType, int *rc);  
 
   ARGUMENTS :
   	char	name,		
  	enum ESMC_CalendarType calendarType,
  	int *rc
</PRE>
<I>DESCRIPTION:
<BR></I>

<P>
Create a Calendar of calendar type. 

<P>

<P>

<H3><A NAME="SECTION05032200000000000000">
18.2.2 ESMC_CalendarDestroy - Destroy a Calendar</A>
</H3>

<P>

<P><P>
<BR>
<I>INTERFACE:</I>
<PRE> int ESMC_CalendarDestroy(ESMC_Calendar *calendar);
 
   ARGUMENTS :
  	ESMC_Calendar *calendar
</PRE>
<I>DESCRIPTION:
<BR></I>

<P>
Destroy a Calendar. 

<P>

<P>

<H3><A NAME="SECTION05032300000000000000">
18.2.3 ESMC_CalendarPrint - Print a Calendar</A>
</H3>

<P>

<P><P>
<BR>
<I>INTERFACE:</I>
<PRE> int ESMC_CalendarPrint(ESMC_Calendar calendar);
 
   ARGUMENTS :
        ESMC_Calendar calendar
</PRE>
<I>DESCRIPTION:
<BR></I>

<P>
Print a Calendar.

<P>

<H1><A NAME="SECTION05040000000000000000">
19 Time Class</A>
</H1>

<P>

<H2><A NAME="SECTION05041000000000000000">
19.1 Description</A>
</H2>
<A NAME="sec:Time"></A>
<P>
A Time represents a specific point in time.  In order to accommodate
the range of time scales in Earth system applications, Times in
the ESMF an be specified in many different ways, from years to 
nanoseconds.  The Time interface is designed so that you select one or 
more options from a list of time units in order to specify a 
Time. The options for specifying a Time are shown in 
Table&nbsp;<A HREF="#table:timeOpts"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>.  

<P>
There are Time methods defined for setting and getting a
Time, incrementing and decrementing a Time by a TimeInterval,
taking the difference between two Times, and comparing Times.
Special quantities such as the middle of the month and the 
day of the year associated with a particular Time can be retrieved. 
There is a method for returning the Time value as a string in 
the ISO 8601 format YYYY-MM-DDThh:mm:ss [].

<P>
A Time that is specified in hours, minutes, seconds, or subsecond intervals 
does not need to be associated with a standard calendar; a Time whose
specification includes time units of a day and greater must be.  The 
ESMF representation
of a calendar, the Calendar class, is described in Section&nbsp;<A HREF="node5.html#sec:Calendar">18.1</A>.
The <TT>ESMF_TimeSet</TT> method is used to initialize a Time as well as
associate it with a Calendar.  If a Time method is invoked in which a Calendar
is necessary and one has not been set, the ESMF method will return an error
condition.

<P>
In the ESMF the TimeInterval class is used to represent time periods.
This class is frequently used in combination with the Time class.
The Clock class, for example, advances model time by incrementing a
Time with a TimeInterval. 

<P>

<P>

<H2><A NAME="SECTION05042000000000000000">
19.2 Class API</A>
</H2>

<P>

<P>

<P>

<H2><A NAME="SECTION05043000000000000000">
19.3 C++:  Class Interface ESMC_Time - Public C interface to the ESMF Time class (Source File: ESMC_Time.h)</A>
</H2>

<P>
The code in this file defines the public C Time interfaces and declares
   method signatures (prototypes).  The companion file <TT>ESMC_Time.C</TT>
   contains the definitions (full code bodies) for the Time methods.

<P>

<P>

<H1><A NAME="SECTION05050000000000000000">
20 TimeInterval Class</A>
</H1>

<P>

<H2><A NAME="SECTION05051000000000000000">
20.1 Description</A>
</H2>
<A NAME="sec:TimeInterval"></A>A TimeInterval represents a period between time instants.  
It can be either positive or negative.  Like the Time interface, 
the TimeInterval interface is designed so that you can choose 
one or more options from a list of time units in order 
to specify a TimeInterval.
See Section&nbsp;<A HREF="node5.html#subsec:Time_Instants_and_TimeIntervals">17.3</A>, 
Table&nbsp;<A HREF="#table:timeOpts"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> for the available options.

<P>
There are TimeInterval methods defined for setting and getting 
a TimeInterval, for incrementing and decrementing a TimeInterval 
by another TimeInterval, and for multiplying and dividing 
TimeIntervals by integers, reals, fractions and other TimeIntervals.  
Methods are also defined to take the absolute value and negative 
absolute value of a TimeInterval, and for comparing the length of two
TimeIntervals.

<P>
The class used to represent time instants in ESMF is Time,
and this class is frequently used in operations along with 
TimeIntervals.  For example, the difference between two
Times is a TimeInterval.  

<P>
When a TimeInterval is used in calculations that involve an absolute 
reference time, such as incrementing a Time with a TimeInterval, calendar 
dependencies may be introduced.  The length of the time period that the 
TimeInterval represents will depend on the reference Time and the 
standard calendar that is associated with it.  The calendar dependency becomes 
apparent when, for example, adding a TimeInterval of 1 day to the Time 
of February 28, 1996, at 4:00pm EST.  In a 360 day calendar, the 
resulting date would be February 29, 1996, at 4:00pm EST.  In a no-leap 
calendar, the result would be March 1, 1996, at 4:00pm EST.

<P>
TimeIntervals are used by other parts of the ESMF timekeeping
system, such as Clocks (Section&nbsp;<A HREF="node5.html#sec:Clock">21.1</A>) and Alarms 
(Section&nbsp;<A HREF="node5.html#sec:Alarm">22.1</A>).

<P>

<P>

<H2><A NAME="SECTION05052000000000000000">
20.2 Class API</A>
</H2>

<P>

<P>

<P>

<H2><A NAME="SECTION05053000000000000000">
20.3 C++:  Class Interface ESMC_TimeInterval - Public C interface to the ESMF TimeInterval class (Source File: ESMC_TimeInterval.h)</A>
</H2>

<P>
The code in this file defines the public C TimeInterval interfaces and
   declares method signatures (prototypes).  The companion file
   <TT>ESMC_TimeInterval.C</TT> contains the definitions (full code bodies) for
   the TimeInterval methods.

<P>

<P>

<H1><A NAME="SECTION05060000000000000000">
21 Clock Class</A>
</H1>

<P>

<H2><A NAME="SECTION05061000000000000000">
21.1 Description</A>
</H2>

<P>
<A NAME="sec:Clock"></A>
<P>
The Clock class advances model time and tracks its associated
date on a specified Calendar.  It stores start time, stop time,
current time, previous time, and a time step.  It can also store
a reference time, typically the time instant at which a simulation 
originally began.  For a restart run, the reference time can be 
different than the start time, when the application execution resumes.

<P>
A user can call the <TT>ESMF_ClockSet</TT> method and reset the time 
step as desired.  

<P>
A Clock also stores a list of Alarms, which can be set to flag 
events that occur at a specified time instant or at 
a specified time interval.  See Section&nbsp;<A HREF="node5.html#sec:Alarm">22.1</A> for 
details on how to use Alarms.

<P>
There are methods for setting and getting the Times and 
Alarms associated with a Clock.  Methods are defined for 
advancing the Clock's current time, checking if the 
stop time has been reached, reversing direction, and 
synchronizing with a real clock. 

<P>

<H2><A NAME="SECTION05062000000000000000">
21.2 Class API</A>
</H2>

<P>

<P>

<P>

<H2><A NAME="SECTION05063000000000000000">
21.3 C++:  Class Interface ESMC_Clock - Public C interface to the ESMF Clock class (Source File: ESMC_Clock.h)</A>
</H2>

<P>
The code in this file defines the public C Clock interfaces and declares
   method signatures (prototypes).  The companion file <TT>ESMC_Clock.C</TT>
   contains the definitions (full code bodies) for the Clock methods.

<P>

<P>

<H1><A NAME="SECTION05070000000000000000">
22 Alarm Class</A>
</H1>

<P>

<H2><A NAME="SECTION05071000000000000000">
22.1 Description</A>
</H2>

<P>
<A NAME="sec:Alarm"></A>The Alarm class identifies events that occur at specific Times
or specific TimeIntervals by returning a true value at those times
or subsequent times, and a false value otherwise.  

<P>

<H2><A NAME="SECTION05072000000000000000">
22.2 Class API</A>
</H2>

<P>

<P>

<H1><A NAME="SECTION05080000000000000000">
23 Config Class</A>
</H1>

<P>

<H2><A NAME="SECTION05081000000000000000">
23.1 Description</A>
</H2>

<P>
ESMF Configuration Management is based on NASA DAO's 
      Inpak 90 package, a Fortran 90 collection of routines/functions
      for accessing <EM>Resource Files</EM> in ASCII format.The package 
      is optimized for minimizing formatted I/O, performing all of its 
      string operations in memory using Fortran intrinsic functions.
<BR>
<P>
Module <!-- MATH
 ${\tt ESMF\_ConfigMod}$
 -->
<IMG
 WIDTH="123" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img12.png"
 ALT="${\tt ESMF\_ConfigMod}$"> is implemented in Fortran.

<P>

<H3><A NAME="SECTION05081100000000000000">
23.1.1 Package History</A>
</H3>
       The ESMF Configuration Management Package was evolved by
       Leonid Zaslavsky and Arlindo da Silva from Ipack90 package
       created by Arlindo da Silva at NASA DAO.

<P>
Back in the 70's Eli Isaacson wrote IOPACK in Fortran
       66.  In June of 1987 Arlindo da Silva wrote Inpak77 using
       Fortran 77 string functions; Inpak 77 is a vastly
       simplified IOPACK, but has its own goodies not found in
       IOPACK.  Inpak 90 removes some obsolete functionality in
       Inpak77, and parses the whole resource file in memory for
       performance.

<P>

<H2><A NAME="SECTION05082000000000000000">
23.2 Class API</A>
</H2>

<P>

<P>

<P>

<H2><A NAME="SECTION05083000000000000000">
23.3 C++:  Class Interface ESMC_Config - C++ interface to the F90 Config object (Source File: ESMC_Config.h)</A>
</H2>

<P>
The code in this file defines the C++ Config members and declares method 
   signatures (prototypes).  The companion file ESMC_Config.C contains
   the definitions (full code bodies) for the Config methods.

<P>

<P>

<P>

<H1><A NAME="SECTION05090000000000000000">
24 LogErr Class</A>
</H1>

<P>

<H2><A NAME="SECTION05091000000000000000">
24.1 Description</A>
</H2>

<P>
The Log class consists of a variety of methods for writing error, warning, and
informational messages to files.  A default Log is created at ESMF
initialization.  Other Logs can be created later in the code by the user.  Most
LogErr methods take a Log as an optional argument and apply to the default Log
when another Log is not specified.  A set of standard return codes and
associated messages are provided for error handling.  

<P>
LogErr provides capabilities to store message entries in a buffer, which is 
flushed to a file, either when the buffer is full, or when the user calls an 
<TT>ESMF_LogFlush()</TT> method.  Currently, the default is for the Log to flush
after every ten entries.  This can easily be changed by using the 
<TT>ESMF_LogSet()</TT> method and setting the <TT>maxElements</TT> property to 
another value.  The <TT>ESMF_LogFlush()</TT> method is automatically called when 
the program exits by any means (program completion, halt on error, or when the
Log is closed).

<P>
The user has the capability to halt the program on an error or on a warning by
using the <TT>ESMF_LogSet()</TT> method with the <TT>halt</TT> property.  When the 
<TT>halt</TT> property is set to <TT>ESMF_LOG_HALTWARNING</TT>, the program will 
stop on any and all warning or errors.  When the <TT>halt</TT> property is set to 
<TT>ESMF_LOG_HALTERROR</TT>, the program will only halt only on errors.  Lastly,
the user can choose to never halt by setting the <TT>halt</TT> property to 
<TT>ESMF_LOG_HALTNEVER</TT>; this is the default.

<P>
LogErr will automatically put the PET number into the Log.  Also, the user can 
either specify <TT>ESMF_LOG_SINGLE</TT> which writes all the entries to a single 
Log or <TT>ESMF_LOG_MULTI</TT> which writes entries to multiple Logs according to 
the PET number.  To distinguish Logs from each other when using 
<TT>ESMF_LOG_MULTI</TT>, the PET number (in the format <TT>PETx.</TT>) will be 
prepended to the file name where x is the PET number.

<P>
Opening multiple log files and writing log messages from all the processors
may affect the application performance while running on a large number of
processors.  For that reason, <TT>ESMF_LOG_NONE</TT> is provided to
switch off the LogErr capability.  All the LogErr methods have no effect
in the <TT>ESMF_LOG_NONE</TT> mode. 

<P>
Other options that are planned for LogErr are to adjust the verbosity of ouput, 
and to optionally write to <TT>stdout</TT> instead of file(s).

<P>

<P>

<H2><A NAME="SECTION05092000000000000000">
24.2 Class API</A>
</H2>

<P>

<P>

<P>

<H2><A NAME="SECTION05093000000000000000">
24.3 C++:  Class Interface ESMC_LogErr - Public C interface to the ESMF LogErr class (Source File: ESMC_LogErr.h)</A>
</H2>

<P>
The code in this file defines the public C LogErr interface and declares 
   all class data and methods.  All methods are defined in the companion file 
   ESMC_LogErr.C

<P>

<P><P>
<BR>
<EM>USES:</EM>
<PRE> 
 
 #include "ESMF_LogConstants.inc"
 #include "ESMF_ErrReturnCodes.inc"
 
 #ifdef __cplusplus
 extern "C"{
 #endif
 
   Class declaration type
 typedef struct{
 void *ptr;
 }ESMC_LogErr;
 
   Class API
 int ESMC_LogWrite(const char msg[], int msgtype);
 
 #ifdef __cplusplus
 } // extern "C"
 #endif
 
 enum ESMC_MsgType{ESMC_LOG_INFO=1,ESMC_LOG_WARN=2,ESMC_LOG_ERROR=3};
 enum ESMC_LogType{ESMC_LOG_SINGLE=1,ESMC_LOG_MULTI=2,ESMC_LOG_NONE=3};
 int ESMC_LogFinalize();
 const char *ESMC_LogGetErrMsg(int rc);
 int ESMC_LogSetFilename(char filename[]);
 void ESMC_TimeStamp(int *y,int* mn,int *d,int *h,int *m,int *s,int *ms);
</PRE>

<P>

<P>

<P>

<H1><A NAME="SECTION050100000000000000000">
25 DELayout Class</A>
</H1>

<P>

<H2><A NAME="SECTION050101000000000000000">
25.1 Description</A>
</H2>

<P>
The DELayout class provides an additional layer of abstraction on top of the Virtual Machine (VM) layer. DELayout does this by introducing DEs (Decomposition Elements) as logical resource units. The DELayout object keeps track of the relationship between its DEs and the resources of the associated VM object. 

<P>
The relationship between DEs and VM resources (PETs (Persistent Execution Threads) and VASs (Virtual Address Spaces)) contained in a DELayout object is defined during its creation and cannot be changed thereafter. There are, however, a number of hint and specification arguments that can be used to shape the DELayout during its creation.

<P>
Contrary to the number of PETs and VASs contained in a VM object, which are fixed by the available resources, the number of DEs contained in a DELayout can be chosen freely to best match the computational problem or other design criteria. Creating a DELayout with less DEs than there are PETs in the associated VM object can be used to share resources between decomposed objects within an ESMF component. Creating a DELayout with more DEs than there are PETs in the associated VM object can be used to evenly partition the computation over the available resources.

<P>
The simplest case, however, is where the DELayout contains the same number of DEs as there are PETs in the associated VM context. In this case the DELayout may be used to re-label the hardware and operating system resources held by the VM. For instance, it is possible to order the resources so that specific DEs have best available communication paths. The DELayout will map the DEs to the PETs of the VM according to the resource details provided by the VM instance. 

<P>
Furthermore, general DE to PET mapping can be used to offer computational resources with finer granularity than the VM does. The DELayout can be queried for computational and communication capacities of DEs and DE pairs, respectively. This information can be used to best utilize the DE resources when partitioning the computational problem. In combination with other ESMF classes general DE to PET mapping can be used to realize cache blocking, communication hiding and dynamic load balancing.

<P>
Finally, the DELayout layer offers primitives that allow a work queue style dynamic load balancing between DEs.

<P>

<H2><A NAME="SECTION050102000000000000000">
25.2 Class API</A>
</H2>

<P>

<P>

<H1><A NAME="SECTION050110000000000000000">
26 VM Class</A>
</H1>

<P>

<H2><A NAME="SECTION050111000000000000000">
26.1 Description</A>
</H2>

<P>
The <TT>ESMF_VM</TT> (Virtual Machine) class is a generic representation of hardware and system software resources. There is exactly one VM object per ESMF Component, providing the execution environment for the Component code. The VM class handles all resource management tasks for the Component class and provides a description of the underlying configuration of the compute resources used by a Component.

<P>
In addition to resource description and management, the VM class offers the lowest level of ESMF communication methods. The VM communication calls are very similar to MPI. Data references in VM communication calls must be provided as raw, language specific, one-dimensional, contiguous data arrays. The similarity between VM and MPI communication calls is striking and there are many equivalent point-to-point and collective communication calls. However, unlike MPI, the VM communication calls support communication between threaded PETs in a completely transparent fashion.

<P>
Many ESMF applications do not interact with the VM class directly very much. The  resource management aspect is wrapped completely transparent into the ESMF Component concept. Often the only reason that user code queries a Component
object for the associated VM object is to inquire about resource information, such as the <TT>localPet</TT> or the <TT>petCount</TT>. Further, for most applications the use of higher level communication APIs, such as provided by Array and Field, are much more convenient than using the low level VM communication calls.

<P>
The basic elements of a VM are called PETs, which stands for Persistent Execution Threads. These are equivalent to OS threads with a lifetime of at least that of the associated component. All VM functionality is expressed in terms of PETs. In the simplest, and most common case, a PET is equivalent to an MPI process. However, ESMF also supports multi-threading, where multiple PETs run as Pthreads inside the same virtual address space (VAS).

<P>
The resource management functions of the VM class become visible when a component, or the driver code, creates sub-components. Section <A HREF="#sec:AppDriverSetVM"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> discusses this aspect from the Superstructure 
perspective and provides links to the relevant Component examples in the documentation.

<P>
There are two parts to resource management, the parent and the child. When the parent component creates a child component, the parent VM object provides the resources on which the child is created with <TT>ESMF_GridCompCreate()</TT> or <TT>ESMF_CplCompCreate()</TT>. The optional <TT>petList</TT> argument to these calls limits the resources that the parent gives to a specific child. The child component, on the other hand, may specify - during its optional <TT>ESMF_&lt;Grid/Cpl&gt;CompSetVM()</TT> method - how it wants to arrange the inherited resources in its own VM. After this, all standard ESMF methods of the Component, including <TT>ESMF_&lt;Grid/Cpl&gt;CompSetServices()</TT>, will execute in the child VM. Notice that the <TT>ESMF_&lt;Grid/Cpl&gt;CompSetVM()</TT> routine, although part of the child Component, must execute <EM>before</EM> the child VM has been started up. It runs in the parent VM context. The child VM is created and started up just before the user-written set services routine, specified as an argument to <TT>ESMF_&lt;Grid/Cpl&gt;CompSetServices()</TT>, is entered.

<P>

<H2><A NAME="SECTION050112000000000000000">
26.2 Class API</A>
</H2>

<P>

<P>

<P>

<H2><A NAME="SECTION050113000000000000000">
26.3 C++:  Class Interface ESMC_VM - Public C interface to the ESMF VM class (Source File: ESMC_VM.h)</A>
</H2>

<P>
The code in this file defines the public C VM class and declares method
   signatures (prototypes).  The companion file <TT>ESMC_VM.C</TT> contains
   the definitions (full code bodies) for the VM methods.

<P>

<P>

<H1><A NAME="SECTION050120000000000000000">
27 References</A>
</H1>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html354"
  HREF="node6.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html350"
  HREF="ESMC_crefdoc.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html344"
  HREF="node4.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html352"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html355"
  HREF="node6.html">Bibliography</A>
<B> Up:</B> <A NAME="tex2html351"
  HREF="ESMC_crefdoc.html">ESMC_crefdoc</A>
<B> Previous:</B> <A NAME="tex2html345"
  HREF="node4.html">3 Infrastructure: Fields and</A>
 &nbsp <B>  <A NAME="tex2html353"
  HREF="node1.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<A HREF=mailto:esmf_support@list.woc.noaa.gov>esmf_support@list.woc.noaa.gov</A>
</ADDRESS>
</BODY>
</HTML>
