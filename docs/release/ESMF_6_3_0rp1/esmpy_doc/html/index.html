<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ESMPy &mdash; ESMPy ESMF_6_3_0rp1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'ESMF_6_3_0rp1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ESMPy ESMF_6_3_0rp1 documentation" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="#">ESMPy ESMF_6_3_0rp1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
<div class="section" id="esmpy">
<h1>ESMPy<a class="headerlink" href="#esmpy" title="Permalink to this headline">¶</a></h1>
<p>Welcome to ESMPy - The ESMF Python Interface!</p>
<p>The <a class="reference external" href="http://www.earthsystemcog.org/projects/esmpy/">ESMPy home page</a> has all of the
latest information on the ESMPy project including release notes, known
bugs, supported platforms, and download information.</p>
<p>Please see the <a class="reference external" href="http://www.earthsystemmodeling.org">ESMF home page</a>
for more information on ESMF in general.</p>
<p><a class="reference external" href="http://www.earthsystemmodeling.org/presentations/pres_1109_see_regridding.ppt">Fast Parallel Grid Remapping for Unstructured and Structured Grids</a>
gives a nice overview of the ESMF remapping functionality.</p>
<p>The <a class="reference external" href="http://www.earthsystemmodeling.org/esmf_releases/last/regridding_status.html">ESMF Regridding Status</a>
page gives a good overview of the functionality that is available through
various interfaces to ESMF regridding.</p>
<p>The <a class="reference external" href="http://www.earthsystemmodeling.org/esmf_releases/last/ESMF_refdoc/node3.html#SECTION03020000000000000000">ESMF_RegridWeightGen application</a>
is a command-line version of the functionality that is available through ESMPy.</p>
<p>Please contact <a class="reference external" href="mailto:esmf_support&#37;&#52;&#48;list&#46;woc&#46;noaa&#46;gov">esmf_support<span>&#64;</span>list<span>&#46;</span>woc<span>&#46;</span>noaa<span>&#46;</span>gov</a> with any questions or problems.</p>
<div class="section" id="module-ESMF">
<span id="introduction"></span><h2>Introduction<a class="headerlink" href="#module-ESMF" title="Permalink to this headline">¶</a></h2>
<p>ESMPy is a Python interface to the Earth System Modeling Framework (ESMF) 
regridding utility.  ESMF is software for
building and coupling weather, climate, and related models.  ESMF has a robust,
parallel and scalable remapping package, used to generate remapping weights.
It can handle a wide variety of grids and options:  logically rectangular grids
and unstructured meshes; regional or global grids; 2D or 3D; and pole and
masking options.  ESMF also has capabilities to read grid information
from NetCDF files in a variety of formats, including the evolving Climate and 
Forecast (CF) GridSpec and UGRID conventions.</p>
<p>ESMPy supports a single-tile logically rectangular discretization type called
Grid and an unstructured discretization type called Mesh (ESMF also
supports observational data streams).
ESMPy supports bilinear, higher order patch recovery and first-order
conservative regridding.  There is also an option to ignore unmapped
destination points and mask out points on either the source or destination.
Regridding on the sphere takes place in 3D Cartesian space, so the pole
problem is not an issue as it commonly is with many Earth system grid remapping
softwares.  Grid and Mesh objects can be created in 2D or 3D space, and 3D
first-order conservative regridding is fully supported.  Future plans for ESMPy
involve the incorporation of observational data streams.</p>
<p>Regridding, also called remapping or interpolation, is the process of changing
the grid underneath field data values while preserving the qualities of the
original data.  Different kinds of transformations are appropriate for
different problems. Regridding may be needed when communicating data between
Earth system model components such as land and atmosphere, or between
different data sets to support analysis or visualization.</p>
<p>Regridding can be broken into two stages. The first stage is generation of an
interpolation weight matrix that describes how points in the source grid
contribute to points in the destination grid. The second stage is the
multiplication of values on the source grid by the interpolation weight matrix
to produce the appropriate values on the destination grid.  ESMPy provides
access to both stages through two separate interfaces.</p>
<p>There are many different interpolation methods, suitable for different
problems.  In ESMPy, the basic bilinear option is a two dimensional variant of
linear interpolation.  The higher order patch recovery is a second degree
polynomial regridding method, which uses a least squares algorithm to
calculate the polynomial.  The first-order conservative regridding is a
variant of a constant method which compares the proportions of overlapping
source and destination cells to determine appropriate weights.  All of these
methods can be broken down to a simple sparse matrix multiplication operation
between interpolation weights and data values.</p>
</div>
<div class="section" id="getting-the-code">
<h2>Getting the code<a class="headerlink" href="#getting-the-code" title="Permalink to this headline">¶</a></h2>
<p>The ESMF User&#8217;s Guide contains information on building and installing ESMF.
The ESMF Reference Manual contains information on the architecture of ESMF,
example code, and details of the API (Application Programming Interface).</p>
<p>Instructions on how to download the ESMPy code can be found at the <a class="reference external" href="http://www.earthsystemcog.org/projects/esmpy/releases">ESMPy Download page</a>.</p>
<div class="section" id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<p>The following packages are <em>required</em> to work with ESMPy:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.earthsystemmodeling.org/esmf_releases/last/ESMF_usrdoc">ESMF installation</a></li>
<li><a class="reference external" href="http://python.org/">python</a></li>
<li><a class="reference external" href="http://www.numpy.org/">numpy</a></li>
</ul>
<p>The following packages are <em>optional</em>:</p>
<ul>
<li><p class="first">mpi4py - python bindings to MPI, needed to run the parallel regridding tests</p>
</li>
<li><dl class="first docutils">
<dt>ESMF installation with NetCDF - required to create grids and meshes from file</dt>
<dd><ul class="first last simple">
<li>NetCDF must be built as a shared library for ESMPy installation to succeed</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">nose - for nose testing</p>
</li>
</ul>
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Installation of ESMPy requires a pointer to a file named esmf.mk inside of an
ESMF installation.  This file resides in a directory which looks like:</p>
<p>&lt;ESMF_INSTALL_DIR&gt;/lib/lib&lt;g&lt;or&gt;O&gt;/&lt;platform&gt;/esmf.mk</p>
<p>If the ESMFMKFILE flag is set when building ESMPy then it will not need to be
referenced again.  If not, an environment variable of the same name must be set
with the path to the esmf.mk file EVERY time that a new shell is initiated.</p>
<p>The ESMPy build can be installed in a custom location using the
&#8211;prefix, &#8211;home, or &#8211;install-base flags to the install command.  If this
is done, then this location needs to be added to the PYTHONPATH environment
variable in the user&#8217;s shell EVERY time that a new shell is initiated.  If a
customized install location is not specified, ESMPy will be installed in the
standard Python package installation directory on that particular machine.</p>
<p>Note: The ESMPy build does not have to be installed to be used.  The
PYTHONPATH environment variable can simply be pointed to the directory
containing the ESMF module (esmfcontrib-ESMPy/src from a default git clone)
after the build command.</p>
<p>As usual, any command followed by &#8211;help should print out some information
on what options are available.</p>
<p>An installation of ESMPy in the default location for Python packages can be done
with the following command issued from the top level ESMPy directory:</p>
<ul>
<li><p class="first">default Python package installation:</p>
<blockquote>
<div><p>python setup.py build &#8211;ESMFMKFILE=&lt;DIR_TO_esmf.mk&gt; install</p>
</div></blockquote>
</li>
<li><p class="first">custom install location:</p>
<blockquote>
<div><p>python setup.py build &#8211;ESMFMKFILE=&lt;DIR_TO_esmf.mk&gt;</p>
<p>python setup.py install &#8211;prefix=&lt;custom_install_location&gt;</p>
<p>setenv PYTHONPATH &lt;custom_install_location&gt;/lib/<a href="#id1"><span class="problematic" id="id2">*</span></a>/site_packages</p>
</div></blockquote>
</li>
</ul>
<p>Please contact <a class="reference external" href="mailto:esmf_support&#37;&#52;&#48;list&#46;woc&#46;noaa&#46;gov">esmf_support<span>&#64;</span>list<span>&#46;</span>woc<span>&#46;</span>noaa<span>&#46;</span>gov</a> with any questions or problems.</p>
<div class="section" id="use">
<h3>Use<a class="headerlink" href="#use" title="Permalink to this headline">¶</a></h3>
<p>To use this package in an external program, import it with:</p>
<blockquote>
<div>import ESMF</div></blockquote>
</div>
<div class="section" id="validation">
<h3>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h3>
<p>The setup.py file can be used to run all of the ESMPy tests (in serial or
parallel), like this:</p>
<blockquote>
<div><p>python setup.py test_all</p>
<p>python setup.py test_all_parallel</p>
</div></blockquote>
<p>or subsets of the tests individually, like this:</p>
<blockquote>
<div><p>python setup.py test</p>
<p>python setup.py test_regrid</p>
<p>python setup.py test_regrid_from_file</p>
<p>python setup.py test_parallel</p>
<p>python setup.py test_regrid_parallel</p>
<p>python setup.py test_regrid_from_file_parallel</p>
</div></blockquote>
<p>NOTE: The regrid_from_file tests can take up a lot of memory and bandwidth.
The &#8220;test_regrid_from_file_dryrun&#8221; command will simply download the test
files without actually running them (allowing the stress on the machine to
be applied to bandwidth first, and then memory).</p>
<p>Alternatively, if the nose package is available, the tests can be run with:</p>
<blockquote>
<div>nosetests</div></blockquote>
<p>Individual tests can be run with nose using the following format:</p>
<blockquote>
<div>nosetests &lt;file&gt;:&lt;test&gt;</div></blockquote>
<p>e.g.</p>
<blockquote>
<div>nosetests src/ESMF/test/unit_test.py:field_regrid_test</div></blockquote>
</div>
</div>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<p>ESMPy doesn&#8217;t include many aspects of ESMF, including components, array
interfaces, time management, etc.  The limitations listed here are relative
to ESMF offline and integrated regridding capabilities.</p>
<ul class="simple">
<li>There is no FieldBundle class, only single Fields.</li>
<li>There is no support for tripole or multi-tile Grids.</li>
<li>ESMPy cannot use an ESMF installation that is built with external LAPACK
support.</li>
<li>Conservative regridding with a source Mesh created from file is not supported, because the Mesh cannot retrieve
coordinates from the elements.</li>
</ul>
<p>Testing related:</p>
<ul class="simple">
<li>Nightly regression testing is limited to a small subset of the ESMF test platforms, including Darwin and Linux running gfortran with openMPI.</li>
</ul>
</div>
<div class="section" id="create-a-grid-or-mesh-from-file">
<h2>Create a Grid or Mesh From File<a class="headerlink" href="#create-a-grid-or-mesh-from-file" title="Permalink to this headline">¶</a></h2>
<p>ESMPy can create Grid or Mesh objects from NetCDF files in a variety
of formats.  A Mesh can be created from files in SCRIP, ESMF, and UGRID
formats.  Grid files can be in SCRIP and GRIDSPEC format.</p>
<div class="section" id="file-formats">
<h3>File Formats<a class="headerlink" href="#file-formats" title="Permalink to this headline">¶</a></h3>
<div class="section" id="scrip">
<h4>SCRIP<a class="headerlink" href="#scrip" title="Permalink to this headline">¶</a></h4>
<p>This file format is used by the SCRIP [4] package, grid files that
work with that package should also work here.  SCRIP format files are
capable of storing either 2D logically rectangular grids or 2D
unstructured grids.  More information can be found in the ESMF reference
manual section on the <a class="reference external" href="http://www.earthsystemmodeling.org/esmf_releases/public/last/ESMF_refdoc/node3.html#SECTION03024000000000000000">SCRIP Grid File Format</a>.</p>
</div>
<div class="section" id="esmf">
<h4>ESMF<a class="headerlink" href="#esmf" title="Permalink to this headline">¶</a></h4>
<p>ESMF has custom unstructured grid file format for describing meshes.
This format is more compatible than the SCRIP format with the methods
used to create a Mesh object, so less conversion needs to be done to
create a Mesh. The ESMF format is thus more efficient than SCRIP when
used with ESMPy.  More information can be found in the ESMF reference
manual section on the <a class="reference external" href="http://www.earthsystemmodeling.org/esmf_releases/public/last/ESMF_refdoc/node3.html#SECTION03025000000000000000">ESMF Unstructured Grid File Format</a>.</p>
</div>
<div class="section" id="gridspec">
<h4>GRIDSPEC<a class="headerlink" href="#gridspec" title="Permalink to this headline">¶</a></h4>
<p>GRIDSPEC is an extension to the Climate and Forecast (CF) metadata
conventions for the representation of gridded data for Earth System
Models.  ESMPy supports NetCDF files that follow the CF GRIDSPEC
convention to support logically rectangular lat/lon grids.  More
information can be found in the ESMF reference manual section on the
<a class="reference external" href="http://www.earthsystemmodeling.org/esmf_releases/public/last/ESMF_refdoc/node3.html#SECTION03026000000000000000">CF Convention GRIDSPEC File Format</a>.</p>
</div>
<div class="section" id="ugrid">
<h4>UGRID<a class="headerlink" href="#ugrid" title="Permalink to this headline">¶</a></h4>
<p>UGRID is an extension to the CF metadata
conventions for the unstructured grid data model.  ESMPy support
NetCDF files that follow the CF UGRID convention for unstructured grids.
More information can be found in the ESMF reference manual section on
the <a class="reference external" href="http://www.earthsystemmodeling.org/esmf_releases/public/last/ESMF_refdoc/node3.html#SECTION03027000000000000000">CF Convention UGRID File Format</a>.</p>
</div>
</div>
<div class="section" id="meshes-from-file">
<h3>Meshes From File<a class="headerlink" href="#meshes-from-file" title="Permalink to this headline">¶</a></h3>
<p>When creating a Mesh from a SCRIP format file, there are a number of
options to control the output Mesh. The data is located at the center
of the grid cell in a SCRIP grid; whereas the data is located at the
corner of a cell in an ESMF Mesh object. Therefore, we create a Mesh
object by default by constructing a &#8220;dual&#8221; mesh using the coordinates
in the file. If the user wishes to not construct the dual mesh, the
optional argument &#8216;convert_to_dual&#8217; may be used to control this
behavior. When &#8216;convert_to_dual&#8217; is set to False, the Mesh constructed
from the file will not be the dual. This is necessary when the Mesh is
part of a conservative regridding operation, so the
weights are properly generated for the cell centers in the file.</p>
<p>A Mesh may also be created with boolean flags to specify whether or not to
add an area property to the Mesh &#8216;add_user_area&#8217;, or to add a mask
&#8216;add_mask&#8217; held by the NetCDF variable indicated in the optional argument,
&#8216;varname&#8217;.  These argument are only valid for UGRID formatted files.</p>
</div>
<div class="section" id="grids-from-file">
<h3>Grids From File<a class="headerlink" href="#grids-from-file" title="Permalink to this headline">¶</a></h3>
<p>A number of optional boolean arguments are also supported to create a
structured Grid from a file.  These include &#8216;is_sphere&#8217; to indicate whether
the grid is spherical or regional, &#8216;add_corner_stagger&#8217; to add the corner
stagger information to the Grid for conservative regridding, and
&#8216;add_user_area&#8217; to specify whether to read in the cell area from the
NetCDF file or to calculate them.  Also, for GRIDSPEC formmated files
there is the &#8216;add_mask&#8217; optional argument
to add a mask held by the NetCDF variable indicated in optional
argument, &#8216;varname&#8217;, and the &#8216;coord_names&#8217; argument to specify the longitude
and latitude variable names in GRIDSPEC file containing multiple sets of
coordinates.</p>
</div>
</div>
<div class="section" id="field-regridding">
<h2>Field regridding<a class="headerlink" href="#field-regridding" title="Permalink to this headline">¶</a></h2>
<div class="section" id="regridding-methods">
<h3>Regridding methods<a class="headerlink" href="#regridding-methods" title="Permalink to this headline">¶</a></h3>
<p>The following three sections describe the regridding methods that are
available in ESMPy.</p>
<div class="section" id="bilinear">
<h4>Bilinear<a class="headerlink" href="#bilinear" title="Permalink to this headline">¶</a></h4>
<p>In 2D, ESMPy supports bilinear regridding between any combination of the
following:</p>
<ul class="simple">
<li>Structured Grids composed of a single logically rectangular patch</li>
<li>Unstructured Meshes composed of any combination of triangles and
quadrilaterals (e.g. rectangles)</li>
</ul>
<p>In 3D, ESMPy supports bilinear regridding between any combination of the
following:</p>
<ul class="simple">
<li>Structured Grids composed of a single logically rectangular patch</li>
<li>Unstructured Meshes composed of hexahedrons (e.g. cubes)</li>
</ul>
<p>To use the bilinear method the user may created their Fields on any stagger
location for Grids or the node location (MeshLoc.NODE) for Meshes. For
Grids, the stagger location upon which the Field was built must contain
coordinates.</p>
</div>
<div class="section" id="higher-order-patch-recovery">
<h4>Higher order patch recovery<a class="headerlink" href="#higher-order-patch-recovery" title="Permalink to this headline">¶</a></h4>
<p>In 2D, ESMPy supports patch regridding between any combination of the following:</p>
<ul class="simple">
<li>Structured Grids composed of a single logically rectangular patch</li>
<li>Unstructured Meshes composed of any combination of triangles and
quadrilaterals (e.g. rectangles)</li>
</ul>
<p>Patch regridding is currently not supported in 3D.</p>
<p>To use the patch method the user may created their Fields on any stagger
location for Grids or the node location (MeshLoc.NODE) for Meshes. For
Grids, the stagger location upon which the Field was built must contain
coordinates.</p>
<p>See references [1] and [2] for more information.</p>
</div>
<div class="section" id="first-order-conservative">
<h4>First-order conservative<a class="headerlink" href="#first-order-conservative" title="Permalink to this headline">¶</a></h4>
<p>In 2D, ESMPy supports first-order conservative regridding between any
combination of the following:</p>
<ul class="simple">
<li>Structured Grids composed of a single logically rectangular patch</li>
<li>Unstructured Meshes composed of any combination of triangles and
quadrilaterals (e.g. rectangles)</li>
</ul>
<p>In 3D, ESMPy supports first-order conservative regridding between any
combination of the following:</p>
<ul class="simple">
<li>Structured Grids composed of a single logically rectangular patch</li>
<li>Unstructured Meshes composed of hexahedrons (e.g. cubes) and tetrahedras.</li>
</ul>
<p>To use the first-order conservative method the user must have created their
Fields on the center stagger location (StaggerLoc.CENTER in 2D or
StaggerLoc.CENTER_VCENTER in 3D) for Grids or the element location
(MeshLoc.ELEMENT) for Meshes. For Grids, the corner stagger location
(StaggerLoc.CORNER in 2D or StaggerLoc.CORNER_VFACE in 3D) must
contain coordinates describing the outer perimeter of the Grid cells.</p>
<p>See reference [3] for more information.</p>
</div>
</div>
<div class="section" id="masking">
<h3>Masking<a class="headerlink" href="#masking" title="Permalink to this headline">¶</a></h3>
<p>Masking is the process whereby parts of a grid can be marked to be
ignored during an operation, such as regridding.  Masking can be
used on a source grid to indicate that certain portions of the grid
should not be used to generate regridded data.  This is useful, for
example, if a portion of a source grid contains unusable values.
Masking can also be used on a destination grid to indicate that the
portion of the field built on that part of the grid should not
receive regridded data.  This is useful, for example, when part of
the grid isn&#8217;t being used (e.g. the land portion of an ocean grid).</p>
<p>ESMPy currently supports masking for Fields built on structured
Grids and element masking for Fields built on unstructured Meshes.
A Grid mask is initialized by setting mask values in the
Numpy Array returned from the Grid.get_item() call using the &#8216;item&#8217;
variable.  A Mesh mask is initialized by passing mask values into
the Mesh.add_elements() call using the &#8216;element_mask&#8217; variable.  The
Field mask can then be setup by indicating the values to use for
the mask in the &#8216;mask_values&#8217; variable of the Field constructor.  However,
the Field mask does not need to be setup to mask values in the
regridding operation.  Regrid masking is handled by passing the
mask values into the &#8216;src_mask_values&#8217; or &#8216;dst_mask_values&#8217;
variables of the Regrid constructor.  For example, if
&#8216;dst_mask_values&#8217; is set to (/1,2/), then any location
in the Grid or Mesh that has a value of 1 or 2 will be masked.</p>
<p>Masking behavior differs slightly between regridding methods. For
non-conservative regridding methods (e.g. bilinear or high-order
patch), masking is done on points. For these methods, masking a
destination point means that the point won&#8217;t participate in
regridding (e.g. won&#8217;t receive an interpolated value). For these methods,
masking a source point means that the entire source cell using
that point is masked out. In other words, if any corner point
making up a source cell is masked then the whole cell is masked. For
conservative regridding methods (e.g. first-order conservative)
masking is done on cells. Masking a destination cell means that
the cell won&#8217;t participate in regridding (e.g. won&#8217;t receive an
interpolated value). Similarly, masking a source cell means that the
cell won&#8217;t participate in regridding (e.g. won&#8217;t contribute to
interpolation).  For any type of interpolation method (conservative or
non-conservative) the masking is set on the location upon
which the Fields passed into the regridding call are built.
For example, if Fields built on StaggerLoc.CENTER are
passed into the Regrid() call then the masking
should also be set in StaggerLoc.CENTER.</p>
</div>
<div class="section" id="spherical-coordinates">
<h3>Spherical coordinates<a class="headerlink" href="#spherical-coordinates" title="Permalink to this headline">¶</a></h3>
<p>In the case that the Grid is on a sphere (coord_sys=CoordSys.SPH_DEG or
CoordSys.SPH_RAD) then the coordinates given in the Grid are interpreted
as latitude and longitude values. The coordinates can either be in degrees or
radians as indicated by the &#8216;coord_sys&#8217; flag set during Grid creation. As is
true with many global models, this application currently assumes the latitude
and longitude refer to positions on a perfect sphere, as opposed to a more
complex and accurate representation of the earth&#8217;s true shape such as would be
used in a GIS system.</p>
</div>
<div class="section" id="unmapped-points">
<h3>Unmapped points<a class="headerlink" href="#unmapped-points" title="Permalink to this headline">¶</a></h3>
<p>If a destination point cannot be mapped to a location in the source grid, the
user has two options. The user may ignore those destination points that cannot
be mapped by setting the &#8216;unmapped_action&#8217; argument to UnmappedAction.IGNORE.
The user also has the option to return
an error if unmapped destination points exist. This is the default behavior,
so the user can either not set the &#8216;unmapped_action&#8217; argument or the user can set
it to UnmappedAction.ERROR. At this point ESMPy does not support
extrapolation to destination points outside the unmasked source Field.</p>
</div>
</div>
<div class="section" id="interface">
<h2>Interface<a class="headerlink" href="#interface" title="Permalink to this headline">¶</a></h2>
<div class="section" id="classes">
<h3>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Class</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="manager.html#ESMF.Manager" title="ESMF.Manager"><tt class="xref py py-class docutils literal"><span class="pre">Manager</span></tt></a></td>
<td>A manager class to initialize and finalize ESMF</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="field.html#ESMF.Field" title="ESMF.Field"><tt class="xref py py-class docutils literal"><span class="pre">Field</span></tt></a></td>
<td>A data field built on a Grid or Mesh</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="grid.html#ESMF.Grid" title="ESMF.Grid"><tt class="xref py py-class docutils literal"><span class="pre">Grid</span></tt></a></td>
<td>A structured grid for coordinate representation</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="mesh.html#ESMF.Mesh" title="ESMF.Mesh"><tt class="xref py py-class docutils literal"><span class="pre">Mesh</span></tt></a></td>
<td>An unstructured grid for coordinate representation</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="regrid.html#ESMF.Regrid" title="ESMF.Regrid"><tt class="xref py py-class docutils literal"><span class="pre">Regrid</span></tt></a></td>
<td>The regridding utility</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="named-constants">
<h3>Named constants<a class="headerlink" href="#named-constants" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Named constants</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference download internal" href="_downloads/CoordSys.rst"><tt class="xref download docutils literal"><span class="pre">CoordSys</span></tt></a></td>
<td>Specify the coordinate system of a Grid</td>
</tr>
<tr class="row-odd"><td><a class="reference download internal" href="_downloads/DecompFlag.rst"><tt class="xref download docutils literal"><span class="pre">DecompFlag</span></tt></a></td>
<td>Specify how DistGrid elements are decomposed over DEs</td>
</tr>
<tr class="row-even"><td><a class="reference download internal" href="_downloads/FileFormat.rst"><tt class="xref download docutils literal"><span class="pre">FileFormat</span></tt></a></td>
<td>Specify the format of a data file</td>
</tr>
<tr class="row-odd"><td><a class="reference download internal" href="_downloads/GridItem.rst"><tt class="xref download docutils literal"><span class="pre">GridItem</span></tt></a></td>
<td>Specify a mask or area item on a Grid</td>
</tr>
<tr class="row-even"><td><a class="reference download internal" href="_downloads/LogKind.rst"><tt class="xref download docutils literal"><span class="pre">LogKind</span></tt></a></td>
<td>Specify how much logging should be done</td>
</tr>
<tr class="row-odd"><td><a class="reference download internal" href="_downloads/MeshElemType.rst"><tt class="xref download docutils literal"><span class="pre">MeshElemType</span></tt></a></td>
<td>Specify the type of the Mesh elements</td>
</tr>
<tr class="row-even"><td><a class="reference download internal" href="_downloads/MeshLoc.rst"><tt class="xref download docutils literal"><span class="pre">MeshLoc</span></tt></a></td>
<td>Specify a nodal or elemental Mesh</td>
</tr>
<tr class="row-odd"><td><a class="reference download internal" href="_downloads/Region.rst"><tt class="xref download docutils literal"><span class="pre">Region</span></tt></a></td>
<td>Specify various regions in the data layout of</td>
</tr>
<tr class="row-even"><td><a class="reference download internal" href="_downloads/RegridMethod.rst"><tt class="xref download docutils literal"><span class="pre">RegridMethod</span></tt></a></td>
<td>Specify which interpolation method to use regridding</td>
</tr>
<tr class="row-odd"><td><a class="reference download internal" href="_downloads/StaggerLoc.rst"><tt class="xref download docutils literal"><span class="pre">StaggerLoc</span></tt></a></td>
<td>Specify the position for data in a Grid cell</td>
</tr>
<tr class="row-even"><td><a class="reference download internal" href="_downloads/TypeKind.rst"><tt class="xref download docutils literal"><span class="pre">TypeKind</span></tt></a></td>
<td>Specify the type and kind of data</td>
</tr>
<tr class="row-odd"><td><a class="reference download internal" href="_downloads/UnmappedAction.rst"><tt class="xref download docutils literal"><span class="pre">UnmappedAction</span></tt></a></td>
<td>Specify which action to take with respect to unmapped destination points</td>
</tr>
<tr class="row-even"><td><a class="reference download internal" href="_downloads/PoleMethod.rst"><tt class="xref download docutils literal"><span class="pre">PoleMethod</span></tt></a></td>
<td>Specify  which type of artificial pole to construct on the source Grid for regridding</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="tutorials">
<h2>Tutorials<a class="headerlink" href="#tutorials" title="Permalink to this headline">¶</a></h2>
<p>The first few tutorials are stand-alone scripts that can be run from any Python
interpeter.</p>
<div class="section" id="script-examples">
<h3>Script examples<a class="headerlink" href="#script-examples" title="Permalink to this headline">¶</a></h3>
<div class="section" id="hello-world">
<h4>Hello World<a class="headerlink" href="#hello-world" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">ESMF</span>

<span class="c"># Start up ESMF, this call is only necessary to override the default parameters</span>
<span class="c"># for logkind (ESMF.LogKind.NONE) and debug (False)</span>
<span class="n">esmpy</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Manager</span><span class="p">(</span><span class="n">logkind</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">LogKind</span><span class="o">.</span><span class="n">MULTI</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;Hello ESMPy World from PET (processor) {0}!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ESMF</span><span class="o">.</span><span class="n">local_pet</span><span class="p">())</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="grid-create-from-file">
<h4>Grid Create From File<a class="headerlink" href="#grid-create-from-file" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="c"># This example demonstrates how to create an ESMPy grid from file</span>
<span class="c"># The grid file is required, it can be retrieved from the ESMF data repository:</span>
<span class="c">#   wget http://www.earthsystemmodeling.org/download/data/ll2.5deg_grid.nc</span>

<span class="kn">import</span> <span class="nn">ESMF</span>

<span class="c"># Start up ESMF, this call is only necessary to override the default parameters</span>
<span class="c"># for logkind (ESMF.LogKind.NONE) and debug (False)</span>
<span class="n">esmpy</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Manager</span><span class="p">(</span><span class="n">logkind</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">LogKind</span><span class="o">.</span><span class="n">MULTI</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># Create a uniform global latlon grid from a SCRIP formatted file</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">&quot;ll2.5deg_grid.nc&quot;</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">FileFormat</span><span class="o">.</span><span class="n">SCRIP</span><span class="p">)</span>

<span class="c"># Create a field on the centers of the grid</span>
<span class="n">field</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="s">&quot;field&quot;</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;Successfully read a grid and created a field!&quot;</span>
<span class="k">print</span> <span class="s">&quot;The field values on PET (processor) # {0} are:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ESMF</span><span class="o">.</span><span class="n">local_pet</span><span class="p">())</span>
<span class="k">print</span> <span class="n">field</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="mesh-create-from-file">
<h4>Mesh Create From File<a class="headerlink" href="#mesh-create-from-file" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="c"># This example demonstrates how to create an ESMPy mesh from file</span>
<span class="c"># The mesh file is required, it can be retrieved from the ESMF data repository:</span>
<span class="c">#   wget http://www.earthsystemmodeling.org/download/data/mpas_uniform_10242_dual_counterclockwise.nc</span>

<span class="kn">import</span> <span class="nn">ESMF</span>

<span class="c"># Start up ESMF, this call is only necessary to override the default parameters</span>
<span class="c"># for logkind (ESMF.LogKind.NONE) and debug (False)</span>
<span class="n">esmpy</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Manager</span><span class="p">(</span><span class="n">logkind</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">LogKind</span><span class="o">.</span><span class="n">MULTI</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># create an ESMF formatted unstructured mesh with clockwise cells removed</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">&quot;mpas_uniform_10242_dual_counterclockwise.nc&quot;</span><span class="p">,</span>
                 <span class="n">filetype</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">FileFormat</span><span class="o">.</span><span class="n">ESMFMESH</span><span class="p">)</span>

<span class="c"># create a field on the nodes of the mesh</span>
<span class="n">field</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s">&quot;field&quot;</span><span class="p">,</span> <span class="n">meshloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">MeshLoc</span><span class="o">.</span><span class="n">NODE</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;Successfully read a mesh and created a field!&quot;</span>
<span class="k">print</span> <span class="s">&quot;The field values on PET (processor) # {0} are:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ESMF</span><span class="o">.</span><span class="n">local_pet</span><span class="p">())</span>
<span class="k">print</span> <span class="n">field</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="grid-mesh-regrid">
<h4>Grid Mesh Regrid<a class="headerlink" href="#grid-mesh-regrid" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="c"># This example demonstrates how to regrid between a grid and a mesh.</span>
<span class="c"># The grid and mesh files are required, they can be retrieved from the ESMF data repository:</span>
<span class="c">#   wget http://www.earthsystemmodeling.org/download/data/ll2.5deg_grid.nc</span>
<span class="c">#   wget http://www.earthsystemmodeling.org/download/data/mpas_uniform_10242_dual_counterclockwise.nc</span>

<span class="kn">import</span> <span class="nn">ESMF</span>

<span class="n">grid1</span> <span class="o">=</span> <span class="s">&quot;data/ll2.5deg_grid.nc&quot;</span>
<span class="n">grid2</span> <span class="o">=</span> <span class="s">&quot;data/mpas_uniform_10242_dual_counterclockwise.nc&quot;</span>         <span class="c">#SCRIP</span>
    
<span class="c"># Create a uniform global latlon grid from a SCRIP formatted file</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">&quot;ll2.5deg_grid.nc&quot;</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">FileFormat</span><span class="o">.</span><span class="n">SCRIP</span><span class="p">,</span>
                 <span class="n">add_corner_stagger</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># create a field on the center stagger locations of the source grid</span>
<span class="n">srcfield</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="s">&#39;srcfield&#39;</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">)</span>

<span class="c"># initialize the field to a constant value</span>
<span class="n">srcfield</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>

<span class="c"># create an ESMF formatted unstructured mesh with clockwise cells removed</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">&quot;mpas_uniform_10242_dual_counterclockwise.nc&quot;</span><span class="p">,</span>
                 <span class="n">filetype</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">FileFormat</span><span class="o">.</span><span class="n">ESMFMESH</span><span class="p">)</span>

<span class="c"># create a field on the elements of the destination mesh</span>
<span class="n">dstfield</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s">&#39;dstmesh&#39;</span><span class="p">,</span> <span class="n">meshloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">MeshLoc</span><span class="o">.</span><span class="n">ELEMENT</span><span class="p">)</span>

<span class="c"># create an object to regrid data from the source to the destination field</span>
<span class="n">regrid</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Regrid</span><span class="p">(</span><span class="n">srcfield</span><span class="p">,</span> <span class="n">dstfield</span><span class="p">,</span> \
                     <span class="n">regrid_method</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">RegridMethod</span><span class="o">.</span><span class="n">CONSERVE</span><span class="p">,</span> \
                     <span class="n">unmapped_action</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">UnmappedAction</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">)</span>

<span class="c"># do the regridding from source to destination field</span>
<span class="n">dstfield</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">srcfield</span><span class="p">,</span> <span class="n">dstfield</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;Successfully read a grid and a mesh and did a regridding of a constant field!&quot;</span>
<span class="k">print</span> <span class="s">&quot;The field values on PET (processor) # {0} are:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ESMF</span><span class="o">.</span><span class="n">local_pet</span><span class="p">())</span>
<span class="k">print</span> <span class="n">dstfield</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="field-regridding-tools">
<h3>Field Regridding Tools<a class="headerlink" href="#field-regridding-tools" title="Permalink to this headline">¶</a></h3>
<p>The following tutorials will show you how to build all of the pieces
necessary to regrid data between Fields built on Grids and Meshes.</p>
<div class="section" id="create-a-2d-grid">
<h4>Create a 2D Grid<a class="headerlink" href="#create-a-2d-grid" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">grid_create</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">domask</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">doarea</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    PRECONDITIONS: &#39;bounds&#39; contains the number of indices required for the </span>
<span class="sd">                   two dimensions of a 2D Grid.  &#39;coords&#39; contains the </span>
<span class="sd">                   upper and lower coordinate bounds of the Grid.  &#39;domask&#39; </span>
<span class="sd">                   is a boolean value that gives the option to put a mask </span>
<span class="sd">                   on this Grid.  &#39;doarea&#39; is an option to create user </span>
<span class="sd">                   defined areas on this Grid. \n</span>
<span class="sd">    POSTCONDITIONS: A 2D Grid has been created.</span>
<span class="sd">    RETURN VALUES: \n Grid :: grid \n</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">lb_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">lb_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ub_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">ub_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">min_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">min_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">max_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">max_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">cellwidth_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_x</span><span class="o">-</span><span class="n">min_x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ub_x</span><span class="o">-</span><span class="n">lb_x</span><span class="p">)</span>
    <span class="n">cellwidth_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_y</span><span class="o">-</span><span class="n">min_y</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ub_y</span><span class="o">-</span><span class="n">lb_y</span><span class="p">)</span>
    
    <span class="n">cellcenter_x</span> <span class="o">=</span> <span class="n">cellwidth_x</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">cellcenter_y</span> <span class="o">=</span> <span class="n">cellwidth_y</span><span class="o">/</span><span class="mi">2</span>
    
    <span class="n">max_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ub_x</span><span class="p">,</span><span class="n">ub_y</span><span class="p">])</span>

    <span class="n">grid</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">max_index</span><span class="p">,</span> <span class="n">coord_sys</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">CoordSys</span><span class="o">.</span><span class="n">CART</span><span class="p">)</span>

    <span class="c">##     CORNERS</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">add_coords</span><span class="p">(</span><span class="n">staggerloc</span><span class="o">=</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER</span><span class="p">])</span>

    <span class="c"># get the coordinate pointers and set the coordinates</span>
    <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">gridCorner</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">gridCorner</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">x</span><span class="p">]):</span>
        <span class="n">gridCorner</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">cellwidth_x</span> <span class="o">+</span> \
            <span class="n">min_x</span> <span class="o">+</span> <span class="n">grid</span><span class="o">.</span><span class="n">lower_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="n">cellwidth_x</span>
            <span class="c"># last line is the pet specific starting point for this stagger and dim</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">gridCorner</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">y</span><span class="p">]):</span>
        <span class="n">gridCorner</span><span class="p">[</span><span class="n">y</span><span class="p">][:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">cellwidth_y</span> <span class="o">+</span> \
            <span class="n">min_y</span> <span class="o">+</span> <span class="n">grid</span><span class="o">.</span><span class="n">lower_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">*</span> <span class="n">cellwidth_y</span>
            <span class="c"># last line is the pet specific starting point for this stagger and dim</span>

    <span class="c">##     CENTERS</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">add_coords</span><span class="p">(</span><span class="n">staggerloc</span><span class="o">=</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">])</span>

    <span class="c"># get the coordinate pointers and set the coordinates</span>
    <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">gridXCenter</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">)</span>
    <span class="n">gridYCenter</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">gridXCenter</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">x</span><span class="p">]):</span>
        <span class="n">gridXCenter</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">cellwidth_x</span> <span class="o">+</span> <span class="n">cellwidth_x</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> \
            <span class="n">min_x</span> <span class="o">+</span> <span class="n">grid</span><span class="o">.</span><span class="n">lower_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="n">cellwidth_x</span>
            <span class="c"># last line is the pet specific starting point for this stagger and dim</span>
 
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">gridYCenter</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">y</span><span class="p">]):</span>
        <span class="n">gridYCenter</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">cellwidth_y</span> <span class="o">+</span> <span class="n">cellwidth_y</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> \
            <span class="n">min_y</span> <span class="o">+</span> <span class="n">grid</span><span class="o">.</span><span class="n">lower_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">*</span> <span class="n">cellwidth_y</span>
            <span class="c"># last line is the pet specific starting point for this stagger and dim</span>

    <span class="k">if</span> <span class="n">domask</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">ESMF</span><span class="o">.</span><span class="n">GridItem</span><span class="o">.</span><span class="n">MASK</span><span class="p">)</span>
        <span class="n">mask</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="mf">1.75</span> <span class="o">&lt;=</span> <span class="n">gridXCenter</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mf">2.25</span><span class="p">)</span> <span class="o">&amp;</span>
                      <span class="p">(</span><span class="mf">1.75</span> <span class="o">&lt;=</span> <span class="n">gridYCenter</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mf">2.25</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">0</span>
        

    <span class="k">if</span> <span class="n">doarea</span><span class="p">:</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">ESMF</span><span class="o">.</span><span class="n">GridItem</span><span class="o">.</span><span class="n">AREA</span><span class="p">)</span>
    
        <span class="n">area</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">ESMF</span><span class="o">.</span><span class="n">GridItem</span><span class="o">.</span><span class="n">AREA</span><span class="p">)</span>
    
        <span class="n">area</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">5.0</span>

    <span class="k">return</span> <span class="n">grid</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="create-a-3d-grid">
<h4>Create a 3D Grid<a class="headerlink" href="#create-a-3d-grid" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">grid_create_3d</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">domask</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">doarea</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    PRECONDITIONS: &#39;bounds&#39; contains the number of indices required for the </span>
<span class="sd">                   two dimensions of a 2D Grid.  &#39;coords&#39; contains the </span>
<span class="sd">                   upper and lower coordinate bounds of the Grid.  &#39;domask&#39; </span>
<span class="sd">                   is a boolean value that gives the option to put a mask </span>
<span class="sd">                   on this Grid.  &#39;doarea&#39; is an option to create user </span>
<span class="sd">                   defined areas on this Grid. \n</span>
<span class="sd">    POSTCONDITIONS: A Grid has been created.</span>
<span class="sd">    RETURN VALUES: \n Grid :: grid \n</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">lb_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">lb_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">lb_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">ub_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">ub_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">ub_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

    <span class="n">min_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">min_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">min_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">max_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">max_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">max_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

    <span class="n">cellwidth_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_x</span><span class="o">-</span><span class="n">min_x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ub_x</span><span class="o">-</span><span class="n">lb_x</span><span class="p">)</span>
    <span class="n">cellwidth_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_y</span><span class="o">-</span><span class="n">min_y</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ub_y</span><span class="o">-</span><span class="n">lb_y</span><span class="p">)</span>
    <span class="n">cellwidth_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_z</span><span class="o">-</span><span class="n">min_z</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ub_z</span><span class="o">-</span><span class="n">lb_z</span><span class="p">)</span>
    
    <span class="n">cellcenter_x</span> <span class="o">=</span> <span class="n">cellwidth_x</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">cellcenter_y</span> <span class="o">=</span> <span class="n">cellwidth_y</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">cellcenter_z</span> <span class="o">=</span> <span class="n">cellwidth_z</span><span class="o">/</span><span class="mi">2</span>
    
    <span class="n">max_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ub_x</span><span class="p">,</span><span class="n">ub_y</span><span class="p">,</span><span class="n">ub_z</span><span class="p">])</span>

    <span class="n">grid</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">max_index</span><span class="p">,</span> <span class="n">coord_sys</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">CoordSys</span><span class="o">.</span><span class="n">CART</span><span class="p">)</span>

    <span class="c">##     CORNERS</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">add_coords</span><span class="p">(</span><span class="n">staggerloc</span><span class="o">=</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER_VFACE</span><span class="p">])</span>

    <span class="c"># get the coordinate pointers and set the coordinates</span>
    <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">gridCorner</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER_VFACE</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">gridCorner</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">x</span><span class="p">]):</span>
        <span class="n">gridCorner</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">cellwidth_x</span> <span class="o">+</span> \
            <span class="n">min_x</span> <span class="o">+</span> <span class="n">grid</span><span class="o">.</span><span class="n">lower_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER_VFACE</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="n">cellwidth_x</span>
            <span class="c"># last line is the pet specific starting point for this stagger and dim</span>
 
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">gridCorner</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">y</span><span class="p">]):</span>
        <span class="n">gridCorner</span><span class="p">[</span><span class="n">y</span><span class="p">][:,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">cellwidth_y</span> <span class="o">+</span> \
            <span class="n">min_y</span> <span class="o">+</span> <span class="n">grid</span><span class="o">.</span><span class="n">lower_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER_VFACE</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">*</span> <span class="n">cellwidth_y</span>
            <span class="c"># last line is the pet specific starting point for this stagger and dim</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">gridCorner</span><span class="p">[</span><span class="n">z</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">z</span><span class="p">]):</span>
        <span class="n">gridCorner</span><span class="p">[</span><span class="n">z</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">cellwidth_z</span> <span class="o">+</span> \
            <span class="n">min_z</span> <span class="o">+</span> <span class="n">grid</span><span class="o">.</span><span class="n">lower_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER_VFACE</span><span class="p">][</span><span class="n">z</span><span class="p">]</span> <span class="o">*</span> <span class="n">cellwidth_z</span>
            <span class="c"># last line is the pet specific starting point for this stagger and dim</span>

    <span class="c">##     CENTERS</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">add_coords</span><span class="p">(</span><span class="n">staggerloc</span><span class="o">=</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER_VCENTER</span><span class="p">])</span>

    <span class="c"># get the coordinate pointers and set the coordinates</span>
    <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">gridXCenter</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER_VCENTER</span><span class="p">)</span>
    <span class="n">gridYCenter</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER_VCENTER</span><span class="p">)</span>
    <span class="n">gridZCenter</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER_VCENTER</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">gridXCenter</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">x</span><span class="p">]):</span>
        <span class="n">gridXCenter</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">cellwidth_x</span> <span class="o">+</span> <span class="n">cellwidth_x</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> \
            <span class="n">min_x</span> <span class="o">+</span> <span class="n">grid</span><span class="o">.</span><span class="n">lower_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER_VCENTER</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="n">cellwidth_x</span>
            <span class="c"># last line is the pet specific starting point for this stagger and dim</span>
 
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">gridYCenter</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">y</span><span class="p">]):</span>
        <span class="n">gridYCenter</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">cellwidth_y</span> <span class="o">+</span> <span class="n">cellwidth_y</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> \
            <span class="n">min_y</span> <span class="o">+</span> <span class="n">grid</span><span class="o">.</span><span class="n">lower_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER_VCENTER</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">*</span> <span class="n">cellwidth_y</span>
            <span class="c"># last line is the pet specific starting point for this stagger and dim</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">gridZCenter</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">z</span><span class="p">]):</span>
        <span class="n">gridZCenter</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">cellwidth_z</span> <span class="o">+</span> <span class="n">cellwidth_z</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> \
            <span class="n">min_z</span> <span class="o">+</span> <span class="n">grid</span><span class="o">.</span><span class="n">lower_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER_VCENTER</span><span class="p">][</span><span class="n">z</span><span class="p">]</span> <span class="o">*</span> <span class="n">cellwidth_z</span>
            <span class="c"># last line is the pet specific starting point for this stagger and dim</span>

    <span class="k">if</span> <span class="n">domask</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">ESMF</span><span class="o">.</span><span class="n">GridItem</span><span class="o">.</span><span class="n">MASK</span><span class="p">)</span>
        <span class="n">mask</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="mf">1.75</span> <span class="o">&lt;</span> <span class="n">gridXCenter</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mf">2.25</span><span class="p">)</span> <span class="o">&amp;</span>
                      <span class="p">(</span><span class="mf">1.75</span> <span class="o">&lt;</span> <span class="n">gridYCenter</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mf">2.25</span><span class="p">)</span> <span class="o">&amp;</span>
                      <span class="p">(</span><span class="mf">1.75</span> <span class="o">&lt;</span> <span class="n">gridZCenter</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mf">2.25</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">doarea</span><span class="p">:</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">ESMF</span><span class="o">.</span><span class="n">GridItem</span><span class="o">.</span><span class="n">AREA</span><span class="p">)</span>
    
        <span class="n">area</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">ESMF</span><span class="o">.</span><span class="n">GridItem</span><span class="o">.</span><span class="n">AREA</span><span class="p">)</span>
    
        <span class="n">area</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">5.0</span>

    <span class="k">return</span> <span class="n">grid</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="create-a-periodic-grid">
<h4>Create a periodic Grid<a class="headerlink" href="#create-a-periodic-grid" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">grid_create_periodic</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">domask</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    PRECONDITIONS: &#39;bounds&#39; contains the number of indices required for the first two </span>
<span class="sd">                   dimensions of a periodic Grid.  &#39;domask&#39; is a boolean value </span>
<span class="sd">                   that gives the option to put a mask on this Grid.\n</span>
<span class="sd">    POSTCONDITIONS: A periodic Grid has been created.\n</span>
<span class="sd">    RETURN VALUES: \n Grid :: grid \n</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">nx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ny</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">dx</span> <span class="o">=</span> <span class="mf">360.0</span><span class="o">/</span><span class="n">nx</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="mf">180.0</span><span class="o">/</span><span class="n">ny</span>

    <span class="n">DEG2RAD</span> <span class="o">=</span> <span class="mf">3.141592653589793</span><span class="o">/</span><span class="mf">180.0</span>

    <span class="n">max_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">])</span>

    <span class="n">staggerLocs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER</span><span class="p">,</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">]</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">max_index</span><span class="p">,</span> <span class="n">num_peri_dims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">staggerLocs</span><span class="p">)</span>

    <span class="c"># VM</span>
    <span class="n">vm</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">ESMP_VMGetGlobal</span><span class="p">()</span>
    <span class="n">localPet</span><span class="p">,</span> <span class="n">petCount</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">ESMP_VMGet</span><span class="p">(</span><span class="n">vm</span><span class="p">)</span>

 <span class="c"># get the coordinate pointers and set the coordinates</span>
    <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">gridXCorner</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER</span><span class="p">)</span>
    <span class="n">gridYCorner</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER</span><span class="p">)</span>

    <span class="c"># make an array that holds indices from lower_bounds to upper_bounds</span>
    <span class="n">bnd2indX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">lower_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                         <span class="n">grid</span><span class="o">.</span><span class="n">upper_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER</span><span class="p">][</span><span class="n">x</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">bnd2indY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">lower_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                         <span class="n">grid</span><span class="o">.</span><span class="n">upper_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER</span><span class="p">][</span><span class="n">y</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">gridXCorner</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">x</span><span class="p">]):</span>
        <span class="n">gridXCorner</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bnd2indX</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">dx</span> <span class="o">-</span> <span class="mf">180.0</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">gridYCorner</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">y</span><span class="p">]):</span>
        <span class="n">gridYCorner</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bnd2indY</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">*</span><span class="n">dy</span> <span class="o">-</span> <span class="mf">90.0</span>

    <span class="c">##     CENTERS</span>

    <span class="c"># get the coordinate pointers and set the coordinates</span>
    <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">gridXCenter</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">)</span>
    <span class="n">gridYCenter</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">)</span>

    <span class="c"># make an array that holds indices from lower_bounds to upper_bounds</span>
    <span class="n">bnd2indX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">lower_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                         <span class="n">grid</span><span class="o">.</span><span class="n">upper_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">][</span><span class="n">x</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">bnd2indY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">lower_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">][</span><span class="n">y</span><span class="p">],</span>
                         <span class="n">grid</span><span class="o">.</span><span class="n">upper_bounds</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">][</span><span class="n">y</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">gridXCenter</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">x</span><span class="p">]):</span>
        <span class="n">gridXCenter</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bnd2indX</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span> <span class="o">-</span> <span class="mf">180.0</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">gridYCenter</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">y</span><span class="p">]):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bnd2indY</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">*</span><span class="n">dy</span> <span class="o">-</span> <span class="mf">90.0</span><span class="p">)</span>
        <span class="n">yp1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bnd2indY</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dy</span> <span class="o">-</span> <span class="mf">90.0</span><span class="p">)</span>
        <span class="n">gridYCenter</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="n">yp1</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>

    <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">domask</span><span class="p">:</span>
        <span class="c"># set up the grid mask</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">ESMF</span><span class="o">.</span><span class="n">GridItem</span><span class="o">.</span><span class="n">MASK</span><span class="p">)</span>
        <span class="n">mask</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="mf">175.</span> <span class="o">&lt;</span> <span class="n">gridXCenter</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mf">185.</span><span class="p">)</span> <span class="o">&amp;</span>
                      <span class="p">(</span><span class="o">-</span><span class="mf">5.</span> <span class="o">&lt;</span> <span class="n">gridYCenter</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mf">5.</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">grid</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="create-a-5-element-mesh">
<h4>Create a 5 element Mesh<a class="headerlink" href="#create-a-5-element-mesh" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">mesh_create_5</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    PRECONDITIONS: None</span>
<span class="sd">    POSTCONDITIONS: A 5 element Mesh has been created.    </span>
<span class="sd">    RETURN VALUES: \n Mesh :: mesh \n</span>
<span class="sd">    </span>
<span class="sd">      4.0   31 ------ 32 ------ 33</span>
<span class="sd">            |         |  22  /   |</span>
<span class="sd">            |    21   |     /    |</span>
<span class="sd">            |         |   /  23  |</span>
<span class="sd">      2.0   21 ------ 22 ------ 23</span>
<span class="sd">            |         |          |</span>
<span class="sd">            |    11   |    12    |</span>
<span class="sd">            |         |          |</span>
<span class="sd">      0.0   11 ------ 12 ------ 13</span>
<span class="sd">    </span>
<span class="sd">           0.0       2.0        4.0</span>
<span class="sd">    </span>
<span class="sd">          Node Ids at corners</span>
<span class="sd">          Element Ids in centers</span>
<span class="sd">    </span>
<span class="sd">    Note: This mesh is not parallel, it can only be used in serial</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># Two parametric dimensions, and two spatial dimensions</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span><span class="n">parametric_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">spatial_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">num_node</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">num_elem</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">nodeId</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">33</span><span class="p">])</span>
    <span class="n">nodeCoord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c"># node 11</span>
                          <span class="mf">2.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c"># node 12</span>
                          <span class="mf">4.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c"># node 13</span>
                          <span class="mf">0.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span>  <span class="c"># node 21</span>
                          <span class="mf">2.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span>  <span class="c"># node 22</span>
                          <span class="mf">4.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span>  <span class="c"># node 23</span>
                          <span class="mf">0.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">,</span>  <span class="c"># node 31</span>
                          <span class="mf">2.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">,</span>  <span class="c"># node 32</span>
                          <span class="mf">4.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">])</span> <span class="c"># node 33</span>
    <span class="n">nodeOwner</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_node</span><span class="p">)</span>

    <span class="n">elemId</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">])</span>
    <span class="n">elemType</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ESMF</span><span class="o">.</span><span class="n">MeshElemType</span><span class="o">.</span><span class="n">QUAD</span><span class="p">,</span>
                       <span class="n">ESMF</span><span class="o">.</span><span class="n">MeshElemType</span><span class="o">.</span><span class="n">QUAD</span><span class="p">,</span>
                       <span class="n">ESMF</span><span class="o">.</span><span class="n">MeshElemType</span><span class="o">.</span><span class="n">QUAD</span><span class="p">,</span>
                       <span class="n">ESMF</span><span class="o">.</span><span class="n">MeshElemType</span><span class="o">.</span><span class="n">TRI</span><span class="p">,</span>
                       <span class="n">ESMF</span><span class="o">.</span><span class="n">MeshElemType</span><span class="o">.</span><span class="n">TRI</span><span class="p">])</span>
    <span class="n">elemConn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="c"># element 11</span>
                       <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="c"># element 12</span>
                       <span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span> <span class="c"># element 21</span>
                       <span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span>   <span class="c"># element 22</span>
                       <span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>  <span class="c"># element 23</span>

    <span class="n">mesh</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="n">num_node</span><span class="p">,</span><span class="n">nodeId</span><span class="p">,</span><span class="n">nodeCoord</span><span class="p">,</span><span class="n">nodeOwner</span><span class="p">)</span>

    <span class="n">mesh</span><span class="o">.</span><span class="n">add_elements</span><span class="p">(</span><span class="n">num_elem</span><span class="p">,</span><span class="n">elemId</span><span class="p">,</span><span class="n">elemType</span><span class="p">,</span><span class="n">elemConn</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">nodeCoord</span><span class="p">,</span> <span class="n">nodeOwner</span><span class="p">,</span> <span class="n">elemType</span><span class="p">,</span> <span class="n">elemConn</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="create-a-field">
<h4>Create a Field<a class="headerlink" href="#create-a-field" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">create_field</span><span class="p">(</span><span class="n">grid_or_mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    PRECONDITIONS: An Grid or Mesh has been created, and &#39;name&#39; is a string that</span>
<span class="sd">                   will be used to initialize the name of a new Field.\n</span>
<span class="sd">    POSTCONDITIONS: A Field has been created.\n</span>
<span class="sd">    RETURN VALUES: \n Field :: field \n</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">grid_or_mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">field</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="initialize-an-analytic-field">
<h4>Initialize an analytic Field<a class="headerlink" href="#initialize-an-analytic-field" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">initialize_field_grid_periodic</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    PRECONDITIONS: A Field has been created as &#39;field&#39; with a &#39;grid&#39;</span>
<span class="sd">                   where coordinates have been set on both </span>
<span class="sd">                   the center and corner stagger locations. \n</span>
<span class="sd">    POSTCONDITIONS: The &#39;field&#39; has been initialized to an analytic </span>
<span class="sd">                    field.\n</span>
<span class="sd">    RETURN VALUES: \n Field :: field \n</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">DEG2RAD</span> <span class="o">=</span> <span class="mf">3.141592653589793</span><span class="o">/</span><span class="mf">180.0</span>

    <span class="c"># get the coordinate pointers and set the coordinates</span>
    <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">gridXCoord</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">)</span>
    <span class="n">gridYCoord</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">)</span>

    <span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">DEG2RAD</span><span class="o">*</span><span class="n">gridXCoord</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> \
                          <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">DEG2RAD</span><span class="o">*</span><span class="p">(</span><span class="mf">90.0</span> <span class="o">-</span> <span class="n">gridYCoord</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">field</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="run-esmpy-regridding">
<h4>Run ESMPy regridding<a class="headerlink" href="#run-esmpy-regridding" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">run_regridding</span><span class="p">(</span><span class="n">srcfield</span><span class="p">,</span> <span class="n">dstfield</span><span class="p">,</span> <span class="n">srcfracfield</span><span class="p">,</span> <span class="n">dstfracfield</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    PRECONDITIONS: Two Fields have been created and a regridding </span>
<span class="sd">                   operation is desired from &#39;srcfield&#39; to &#39;dstfield&#39;.  </span>
<span class="sd">                   The &#39;srcfracfield&#39; and &#39;dstfractfield&#39; are Fields </span>
<span class="sd">                   created to hold the fractions of the source and </span>
<span class="sd">                   destination fields which contribute to conservative </span>
<span class="sd">                   regridding.\n</span>
<span class="sd">    POSTCONDITIONS: A regridding operation has set the data on </span>
<span class="sd">                    &#39;dstfield&#39;, &#39;srcfracfield&#39;, and &#39;dstfracfield&#39;.\n</span>
<span class="sd">    RETURN VALUES: \n Field :: dstfield \n </span>
<span class="sd">                      Field :: srcfracfield \n</span>
<span class="sd">                      Field :: dstfracfield \n</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># call the regridding functions</span>
    <span class="n">regridSrc2Dst</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Regrid</span><span class="p">(</span><span class="n">srcfield</span><span class="p">,</span> <span class="n">dstfield</span><span class="p">,</span> \
                                <span class="n">regrid_method</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">RegridMethod</span><span class="o">.</span><span class="n">CONSERVE</span><span class="p">,</span> \
                                <span class="n">unmapped_action</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">UnmappedAction</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> \
                                <span class="n">src_frac_field</span><span class="o">=</span><span class="n">srcfracfield</span><span class="p">,</span> \
                                <span class="n">dst_frac_field</span><span class="o">=</span><span class="n">dstfracfield</span><span class="p">)</span>
    <span class="n">dstfield</span> <span class="o">=</span> <span class="n">regridSrc2Dst</span><span class="p">(</span><span class="n">srcfield</span><span class="p">,</span> <span class="n">dstfield</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dstfield</span><span class="p">,</span> <span class="n">srcfracfield</span><span class="p">,</span> <span class="n">dstfracfield</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="compute-field-mass">
<h4>Compute Field mass<a class="headerlink" href="#compute-field-mass" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">compute_mass_grid</span><span class="p">(</span><span class="n">valuefield</span><span class="p">,</span> <span class="n">areafield</span><span class="p">,</span> <span class="n">dofrac</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">fracfield</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">uninitval</span><span class="o">=</span><span class="mf">422397696.</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    PRECONDITIONS: Two Fields have been created and initialized.  </span>
<span class="sd">                   &#39;valuefield&#39; contains data values of a field built </span>
<span class="sd">                   on the cells of a grid, &#39;areafield&#39; contains the </span>
<span class="sd">                   areas associated with the grid cells, and </span>
<span class="sd">                   &#39;fracfield&#39; contains the fractions of each cell </span>
<span class="sd">                   which contributed to a regridding operation involving</span>
<span class="sd">                   &#39;valuefield.  &#39;dofrac&#39; is a boolean value that gives </span>
<span class="sd">                   the option to not use the &#39;fracfield&#39;.\n</span>
<span class="sd">    POSTCONDITIONS: The mass of the data field is computed.\n</span>
<span class="sd">    RETURN VALUES: float :: mass \n</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mass</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">areafield</span><span class="o">.</span><span class="n">get_area</span><span class="p">()</span>

    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">valuefield</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="n">uninitval</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dofrac</span><span class="p">:</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">areafield</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">*</span> <span class="n">valuefield</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">*</span> <span class="n">fracfield</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">areafield</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">*</span> <span class="n">valuefield</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">mass</span>
</pre></div>
</div>
</div></blockquote>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>[1] Khoei S.A. Gharehbaghi A, R.
The superconvergent patch recovery technique and data transfer operators in 3d
plasticity problems.
Finite Elements in Analysis and Design, 43(8), 2007.</p>
<p>[2] K.C. Hung H. Gu, Z. Zong.
A modified superconvergent patch recovery method and its application to large
deformation problems.
Finite Elements in Analysis and Design, 40(5-6), 2004.</p>
<p>[3] D. Ramshaw.
Conservative rezoning algorithm for generalized two-dimensional meshes.
Journal of Computational Physics, 59, 1985.</p>
<p>[4] Jones, P.W.
SCRIP: A Spherical Coordinate Remapping and Interpolation Package.
<a class="reference external" href="http://www.acl.lanl.gov/climate/software/SCRIP/">http://www.acl.lanl.gov/climate/software/SCRIP/</a>.
Los Alamos National Laboratory Software Release LACC 98-45.</p>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><em>Module Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">ESMPy</a><ul>
<li><a class="reference internal" href="#module-ESMF">Introduction</a></li>
<li><a class="reference internal" href="#getting-the-code">Getting the code</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#use">Use</a></li>
<li><a class="reference internal" href="#validation">Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#limitations">Limitations</a></li>
<li><a class="reference internal" href="#create-a-grid-or-mesh-from-file">Create a Grid or Mesh From File</a><ul>
<li><a class="reference internal" href="#file-formats">File Formats</a><ul>
<li><a class="reference internal" href="#scrip">SCRIP</a></li>
<li><a class="reference internal" href="#esmf">ESMF</a></li>
<li><a class="reference internal" href="#gridspec">GRIDSPEC</a></li>
<li><a class="reference internal" href="#ugrid">UGRID</a></li>
</ul>
</li>
<li><a class="reference internal" href="#meshes-from-file">Meshes From File</a></li>
<li><a class="reference internal" href="#grids-from-file">Grids From File</a></li>
</ul>
</li>
<li><a class="reference internal" href="#field-regridding">Field regridding</a><ul>
<li><a class="reference internal" href="#regridding-methods">Regridding methods</a><ul>
<li><a class="reference internal" href="#bilinear">Bilinear</a></li>
<li><a class="reference internal" href="#higher-order-patch-recovery">Higher order patch recovery</a></li>
<li><a class="reference internal" href="#first-order-conservative">First-order conservative</a></li>
</ul>
</li>
<li><a class="reference internal" href="#masking">Masking</a></li>
<li><a class="reference internal" href="#spherical-coordinates">Spherical coordinates</a></li>
<li><a class="reference internal" href="#unmapped-points">Unmapped points</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interface">Interface</a><ul>
<li><a class="reference internal" href="#classes">Classes</a></li>
<li><a class="reference internal" href="#named-constants">Named constants</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tutorials">Tutorials</a><ul>
<li><a class="reference internal" href="#script-examples">Script examples</a><ul>
<li><a class="reference internal" href="#hello-world">Hello World</a></li>
<li><a class="reference internal" href="#grid-create-from-file">Grid Create From File</a></li>
<li><a class="reference internal" href="#mesh-create-from-file">Mesh Create From File</a></li>
<li><a class="reference internal" href="#grid-mesh-regrid">Grid Mesh Regrid</a></li>
</ul>
</li>
<li><a class="reference internal" href="#field-regridding-tools">Field Regridding Tools</a><ul>
<li><a class="reference internal" href="#create-a-2d-grid">Create a 2D Grid</a></li>
<li><a class="reference internal" href="#create-a-3d-grid">Create a 3D Grid</a></li>
<li><a class="reference internal" href="#create-a-periodic-grid">Create a periodic Grid</a></li>
<li><a class="reference internal" href="#create-a-5-element-mesh">Create a 5 element Mesh</a></li>
<li><a class="reference internal" href="#create-a-field">Create a Field</a></li>
<li><a class="reference internal" href="#initialize-an-analytic-field">Initialize an analytic Field</a></li>
<li><a class="reference internal" href="#run-esmpy-regridding">Run ESMPy regridding</a></li>
<li><a class="reference internal" href="#compute-field-mass">Compute Field mass</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="#">ESMPy ESMF_6_3_0rp1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2014, University Corporation for Atmospheric Research, Massachusetts Institute of Technology, Geophysical Fluid Dynamics Laboratory, University of Michigan, National Centers for Environmental Prediction, Los Alamos National Laboratory, Argonne National Laboratory, NASA Goddard Space Flight Center.  Licensed under the University of Illinois-NCSA License.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>