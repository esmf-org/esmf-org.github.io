<!DOCTYPE HTML>

<!--Converted with LaTeX2HTML 2025 (Released January 1, 2025) -->
<HTML lang="en">
<HEAD>
<TITLE>5 Infrastructure: Utilities</TITLE>

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="viewport" CONTENT="width=device-width, initial-scale=1.0">
<META NAME="Generator" CONTENT="LaTeX2HTML v2025">

<LINK REL="STYLESHEET" HREF="ESMC_crefdoc.css">

<LINK REL="next" HREF="node7.html">
<LINK REL="previous" HREF="node5.html">
<LINK REL="next" HREF="node7.html">
</HEAD>

<BODY BGCOLOR=white LINK=#083194 VLINK=#21004A>

<DIV CLASS="navigation"><!--Navigation Panel-->
<A
 HREF="node7.html">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A
 HREF="ESMC_crefdoc.html">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="node5.html">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A> 
<A ID="tex2html464"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A
 HREF="node7.html">6 References</A>
<B> Up:</B> <A
 HREF="ESMC_crefdoc.html">ESMC_crefdoc</A>
<B> Previous:</B> <A
 HREF="node5.html">4 Infrastructure: Fields and Grids</A>
 &nbsp; <B>  <A ID="tex2html465"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A ID="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL CLASS="ChildLinks">
<LI><UL>
<LI><A ID="tex2html466"
  HREF="node6.html#SECTION06010000000000000000"><SPAN CLASS="arabic">24</SPAN> Overview of Infrastructure Utility Classes</A>
<LI><A ID="tex2html467"
  HREF="node6.html#SECTION06020000000000000000"><SPAN CLASS="arabic">25</SPAN> Time Manager Utility</A>
<UL>
<LI><A ID="tex2html468"
  HREF="node6.html#SECTION06021000000000000000"><SPAN CLASS="arabic">25</SPAN>.<SPAN CLASS="arabic">1</SPAN> Time Manager Classes</A>
<LI><A ID="tex2html469"
  HREF="node6.html#SECTION06022000000000000000"><SPAN CLASS="arabic">25</SPAN>.<SPAN CLASS="arabic">2</SPAN> Calendar</A>
<LI><A ID="tex2html470"
  HREF="node6.html#SECTION06023000000000000000"><SPAN CLASS="arabic">25</SPAN>.<SPAN CLASS="arabic">3</SPAN> Time Instants and TimeIntervals</A>
<LI><A ID="tex2html471"
  HREF="node6.html#SECTION06024000000000000000"><SPAN CLASS="arabic">25</SPAN>.<SPAN CLASS="arabic">4</SPAN> Clocks</A>
</UL>
<LI><A ID="tex2html472"
  HREF="node6.html#SECTION06030000000000000000"><SPAN CLASS="arabic">26</SPAN> Calendar Class</A>
<UL>
<LI><A ID="tex2html473"
  HREF="node6.html#SECTION06031000000000000000"><SPAN CLASS="arabic">26</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
<LI><A ID="tex2html474"
  HREF="node6.html#SECTION06032000000000000000"><SPAN CLASS="arabic">26</SPAN>.<SPAN CLASS="arabic">2</SPAN> Constants</A>
<UL>
<LI><A ID="tex2html475"
  HREF="node6.html#SECTION06032100000000000000"><SPAN CLASS="arabic">26</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> ESMC_CALKIND</A>
</UL>
<LI><A ID="tex2html476"
  HREF="node6.html#SECTION06033000000000000000"><SPAN CLASS="arabic">26</SPAN>.<SPAN CLASS="arabic">3</SPAN> Class API</A>
</UL>
<LI><A ID="tex2html477"
  HREF="node6.html#SECTION06040000000000000000"><SPAN CLASS="arabic">27</SPAN> Time Class</A>
<UL>
<LI><A ID="tex2html478"
  HREF="node6.html#SECTION06041000000000000000"><SPAN CLASS="arabic">27</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
<LI><A ID="tex2html479"
  HREF="node6.html#SECTION06042000000000000000"><SPAN CLASS="arabic">27</SPAN>.<SPAN CLASS="arabic">2</SPAN> Class API</A>
</UL>
<LI><A ID="tex2html480"
  HREF="node6.html#SECTION06050000000000000000"><SPAN CLASS="arabic">28</SPAN> TimeInterval Class</A>
<UL>
<LI><A ID="tex2html481"
  HREF="node6.html#SECTION06051000000000000000"><SPAN CLASS="arabic">28</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
<LI><A ID="tex2html482"
  HREF="node6.html#SECTION06052000000000000000"><SPAN CLASS="arabic">28</SPAN>.<SPAN CLASS="arabic">2</SPAN> Class API</A>
</UL>
<LI><A ID="tex2html483"
  HREF="node6.html#SECTION06060000000000000000"><SPAN CLASS="arabic">29</SPAN> Clock Class</A>
<UL>
<LI><A ID="tex2html484"
  HREF="node6.html#SECTION06061000000000000000"><SPAN CLASS="arabic">29</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
<LI><A ID="tex2html485"
  HREF="node6.html#SECTION06062000000000000000"><SPAN CLASS="arabic">29</SPAN>.<SPAN CLASS="arabic">2</SPAN> Class API</A>
</UL>
<LI><A ID="tex2html486"
  HREF="node6.html#SECTION06070000000000000000"><SPAN CLASS="arabic">30</SPAN> Config Class</A>
<UL>
<LI><A ID="tex2html487"
  HREF="node6.html#SECTION06071000000000000000"><SPAN CLASS="arabic">30</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
<UL>
<LI><A ID="tex2html488"
  HREF="node6.html#SECTION06071100000000000000"><SPAN CLASS="arabic">30</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN> Package history</A>
</UL>
<LI><A ID="tex2html489"
  HREF="node6.html#SECTION06072000000000000000"><SPAN CLASS="arabic">30</SPAN>.<SPAN CLASS="arabic">2</SPAN> Class API</A>
</UL>
<LI><A ID="tex2html490"
  HREF="node6.html#SECTION06080000000000000000"><SPAN CLASS="arabic">31</SPAN> Log Class</A>
<UL>
<LI><A ID="tex2html491"
  HREF="node6.html#SECTION06081000000000000000"><SPAN CLASS="arabic">31</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
<LI><A ID="tex2html492"
  HREF="node6.html#SECTION06082000000000000000"><SPAN CLASS="arabic">31</SPAN>.<SPAN CLASS="arabic">2</SPAN> Constants</A>
<UL>
<LI><A ID="tex2html493"
  HREF="node6.html#SECTION06082100000000000000"><SPAN CLASS="arabic">31</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> ESMC_LOGKIND</A>
<LI><A ID="tex2html494"
  HREF="node6.html#SECTION06082200000000000000"><SPAN CLASS="arabic">31</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN> ESMC_LOGMSG</A>
</UL>
<LI><A ID="tex2html495"
  HREF="node6.html#SECTION06083000000000000000"><SPAN CLASS="arabic">31</SPAN>.<SPAN CLASS="arabic">3</SPAN> Class API</A>
</UL>
<LI><A ID="tex2html496"
  HREF="node6.html#SECTION06090000000000000000"><SPAN CLASS="arabic">32</SPAN> VM Class</A>
<UL>
<LI><A ID="tex2html497"
  HREF="node6.html#SECTION06091000000000000000"><SPAN CLASS="arabic">32</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
<LI><A ID="tex2html498"
  HREF="node6.html#SECTION06092000000000000000"><SPAN CLASS="arabic">32</SPAN>.<SPAN CLASS="arabic">2</SPAN> Class API</A>
</UL>
<LI><A ID="tex2html499"
  HREF="node6.html#SECTION060100000000000000000"><SPAN CLASS="arabic">33</SPAN> Profiling and Tracing</A>
<UL>
<LI><A ID="tex2html500"
  HREF="node6.html#SECTION060101000000000000000"><SPAN CLASS="arabic">33</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
<UL>
<LI><A ID="tex2html501"
  HREF="node6.html#SECTION060101100000000000000"><SPAN CLASS="arabic">33</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN> Profiling</A>
<LI><A ID="tex2html502"
  HREF="node6.html#SECTION060101200000000000000"><SPAN CLASS="arabic">33</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN> Tracing</A>
</UL>
<LI><A ID="tex2html503"
  HREF="node6.html#SECTION060102000000000000000"><SPAN CLASS="arabic">33</SPAN>.<SPAN CLASS="arabic">2</SPAN> Restrictions and Future Work</A>
<LI><A ID="tex2html504"
  HREF="node6.html#SECTION060103000000000000000"><SPAN CLASS="arabic">33</SPAN>.<SPAN CLASS="arabic">3</SPAN> Class API</A>
</UL></UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A ID="SECTION06000000000000000000">
<SPAN CLASS="arabic">5</SPAN> Infrastructure: Utilities</A>
</H1>
<P>

<H1><A ID="SECTION06010000000000000000">
<SPAN CLASS="arabic">24</SPAN> Overview of Infrastructure Utility Classes</A>
</H1>

<P>
The ESMF utilities are a set of tools for quickly assembling modeling applications.

<P>
The Time Management Library provides utilities for time and time interval representation, as well as a higher-level utility, a clock, that controls model time stepping.

<P>
The ESMF Config class provides configuration management based on NASA DAO's Inpak package, a collection of methods for accessing files containing input parameters stored in an ASCII format.

<P>
The ESMF LogErr class consists of a method for writing error, warning, and informational messages to a default Log file that is created during ESMF initialization.

<P>
The ESMF VM (Virtual Machine) class provides methods for querying information about a VM. A VM is a generic representation of hardware and system software resources. There is exactly one VM object per ESMF Component, providing the execution environment for the Component code. The VM class handles all resource management tasks for the Component class and provides a description of the underlying configuration of the compute resources used by a Component.  In addition to resource description and management, the VM class offers the lowest level of ESMF communication methods.

<H1><A ID="SECTION06020000000000000000">
<SPAN CLASS="arabic">25</SPAN> Time Manager Utility</A>
</H1>

<P>
The ESMF Time Manager utility includes software for time and time interval 
representation, as well as model time advancement. Since multi-component 
geophysical applications often require synchronization across 
the time management schemes of the individual components, the 
Time Manager's standard calendars and consistent time representation 
promote component interoperability.
<DIV class="CENTER">
<TABLE class="PAD  BORDER" style="">
<TR><TD CLASS="LEFT TOP"  WIDTH=553>
<BR>
<B>Key Features</B></TD>
</TR>
<TR><TD CLASS="LEFT TOP"  WIDTH=553>Drift-free timekeeping through an integer-based internal time 
representation.  Both integers and reals can be specified at the interface.</TD>
</TR>
<TR><TD CLASS="LEFT TOP"  WIDTH=553>Support for many calendar kinds.</TD>
</TR>
<TR><TD CLASS="LEFT TOP"  WIDTH=553>Support for both concurrent and sequential modes of component execution.</TD>
</TR>
</TABLE>
</DIV>

<P>

<H2><A ID="SECTION06021000000000000000">
<SPAN CLASS="arabic">25</SPAN>.<SPAN CLASS="arabic">1</SPAN> Time Manager Classes</A>
</H2>
There are four ESMF classes that represent time concepts:

<UL>
<LI><B>Calendar</B>  A Calendar can be used to keep track of the 
date as an ESMF Gridded Component advances in time. Standard calendars 
(such as Gregorian and 360-day) are supported. 
</LI>
<LI><B>Time</B> A Time represents a time instant in a particular 
calendar, such as November 28, 1964, at 7:00pm EST in the Gregorian 
calendar.  The Time class can be used 
to represent the start and stop time of a time integration.
</LI>
<LI><B>TimeInterval</B> TimeIntervals represent a period 
of time, such as 3 hours.  Time steps can be represented 
using TimeIntervals. 
</LI>
<LI><B>Clock</B> Clocks collect the parameters and 
methods used for model time advancement into a convenient 
package.  A Clock can be queried for quantities such 
as current simulation time and time step.  Clock methods 
include incrementing the current time, and printing the its contents.
</LI>
</UL>

<P>

<H2><A ID="SECTION06022000000000000000">
<SPAN CLASS="arabic">25</SPAN>.<SPAN CLASS="arabic">2</SPAN> Calendar</A>
</H2>
The set of supported calendars includes:
<DL>
<DT><STRONG>Gregorian</STRONG></DT>
<DD>The standard Gregorian calendar.
</DD>
<DT><STRONG>no-leap</STRONG></DT>
<DD>The Gregorian calendar with no leap years.
</DD>
<DT><STRONG>Julian</STRONG></DT>
<DD>The standard Julian date calendar.
</DD>
<DT><STRONG>Julian Day</STRONG></DT>
<DD>The standard Julian days calendar.
</DD>
<DT><STRONG>Modified Julian Day</STRONG></DT>
<DD>The Modified Julian days calendar.
</DD>
<DT><STRONG>360-day</STRONG></DT>
<DD>A 30-day-per-month, 12-month-per-year calendar.
</DD>
<DT><STRONG>no calendar</STRONG></DT>
<DD>Tracks only elapsed model time in hours, minutes, seconds.
</DD>
</DL>
See Section&nbsp;<A HREF="#sec:Calendar">26.1</A> for more details on supported standard 
calendars, and how to create a customized ESMF Calendar.

<P>

<H2><A ID="SECTION06023000000000000000"></A>
<A ID="subsec:Time_Instants_and_TimeIntervals"></A>
<BR>
<SPAN CLASS="arabic">25</SPAN>.<SPAN CLASS="arabic">3</SPAN> Time Instants and TimeIntervals
</H2>
TimeIntervals and Time instants (simply called Times) are the computational 
building blocks of the Time Manager utility.  Times support different queries 
for values of individual Time components such as year and hour.
See Sections&nbsp;<A HREF="#sec:Time">27.1</A> and&nbsp;<A HREF="#sec:TimeInterval">28.1</A>, respectively, 
for use of Times and TimeIntervals.

<P>

<H2><A ID="SECTION06024000000000000000">
<SPAN CLASS="arabic">25</SPAN>.<SPAN CLASS="arabic">4</SPAN> Clocks</A>
</H2>
It is useful to identify a higher-level concept to repeatedly step a Time 
forward by a TimeInterval.  We refer to this capability as a Clock, and 
include in its required features the ability to store the start and stop times 
of a model run, and to query the value of quantities such as the current time 
and the number of time steps taken.  Applications may contain 
temporary or multiple Clocks. Section&nbsp;<A HREF="#sec:Clock">29.1</A> describes the use of 
Clocks in detail.

<H1><A ID="SECTION06030000000000000000">
<SPAN CLASS="arabic">26</SPAN> Calendar Class</A>
</H1>

<H2><A ID="SECTION06031000000000000000">
<SPAN CLASS="arabic">26</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
</H2>

<P>
<A ID="sec:Calendar"></A>The Calendar class represents the standard calendars used in 
geophysical modeling:  Gregorian, Julian, Julian Day, Modified Julian Day, 
no-leap, 360-day, and no-calendar.  Brief descriptions are provided for each calendar below.

<H2><A ID="SECTION06032000000000000000">
<SPAN CLASS="arabic">26</SPAN>.<SPAN CLASS="arabic">2</SPAN> Constants</A>
</H2>

<P>
<A ID="subsec:Calendar_options"></A>
<P>

<H3><A ID="SECTION06032100000000000000"></A>
<A ID="const:calkindflag_c"></A>
<BR>
<SPAN CLASS="arabic">26</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> ESMC_CALKIND
</H3>

<P>
<SPAN style="font-family:sans-serif">DESCRIPTION:
<BR></SPAN>
Supported calendar kinds.

<P>
The type of this flag is:

<P>
<SPAN style="font-family:monospace">type(ESMF_CalKind_Flag)</SPAN>

<P>
The valid values are:
<DL>
<DT><STRONG>ESMC_CALKIND_360DAY</STRONG></DT>
<DD><I>Valid range: machine limits</I> 
<BR>
In the 360-day calendar, there are 12 months, each of which has 30 days.  
Like the no-leap calendar, this is a simple approximation to the Gregorian
calendar sometimes used by modelers.

<P>
</DD>
<DT><STRONG>ESMC_CALKIND_GREGORIAN</STRONG></DT>
<DD><I>Valid range: 3/1/4801 BC to 10/29/292,277,019,914 </I>
<BR>
The Gregorian calendar is the calendar currently in use 
throughout Western countries.  Named after Pope Gregory XIII, it is a minor 
correction to the older Julian calendar. In the Gregorian calendar every
fourth year is a leap year in which February has 29 and not 28 days;
however, years divisible by 100 are not leap years unless they are also 
divisible  by 400.  As in the Julian calendar, days begin at midnight.

<P>
</DD>
<DT><STRONG>ESMC_CALKIND_JULIAN</STRONG></DT>
<DD><I>Valid range: 3/1/4713 BC to 4/24/292,271,018,333 </I> 
<BR>
The Julian calendar was introduced by Julius Caesar in 46 B.C., and 
reached its final form in 4 A.D.  The Julian calendar differs from the 
Gregorian only in the determination of leap years, lacking the correction 
for years divisible by 100 and 400 in the Gregorian calendar.  In the Julian 
calendar, any year is a leap year if divisible by 4.  Days are considered to 
begin at midnight.

<P>
</DD>
<DT><STRONG>ESMC_CALKIND_JULIANDAY</STRONG></DT>
<DD><I>Valid range:  +/- 1x10<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.02ex; vertical-align: -0.11ex; " SRC="img12.svg"
 ALT="$^{14}$"></SPAN></I> 
<BR>
Julian days simply enumerate the days and fraction of a day which 
have elapsed since the start of the Julian era, defined as beginning at noon 
on Monday, 1st January of year 4713 B.C. in the Julian calendar.  Julian days, 
unlike the dates in the Julian and Gregorian calendars, begin at noon.

<P>
</DD>
<DT><STRONG>ESMC_CALKIND_MODJULIANDAY</STRONG></DT>
<DD><I>Valid range:  +/- 1x10<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.02ex; vertical-align: -0.11ex; " SRC="img12.svg"
 ALT="$^{14}$"></SPAN></I>
<BR>
The Modified Julian Day (MJD) was introduced by space scientists in
 the late 1950's.  It is defined as an offset from the Julian Day (JD):

<P>
MJD = JD - 2400000.5

<P>
The half day is subtracted so that the day starts at midnight.

<P>
</DD>
<DT><STRONG>ESMC_CALKIND_NOCALENDAR</STRONG></DT>
<DD><I>Valid range: machine limits</I>
<BR>
The no-calendar option simply tracks the elapsed model time in seconds.

<P>
</DD>
<DT><STRONG>ESMC_CALKIND_NOLEAP</STRONG></DT>
<DD><I>Valid range: machine limits</I> 
<BR>
The no-leap calendar is the Gregorian calendar with no leap years - 
February is always assumed to have 28 days.  Modelers sometimes use this 
calendar as a simple, close approximation to the Gregorian calendar.

<P>
</DD>
</DL>
<H2><A ID="SECTION06033000000000000000">
<SPAN CLASS="arabic">26</SPAN>.<SPAN CLASS="arabic">3</SPAN> Class API</A>
</H2>

<H1><A ID="SECTION06040000000000000000">
<SPAN CLASS="arabic">27</SPAN> Time Class</A>
</H1>

<H2><A ID="SECTION06041000000000000000"></A>
<A ID="sec:Time"></A>
<BR>
<SPAN CLASS="arabic">27</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description
</H2>

<P>
A Time represents a specific point in time.

<P>
There are Time methods defined for setting and getting a Time.

<P>
A Time that is specified in hours does not need to be associated with a 
standard calendar; use ESMC_CALKIND_NOCALENDAR.  A Time whose specification 
includes time units of a year must be associated with a standard calendar. 
The ESMF representation of a calendar, the Calendar class, is described in 
Section&nbsp;<A HREF="#sec:Calendar">26.1</A>.  The <SPAN style="font-family:monospace">ESMC_TimeSet</SPAN> method is used to 
initialize a Time as well as associate it with a Calendar.  If a Time method 
is invoked in which a Calendar is necessary and one has not been set, the 
ESMF method will return an error condition.

<P>
In the ESMF the TimeInterval class is used to represent time periods. 
This class is frequently used in combination with the Time class. 
The Clock class, for example, advances model time by incrementing a 
Time with a TimeInterval. 

<H2><A ID="SECTION06042000000000000000">
<SPAN CLASS="arabic">27</SPAN>.<SPAN CLASS="arabic">2</SPAN> Class API</A>
</H2>

<H1><A ID="SECTION06050000000000000000">
<SPAN CLASS="arabic">28</SPAN> TimeInterval Class</A>
</H1>

<H2><A ID="SECTION06051000000000000000">
<SPAN CLASS="arabic">28</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
</H2>

<P>
<A ID="sec:TimeInterval"></A>A TimeInterval represents a period between time instants. 
It can be either positive or negative.

<P>
There are TimeInterval methods defined for setting and getting 
a TimeInterval, for printing the contents of a TimeInterval.

<P>
The class used to represent time instants in ESMF is Time, 
and this class is frequently used in operations along with 
TimeIntervals.  The Clock class, for example, advances model time by 
incrementing a Time with a TimeInterval. 

<P>
TimeIntervals are used by other parts of the ESMF timekeeping 
system, such as Clocks; see Section&nbsp;<A HREF="#sec:Clock">29.1</A>.

<H2><A ID="SECTION06052000000000000000">
<SPAN CLASS="arabic">28</SPAN>.<SPAN CLASS="arabic">2</SPAN> Class API</A>
</H2>

<H1><A ID="SECTION06060000000000000000">
<SPAN CLASS="arabic">29</SPAN> Clock Class</A>
</H1>

<H2><A ID="SECTION06061000000000000000">
<SPAN CLASS="arabic">29</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
</H2>

<P>
<A ID="sec:Clock"></A>
<P>
The Clock class advances model time and tracks its associated 
date on a specified Calendar.  It stores start time, stop time, 
current time, and a time step. 

<P>
There are methods for setting and getting the Times associated 
with a Clock.  Methods are defined for advancing the Clock's 
current time and printing a Clock's contents.

<H2><A ID="SECTION06062000000000000000">
<SPAN CLASS="arabic">29</SPAN>.<SPAN CLASS="arabic">2</SPAN> Class API</A>
</H2>

<H1><A ID="SECTION06070000000000000000">
<SPAN CLASS="arabic">30</SPAN> Config Class</A>
</H1>

<H2><A ID="SECTION06071000000000000000">
<SPAN CLASS="arabic">30</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
</H2>

<P>
<A ID="sec:Config"></A>
<P>
ESMF Configuration Management is based on NASA DAO's 
Inpak 90 package, a Fortran 90 collection of routines/functions
for accessing <EM>Resource Files</EM> in ASCII format.The package 
is optimized for minimizing formatted I/O, performing all of its 
string operations in memory using Fortran intrinsic functions.
<BR>
<P>

<H3><A ID="SECTION06071100000000000000">
<SPAN CLASS="arabic">30</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN> Package history</A>
</H3>

<P>
The ESMF Configuration Management Package was evolved by
Leonid Zaslavsky and Arlindo da Silva from Ipack90 package
created by Arlindo da Silva at NASA DAO.

<P>
Back in the 70's Eli Isaacson wrote IOPACK in Fortran
66.  In June of 1987 Arlindo da Silva wrote Inpak77 using
Fortran 77 string functions; Inpak 77 is a vastly
simplified IOPACK, but has its own goodies not found in
IOPACK.  Inpak 90 removes some obsolete functionality in
Inpak77, and parses the whole resource file in memory for
performance.

<P>

<H2><A ID="SECTION06072000000000000000">
<SPAN CLASS="arabic">30</SPAN>.<SPAN CLASS="arabic">2</SPAN> Class API</A>
</H2>

<H1><A ID="SECTION06080000000000000000">
<SPAN CLASS="arabic">31</SPAN> Log Class</A>
</H1>

<H2><A ID="SECTION06081000000000000000">
<SPAN CLASS="arabic">31</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
</H2>

<P>
<A ID="sec:Log"></A>
<P>
The Log class consists of a variety of methods for writing error, warning, and
informational messages to files.  A default Log is created at ESMF
initialization.

<P>
When ESMF is started with <SPAN style="font-family:monospace">ESMC_Initialize()</SPAN>, multiple Log files will
be created by PET number.  The PET number (in the format
<SPAN style="font-family:monospace">PETx.</SPAN>) will be prepended to each file name where x is the PET number.
The <SPAN style="font-family:monospace">ESMC_LogWrite()</SPAN> call is used to issue messages to the log.  As
part of the call, a message can be tagged as either an informational,
warning, or error message.

<P>
The messages may be buffered within ESMF before appearing in the log.
All messages will be properly flushed to the log files when <SPAN style="font-family:monospace">ESMC_Finalize()</SPAN>
is called.

<H2><A ID="SECTION06082000000000000000">
<SPAN CLASS="arabic">31</SPAN>.<SPAN CLASS="arabic">2</SPAN> Constants</A>
</H2>

<P>

<H3><A ID="SECTION06082100000000000000"></A>
<A ID="const:clogkindflag"></A>
<BR>
<SPAN CLASS="arabic">31</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> ESMC_LOGKIND
</H3>

<P>
<SPAN style="font-family:sans-serif">DESCRIPTION:
<BR></SPAN>
Specifies a single log file, multiple log files (one per PET), or no log files.

<P>
The valid values are:
<DL>
<DT><STRONG>ESMC_LOGKIND_SINGLE</STRONG></DT>
<DD>Use a single log file, combining messages from all of the PETs.  Not supported on some platforms.
   
</DD>
<DT><STRONG>ESMC_LOGKIND_MULTI</STRONG></DT>
<DD>Use multiple log files &mdash; one per PET.
   
</DD>
<DT><STRONG>ESMC_LOGKIND_NONE</STRONG></DT>
<DD>Do not issue messages to a log file.
</DD>
</DL>

<P>

<H3><A ID="SECTION06082200000000000000"></A>
<A ID="const:clogmsgflag"></A>
<BR>
<SPAN CLASS="arabic">31</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN> ESMC_LOGMSG
</H3>

<P>
<SPAN style="font-family:sans-serif">DESCRIPTION:
<BR></SPAN>

Specifies a message level.

<P>
The valid values are:
<DL>
<DT><STRONG>ESMC_LOGMSG_INFO</STRONG></DT>
<DD>Informational messages
   
</DD>
<DT><STRONG>ESMC_LOGMSG_WARNING</STRONG></DT>
<DD>Warning messages
   
</DD>
<DT><STRONG>ESMC_LOGMSG_ERROR</STRONG></DT>
<DD>Error messages
   
</DD>
<DT><STRONG>ESMC_LOGMSG_TRACE</STRONG></DT>
<DD>Trace messages
   
</DD>
<DT><STRONG>ESMC_LOGMSG_DEBUG</STRONG></DT>
<DD>Debug messages
   
</DD>
<DT><STRONG>ESMC_LOGMSG_JSON</STRONG></DT>
<DD>JSON format messages
</DD>
</DL>
<H2><A ID="SECTION06083000000000000000">
<SPAN CLASS="arabic">31</SPAN>.<SPAN CLASS="arabic">3</SPAN> Class API</A>
</H2>

<H1><A ID="SECTION06090000000000000000">
<SPAN CLASS="arabic">32</SPAN> VM Class</A>
</H1>

<H2><A ID="SECTION06091000000000000000">
<SPAN CLASS="arabic">32</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
</H2>

<P>
The ESMF VM (Virtual Machine) class is a generic representation of hardware and system software resources. There is exactly one VM object per ESMF Component, providing the execution environment for the Component code. The VM class handles all resource management tasks for the Component class and provides a description of the underlying configuration of the compute resources used by a Component.

<P>
In addition to resource description and management, the VM class offers the lowest level of ESMF communication methods. The VM communication calls are very similar to MPI. Data references in VM communication calls must be provided as raw, language-specific, one-dimensional, contiguous data arrays. The similarity between VM and MPI communication calls is striking and there are many equivalent point-to-point and collective communication calls. However, unlike MPI, the VM communication calls support communication between threaded PETs in a completely transparent fashion.

<P>
Many ESMF applications do not interact with the VM class directly very much. The  resource management aspect is wrapped completely transparent into the ESMF Component concept. Often the only reason that user code queries a Component
object for the associated VM object is to inquire about resource information, such as the <SPAN style="font-family:monospace">localPet</SPAN> or the <SPAN style="font-family:monospace">petCount</SPAN>. Further, for most applications the use of higher level communication APIs, such as provided by Array and Field, are much more convenient than using the low level VM communication calls.

<P>
The basic elements of a VM are called PETs, which stands for Persistent Execution Threads. These are equivalent to OS threads with a lifetime of at least that of the associated component. All VM functionality is expressed in terms of PETs. In the simplest, and most common case, a PET is equivalent to an MPI process. However, ESMF also supports multi-threading, where multiple PETs run as Pthreads inside the same virtual address space (VAS).

<H2><A ID="SECTION06092000000000000000">
<SPAN CLASS="arabic">32</SPAN>.<SPAN CLASS="arabic">2</SPAN> Class API</A>
</H2>

<H1><A ID="SECTION060100000000000000000">
<SPAN CLASS="arabic">33</SPAN> Profiling and Tracing</A>
</H1>

<H2><A ID="SECTION060101000000000000000">
<SPAN CLASS="arabic">33</SPAN>.<SPAN CLASS="arabic">1</SPAN> Description</A>
</H2>

<P>

<H3><A ID="SECTION060101100000000000000"></A>
<A ID="sec:Profiling"></A>
<BR>
<SPAN CLASS="arabic">33</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN> Profiling
</H3>

<P>
ESMF's built in <EM>profiling</EM> capability collects runtime statistics
of an executing ESMF application through both automatic and manual code
instrumentation. Timing information for all phases of all ESMF components
executing in an application can be automatically collected using the
<SPAN style="font-family:monospace">ESMF_RUNTIME_PROFILE</SPAN> environment variable (see below for settings).
Additionally, arbitrary user-defined code regions can be timed by
manually instrumenting code with special API calls.  Timing profiles
of component phases and user-defined regions can be output in several
different formats:

<UL>
<LI>in text at the end of ESMF Log files
</LI>
<LI>in separate text file, one per PET (if the ESMF Logs are turned off)
</LI>
<LI>in a single summary text file that aggregates timings over multiple PETs
</LI>
<LI>in a binary format for import into the <A ID="tex2html19"
  HREF="https://github.com/esmf-org/esmf-profiler">esmf-profiler</A>
for profile visualization
</LI>
</UL>

<P>
The following table lists important environment variables that control
aspects of ESMF profiling.

<P>
<TABLE class="PAD  BORDER" style="">
<TR><TD CLASS="LEFT TOP"  WIDTH=218><B>Environment Variable</B></TD>
<TD CLASS="LEFT TOP"  WIDTH=290><B>Description</B></TD>
<TD CLASS="LEFT TOP"  WIDTH=218><B>Example Values</B></TD>
<TD CLASS="LEFT TOP"  WIDTH=218><B>Default</B></TD>
</TR>
<TR><TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">ESMF_RUNTIME_PROFILE</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=290>Enable/disables all profiling functions</TD>
<TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">ON</SPAN> or <SPAN style="font-family:monospace">OFF</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">OFF</SPAN></TD>
</TR>
<TR><TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">ESMF_RUNTIME_PROFILE_PETLIST</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=290>Limits profiling to an explicit list of PETs</TD>
<TD CLASS="LEFT TOP"  WIDTH=218>&ldquo;<SPAN style="font-family:monospace">0-9 50 99</SPAN>&rdquo;</TD>
<TD CLASS="LEFT TOP"  WIDTH=218><EM>profile all PETs</EM></TD>
</TR>
<TR><TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">ESMF_RUNTIME_PROFILE_OUTPUT</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=290>Controls output format of profiles;  multiple can be specified in a space separated list</TD>
<TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">TEXT</SPAN>, <SPAN style="font-family:monospace">SUMMARY</SPAN>, <SPAN style="font-family:monospace">BINARY</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">TEXT</SPAN></TD>
</TR>
</TABLE>

<P>

<H3><A ID="SECTION060101200000000000000"></A>
<A ID="sec:Tracing"></A>
<BR>
<SPAN CLASS="arabic">33</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN> Tracing
</H3>

<P>
Whereas profiling collects summary information from an application,
<EM>tracing</EM> records a more detailed set of events for later analysis. Trace
analysis can be used to understand what happened during a program's
execution and is often used for diagnosing problems, debugging, and
performance analysis.

<P>
ESMF has a built-in tracing capability that records events into special
binary log files.  Unlike log files written by the <SPAN style="font-family:monospace">ESMF_Log</SPAN> class,
which are primarily for human consumption (see Section <A HREF="#sec:Log">31.1</A>),
the trace output files are
recorded in a compact binary representation and are processed by tools
to produce various analyses. ESMF event streams are recorded in the
<A ID="tex2html20"
  HREF="http://diamon.org/ctf/">Common Trace Format</A>
(CTF).
CTF traces include one or more event streams,
as well as a metadata file describing the events in the streams.

<P>
Several tools are available for reading in the CTF traces output by ESMF.
Of the tools listed below, the first one is designed specifically for
analyzing ESMF applications and the second two are general purpose tools
for working with all CTF traces.

<UL>
<LI><A ID="tex2html21"
  HREF="https://github.com/esmf-org/esmf-profiler">esmf-profiler</A>
is a tool that ingests traces from an ESMF application and generates
  performance profile plots.
</LI>
<LI><A ID="tex2html22"
  HREF="http://tracecompass.org/">TraceCompass</A>
is a general purpose tool for reading, analyzing, and visualizing traces.
</LI>
<LI><A ID="tex2html23"
  HREF="http://www.efficios.com/babeltrace">Babeltrace</A>
is a command-line tool and library for trace conversion
  that can read and write CTF traces. Python bindings are available
  to open CTF traces are iterate through events.  
</LI>
</UL>

<P>
Events that can be captured by the ESMF tracer include the following. Events
are recorded with a high-precision timestamp to allow timing analyses.
<DL>
<DT><STRONG>phase_enter</STRONG></DT>
<DD>indicates entry into an initialize, run, or finalize ESMF component routine
</DD>
<DT><STRONG>phase_exit</STRONG></DT>
<DD>indicates exit from an initialize, run, or finalize ESMF component routine
</DD>
<DT><STRONG>region_enter</STRONG></DT>
<DD>indicates entry into a user-defined code region
</DD>
<DT><STRONG>region_exit</STRONG></DT>
<DD>indicates exit from a user-defined code region
</DD>
</DL>

<P>
The following table lists important environment variables that control
aspects of ESMF tracing.

<P>
<TABLE class="PAD  BORDER" style="">
<TR><TD CLASS="LEFT TOP"  WIDTH=218><B>Environment Variable</B></TD>
<TD CLASS="LEFT TOP"  WIDTH=290><B>Description</B></TD>
<TD CLASS="LEFT TOP"  WIDTH=218><B>Example Values</B></TD>
<TD CLASS="LEFT TOP"  WIDTH=218><B>Default</B></TD>
</TR>
<TR><TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">ESMF_RUNTIME_TRACE</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=290>Enable/disables all tracing functions</TD>
<TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">ON</SPAN> or <SPAN style="font-family:monospace">OFF</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">OFF</SPAN></TD>
</TR>
<TR><TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">ESMF_RUNTIME_TRACE_CLOCK</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=290>Sets the type of clock for timestamping events (see Section <A HREF="#sec:TracingClocks"><IMG  ALT="[*]" SRC="crossref.png"></A>).</TD>
<TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">REALTIME</SPAN> or <SPAN style="font-family:monospace">MONOTONIC</SPAN> or <SPAN style="font-family:monospace">MONOTONIC_SYNC</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">REALTIME</SPAN></TD>
</TR>
<TR><TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">ESMF_RUNTIME_TRACE_PETLIST</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=290>Limits tracing to an explicit list of PETs</TD>
<TD CLASS="LEFT TOP"  WIDTH=218>&ldquo;<SPAN style="font-family:monospace">0-9 50 99</SPAN>&rdquo;</TD>
<TD CLASS="LEFT TOP"  WIDTH=218><EM>trace all PETs</EM></TD>
</TR>
<TR><TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">ESMF_RUNTIME_TRACE_COMPONENT</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=290>Enables/disable tracing of Component phase_enter and phase_exit events</TD>
<TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">ON</SPAN> or <SPAN style="font-family:monospace">OFF</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">ON</SPAN></TD>
</TR>
<TR><TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">ESMF_RUNTIME_TRACE_FLUSH</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=290>Controls frequency of event stream flushing to file</TD>
<TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">DEFAULT</SPAN> or <SPAN style="font-family:monospace">EAGER</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=218><SPAN style="font-family:monospace">DEFAULT</SPAN></TD>
</TR>
</TABLE>

<P>

<H2><A ID="SECTION060102000000000000000">
<SPAN CLASS="arabic">33</SPAN>.<SPAN CLASS="arabic">2</SPAN> Restrictions and Future Work</A>
</H2>

<P>

<OL>
<LI><B>Limited types of trace events.</B>
  Currently only a few trace event types are available. The tracer may
  be extended in the future to record additional types of events.
</LI>
<LI><B>MPI call profing not available for statically linked executables on Darwin.</B>
  Currently the linker on Darwin systems does not support the wrapping of
  symbols during static linking. In order to access MPI call profiling on Darwin,
  executables should be linked dynamically in combination with the procedure
  described in section <A HREF="#sec:MPIProfiling"><IMG  ALT="[*]" SRC="crossref.png"></A>.
</LI>
</OL>

<P>

<H2><A ID="SECTION060103000000000000000">
<SPAN CLASS="arabic">33</SPAN>.<SPAN CLASS="arabic">3</SPAN> Class API</A>
</H2>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A
 HREF="node7.html">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A
 HREF="ESMC_crefdoc.html">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="node5.html">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A> 
<A ID="tex2html464"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A
 HREF="node7.html">6 References</A>
<B> Up:</B> <A
 HREF="ESMC_crefdoc.html">ESMC_crefdoc</A>
<B> Previous:</B> <A
 HREF="node5.html">4 Infrastructure: Fields and Grids</A>
 &nbsp; <B>  <A ID="tex2html465"
  HREF="node1.html">Contents</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
<A HREF=mailto:esmf_support@ucar.edu>esmf_support@ucar.edu</A>
</ADDRESS>
</BODY>
</HTML>
