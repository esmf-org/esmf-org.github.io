%                **** IMPORTANT NOTICE *****
% This LaTeX file has been automatically produced by ProTeX v. 1.1
% Any changes made to this file will likely be lost next time
% this file is regenerated from its source. Send questions 
% to Arlindo da Silva, dasilva@gsfc.nasa.gov
 
\setlength{\oldparskip}{\parskip}
\setlength{\parskip}{1.5ex}
\setlength{\oldparindent}{\parindent}
\setlength{\parindent}{0pt}
\setlength{\oldbaselineskip}{\baselineskip}
\setlength{\baselineskip}{11pt}
 
%--------------------- SHORT-HAND MACROS ----------------------
\def\bv{\begin{verbatim}}
\def\ev{\end{verbatim}}
\def\be{\begin{equation}}
\def\ee{\end{equation}}
\def\bea{\begin{eqnarray}}
\def\eea{\end{eqnarray}}
\def\bi{\begin{itemize}}
\def\ei{\end{itemize}}
\def\bn{\begin{enumerate}}
\def\en{\end{enumerate}}
\def\bd{\begin{description}}
\def\ed{\end{description}}
\def\({\left (}
\def\){\right )}
\def\[{\left [}
\def\]{\right ]}
\def\<{\left  \langle}
\def\>{\right \rangle}
\def\cI{{\cal I}}
\def\diag{\mathop{\rm diag}}
\def\tr{\mathop{\rm tr}}
%-------------------------------------------------------------

\markboth{Left}{Source File: ESMF\_AttributePackageEx.F90,  Date: Tue May  5 21:00:14 MDT 2020
}

 
%/////////////////////////////////////////////////////////////

   \subsubsection{Attribute packages} \label{ex:AttributePackageEx}
  
   This example is slightly more complex than the example presented in section
   \ref{ex:AttributeEx} and illustrates the use of the Attribute class to
   create Attribute hierarchies using Attribute packages.  A gridded Component
   is used in conjunction with two States, a FieldBundle, and various realistic
   Fields to create an Attribute hierarchy and copy it from one State to another.
   Attribute packages are created on the Component and Fields, and the
   standard Attributes in each package are used in the Attribute hierarchy.
   The Attribute package nesting capability is demonstrated by nesting the standard
   ESMF supplied packages for the Fields inside a user specified Attribute package
   with a customized convention. 
%/////////////////////////////////////////////////////////////

      We must construct the ESMF objects that will be responsible for the
      Attributes we will be manipulating.  These objects include the
      gridded Component, two States, a FieldBundle, and 10 Fields.  In this trivial
      example we are constructing empty Fields with no underlying Grid. 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      if (petCount<4) then
        gridcomp = ESMF_GridCompCreate(name="gridded_comp_ex2", &
          petList=(/0/), rc=rc)
      else
        gridcomp = ESMF_GridCompCreate(name="gridded_comp_ex2", &
          petList=(/0,1,2,3/), rc=rc)
      endif
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      importState = ESMF_StateCreate(name="importState",  &
                             stateintent=ESMF_STATEINTENT_IMPORT, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      exportState = ESMF_StateCreate(name="exportState",  &
                             stateintent=ESMF_STATEINTENT_EXPORT, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      DPEDT = ESMF_FieldEmptyCreate(name='DPEDT', rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      DTDT = ESMF_FieldEmptyCreate(name='DTDT', rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      DUDT = ESMF_FieldEmptyCreate(name='DUDT', rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      DVDT = ESMF_FieldEmptyCreate(name='DVDT', rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      PHIS = ESMF_FieldEmptyCreate(name='PHIS', rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      QTR = ESMF_FieldEmptyCreate(name='QTR', rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      CNV = ESMF_FieldEmptyCreate(name='CNV', rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      CONVCPT = ESMF_FieldEmptyCreate(name='CONVCPT', rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      CONVKE = ESMF_FieldEmptyCreate(name='CONVKE', rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      CONVPHI = ESMF_FieldEmptyCreate(name='CONVPHI', rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      fbundle = ESMF_FieldBundleCreate(name="fbundle", rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

      Now we can add Attribute packages to all of the appropriate objects.
      We will use the ESMF supplied Attribute packages for the Fields and
      the Component.  On the Fields, we will first use
      {\tt ESMF\_AttributeAdd()} to create standard Attribute packages, then
      we will nest customized Attribute packages around the ESMF standard
      Attribute packages.  In this simple example the purpose for the Attribute packages will
      be specified as "General" in all cases. 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      convESMF = 'ESMF'
      convCC = 'CustomConvention'
      purpGen = 'General'

      attrList(1) = 'Coordinates'
      attrList(2) = 'Mask'

      ! DPEDT
      call ESMF_AttributeAdd(DPEDT, convention=convESMF, purpose=purpGen, &
        rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_AttributeAdd(DPEDT, convention=convCC, purpose=purpGen,   &
        attrList=attrList, nestConvention=convESMF, nestPurpose=purpGen,  &
        rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

       ... and so on for the other 9 Fields.
  
       The standard Attribute package currently supplied by ESMF for
       Field contains 6 Attributes, 2 of which are set automatically.
       The remaining 4 Attributes in the standard Field Attribute
       package must be set manually by the user.   We must also
       set the Attributes of our own custom Attribute package, which
       is built around the ESMF standard Attribute package. 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      name1 = 'ShortName'
      name2 = 'StandardName'
      name3 = 'LongName'
      name4 = 'Units'

      ! DPEDT
      value1 = 'DPEDT'
      value2 = 'tendency_of_air_pressure'
      value3 = 'Edge pressure tendency'
      value4 = 'Pa s-1'
      ! Custom Attributes

      ! retrieve Attribute package
      call ESMF_AttributeGetAttPack(DPEDT, convCC, purpGen, &
        attpack=attpack, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(DPEDT, name='Coordinates', value='latlon', &
        convention=convCC, purpose=purpGen, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_AttributeSet(DPEDT, name='Mask', value='yes', &
        convention=convCC, purpose=purpGen, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      ! ESMF Attributes

      ! retrieve Attribute package
      call ESMF_AttributeGetAttPack(DPEDT, convESMF, purpGen, &
        attpack=attpack, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(DPEDT, name2, value2, &
        convention=convESMF, purpose=purpGen, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(DPEDT, name3, value3, &
        convention=convESMF, purpose=purpGen, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(DPEDT, name4, value4, &
        convention=convESMF, purpose=purpGen, rc=rc)

 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

       ... and so on for the other 9 Fields.
  
       The standard Attribute package currently supplied by ESMF for
       Component contains 10 Attributes.  These Attributes conform to both
       the ESG and CF conventions, and must be set manually. 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
    ! retrieve Attribute package
    call ESMF_AttributeGetAttPack(gridcomp, convESMF, purpGen, attpack=attpack, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

    call ESMF_AttributeSet(gridcomp, 'Agency', 'NASA', &
      convention=convESMF, purpose=purpGen, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
    call ESMF_AttributeSet(gridcomp, 'Author', 'Max Suarez', &
      convention=convESMF, purpose=purpGen, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
    call ESMF_AttributeSet(gridcomp, 'CodingLanguage', &
      'Fortran 90', convention=convESMF, purpose=purpGen, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
    call ESMF_AttributeSet(gridcomp, 'Discipline', &
      'Atmosphere', convention=convESMF, purpose=purpGen, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
    call ESMF_AttributeSet(gridcomp, 'ComponentLongName', &
    'Goddard Earth Observing System Version 5 Finite Volume Dynamical Core', &
        convention=convESMF, purpose=purpGen, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
    call ESMF_AttributeSet(gridcomp, 'ModelComponentFramework', &
      'ESMF', convention=convESMF, purpose=purpGen, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
    call ESMF_AttributeSet(gridcomp, 'ComponentShortName', &
      'GEOS-5 FV dynamical core', &
      convention=convESMF, purpose=purpGen, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
    call ESMF_AttributeSet(gridcomp, 'PhysicalDomain', &
      'Earth system', convention=convESMF, purpose=purpGen, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
    call ESMF_AttributeSet(gridcomp, 'Version', &
      'GEOSagcm-EROS-beta7p12', convention=convESMF, purpose=purpGen, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

       Adding the Fields to the FieldBundle will automatically ``link" the
       Attribute hierarchies.  The same type of link will be generated
       when adding a FieldBundle to a State. 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_FieldBundleAdd(fbundle, (/DPEDT/), rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_FieldBundleAdd(fbundle, (/DTDT/), rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_FieldBundleAdd(fbundle, (/DUDT/), rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_FieldBundleAdd(fbundle, (/DVDT/), rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_FieldBundleAdd(fbundle, (/PHIS/), rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_FieldBundleAdd(fbundle, (/QTR/), rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_FieldBundleAdd(fbundle, (/CNV/), rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_FieldBundleAdd(fbundle, (/CONVCPT/), rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_FieldBundleAdd(fbundle, (/CONVKE/), rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_FieldBundleAdd(fbundle, (/CONVPHI/), rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_StateAdd(exportState, fieldbundleList=(/fbundle/), rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

       The link between a State and the Component of interest must be
       set manually. 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_AttributeLink(gridcomp, exportState, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

       There are currently two different formats available for writing
       the contents of the Attribute packages in an Attribute hierarchy.
       There is an XML formatted write, which generates an .xml file in the
       execution directory with the contents of the write.  There is also
       a tab-delimited write which writes to standard out, a file generated
       in the execution directory with the extension .stdout.  Either of
       the {\tt ESMF\_AttributeWrite()} formats can be called on any of the objects which
       are capable of manipulating Attributes, but only from objects in an
       Attribute hierarchy which contain ESMF standard Attribute packages can it be confirmed that any
       relevant information be written.  The {\tt ESMF\_AttributeWrite()}
       capability is only functional for single-item Attributes at this point, it
       will be more robust in future releases.  A flag is used to
       specify which format to write, the default is tab-delimited. 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_AttributeWrite(gridcomp,convESMF,purpGen, &
        attwriteflag=ESMF_ATTWRITE_XML,rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeWrite(gridcomp,convESMF,purpGen,rc=rc)
 
\end{verbatim}

%...............................................................
\setlength{\parskip}{\oldparskip}
\setlength{\parindent}{\oldparindent}
\setlength{\baselineskip}{\oldbaselineskip}
