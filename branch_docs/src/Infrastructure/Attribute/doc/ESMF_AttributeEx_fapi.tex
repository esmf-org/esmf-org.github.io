%                **** IMPORTANT NOTICE *****
% This LaTeX file has been automatically produced by ProTeX v. 1.1
% Any changes made to this file will likely be lost next time
% this file is regenerated from its source. Send questions 
% to Arlindo da Silva, dasilva@gsfc.nasa.gov
 
\setlength{\oldparskip}{\parskip}
\setlength{\parskip}{1.5ex}
\setlength{\oldparindent}{\parindent}
\setlength{\parindent}{0pt}
\setlength{\oldbaselineskip}{\baselineskip}
\setlength{\baselineskip}{11pt}
 
%--------------------- SHORT-HAND MACROS ----------------------
\def\bv{\begin{verbatim}}
\def\ev{\end{verbatim}}
\def\be{\begin{equation}}
\def\ee{\end{equation}}
\def\bea{\begin{eqnarray}}
\def\eea{\end{eqnarray}}
\def\bi{\begin{itemize}}
\def\ei{\end{itemize}}
\def\bn{\begin{enumerate}}
\def\en{\end{enumerate}}
\def\bd{\begin{description}}
\def\ed{\end{description}}
\def\({\left (}
\def\){\right )}
\def\[{\left [}
\def\]{\right ]}
\def\<{\left  \langle}
\def\>{\right \rangle}
\def\cI{{\cal I}}
\def\diag{\mathop{\rm diag}}
\def\tr{\mathop{\rm tr}}
%-------------------------------------------------------------

\markboth{Left}{Source File: ESMF\_AttributeEx.F90,  Date: Tue May  5 21:00:07 MDT 2020
}

 
%/////////////////////////////////////////////////////////////

   \subsubsection{Basic Attribute usage} \label{ex:AttributeEx}
  
   This example illustrates the most basic usage of the Attribute class.  
   This demonstration of Attribute manipulation is limited to the gridded 
   Component, but the same principles apply to the coupler Component, State, 
   Grid, FieldBundle, Field, ArrayBundle and Array.  The
   functionality that is demonstrated includes setting and getting Attributes, 
   working with Attributes with different types and lists, removing Attributes,
   and getting default Attributes.  Various other uses of 
   {\tt ESMF\_AttributeGet()} is covered in detail in the last section.  The
   first thing we must do is declare variables and initialize ESMF. 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      ! Use ESMF framework module
      use ESMF
      use ESMF_TestMod
      implicit none

      ! Local variables  
      integer                 :: rc, finalrc, petCount, localPet, &
                                 itemCount, count, result
      type(ESMF_VM)           :: vm
      type(ESMF_GridComp)     :: gridcomp
      character(ESMF_MAXSTR)  :: name
      type(ESMF_TypeKind_Flag)     :: tk

      integer(ESMF_KIND_I4)                :: inI4
      integer(ESMF_KIND_I4), dimension(3)  :: inI4l
      integer(ESMF_KIND_I8)                :: inI8
      integer(ESMF_KIND_I8), dimension(3)  :: inI8l
      real(ESMF_KIND_R4)                   :: inR4
      real(ESMF_KIND_R4), dimension(3)     :: inR4l
      real(ESMF_KIND_R8)                   :: inR8
      real(ESMF_KIND_R8), dimension(3)     :: inR8l
      character(ESMF_MAXSTR)               :: inChar
      character(ESMF_MAXSTR), dimension(3) :: inCharl, &
                                           defaultCharl, dfltoutCharl
      character(ESMF_MAXSTR), dimension(8) :: outCharl
      logical                              :: inLog
      logical, dimension(3)                :: inLogl, value
      character(ESMF_MAXSTR)               :: testname
      character(ESMF_MAXSTR)               :: failMsg
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      
      ! initialize ESMF
      finalrc = ESMF_SUCCESS
      call ESMF_Initialize(vm=vm, defaultlogfilename="AttributeEx.Log", &
                    logkindflag=ESMF_LOGKIND_MULTI, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      
      ! get the vm
      call ESMF_VMGet(vm, petCount=petCount, localPet=localPet, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

      We will construct the gridded Component which will be responsible for all
      of the Attributes we will be manipulating. 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      if (petCount<4) then
        gridcomp = ESMF_GridCompCreate(name="gridcomp", &
          petList=(/0/), rc=rc)
      else 
        gridcomp = ESMF_GridCompCreate(name="gridcomp", &
          petList=(/0,1,2,3/), rc=rc)
      endif
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

       We can set Attributes using the {\tt ESMF\_AttributeSet()} command.  
       Attributes can be any of several different types, all of which are 
       demonstrated here. 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      inI4 = 4
      inI4l = (/1,2,3/)
      inI8 = 4
      inI8l = (/1,2,3/)
      inR4 = 4
      inR4l = (/1,2,3/)
      inR8 = 4
      inR8l = (/1,2,3/)
      inChar = "Character string 4"
      inCharl = (/ "Character string 1", &
                   "Character string 2", &
                   "Character string 3" /)
      inLog = .true.
      inLogl = (/.true., .false., .true. /)
      
      call ESMF_AttributeSet(gridcomp, name="ESMF_I4name", value=inI4, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(gridcomp, name="ESMF_I4namelist", &
        valueList=inI4l, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(gridcomp, name="ESMF_I8name", value=inI8,  rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(gridcomp, name="ESMF_I8namelist", &
        valueList=inI8l, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(gridcomp, name="ESMF_R4name", value=inR4, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(gridcomp, name="ESMF_R4namelist", &
        valueList=inR4l, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(gridcomp, name="ESMF_R8name", value=inR8, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(gridcomp, name="ESMF_R8namelist", &
        valueList=inR8l, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(gridcomp, name="Character_name", &
        value=inChar, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(gridcomp, name="Character_namelist", &
        valueList=inCharl, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(gridcomp, name="Logical_name", value=inLog, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      call ESMF_AttributeSet(gridcomp, name="Logical_namelist", &
        valueList=inLogl, rc=rc)

 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

       We can retrieve Attributes by issuing the {\tt ESMF\_AttributeGet()} 
       command.  This command can also be used with an optional default 
       value (or value list) so that if the Attribute is not found a value is 
       returned without an error code.  Removal of Attributes is also 
       possible, and is demonstrated here as well.  One of the Attributes
       previously created will be retrieved, then removed, then 
       retrieved again using a default return value.  In order to use the 
       default return value capabilites, we must first set up a default parameter. 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      defaultCharl = (/ "Character string 4", &
                        "Character string 5", &
                        "Character string 6" /)
      
      itemCount=3
      call ESMF_AttributeGet(gridcomp, name="Character_namelist", &
        valueList=outCharl(1:5), itemCount=itemCount, rc=rc) 
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

                    
      call ESMF_AttributeRemove(gridcomp, name="Character_namelist", rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      
      call ESMF_AttributeGet(gridcomp, name="Character_namelist", &
        valueList=dfltoutCharl, defaultvalueList=defaultCharl,rc=rc)

 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

      There are more overloaded instances of {\tt ESMF\_AttributeGet()} 
      which allow the retrieval of Attribute information by name or index 
      number, or a query for the count of the Attributes on a certain object.  
      These capabilities are demonstrated here by first retrieving the name of
      an Attribute using the index number, keep in mind that these index
      numbers start from 1.  Then the name that is retrieved
      is used to get other information about the Attribute, such as the
      typekind, and the number of items in the value of the Attribute.
      This information is then used to actually retrieve the Attribute value.
      Then the count of the number of Attributes on the object will be retrieved. 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}
      call ESMF_AttributeGet(gridcomp, attributeIndex=11 , name=name, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      
      call ESMF_AttributeGet(gridcomp, name=name, typekind=tk, &
        itemCount=itemCount, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      
      if (tk==ESMF_TYPEKIND_Logical .AND. itemCount==3) then
        call ESMF_AttributeGet(gridcomp, name=name, valueList=value, rc=rc)
 
\end{verbatim}
 
%/////////////////////////////////////////////////////////////

 \begin{verbatim}

      endif
      
      call ESMF_AttributeGet(gridcomp, count=count, rc=rc)
 
\end{verbatim}

%...............................................................
\setlength{\parskip}{\oldparskip}
\setlength{\parindent}{\oldparindent}
\setlength{\baselineskip}{\oldbaselineskip}
