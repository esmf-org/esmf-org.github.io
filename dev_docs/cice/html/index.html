<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Los Alamos Sea Ice (CICE) NUOPC Cap: Los Alamos Sea Ice (CICE) NUOPC Cap</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Los Alamos Sea Ice (CICE) NUOPC Cap
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Los Alamos Sea Ice (CICE) NUOPC Cap </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Overview">Overview</a><ul><li class="level2"><a href="#CapSubroutines">Cap Subroutines</a></li>
</ul>
</li>
<li class="level1"><a href="#UnderlyingModelInterfaces">Underlying Model Interfaces</a><ul><li class="level2"><a href="#DomainCreation">Domain Creation</a></li>
<li class="level2"><a href="#Initialization">Initialization</a></li>
<li class="level2"><a href="#Run">Run</a><ul><li class="level3"><a href="#VectorRotations">Vector Rotations</a></li>
</ul>
</li>
<li class="level2"><a href="#Finalization">Finalization</a></li>
</ul>
</li>
<li class="level1"><a href="#ModelFields">Model Fields</a><ul><li class="level2"><a href="#ImportFields">Import Fields</a></li>
<li class="level2"><a href="#ExportField">Export Fields</a></li>
<li class="level2"><a href="#MemoryManagement">Memory Management</a></li>
<li class="level2"><a href="#IO">I/O</a></li>
</ul>
</li>
<li class="level1"><a href="#BuildingAndInstalling">Building and Installing</a><ul><li class="level2"><a href="#Dependencies">Dependencies</a></li>
</ul>
</li>
<li class="level1"><a href="#RuntimeConfiguration">Runtime Configuration</a></li>
<li class="level1"><a href="#Repository"></a></li>
<li class="level1"><a href="#References"></a></li>
</ul>
</div>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Fei Liu (<a href="#" onclick="location.href='mai'+'lto:'+'fei'+'.l'+'iu@'+'gm'+'ail'+'.c'+'om'; return false;">fei.l<span style="display: none;">.nosp@m.</span>iu@g<span style="display: none;">.nosp@m.</span>mail.<span style="display: none;">.nosp@m.</span>com</a>) </dd>
<dd>
Rocky Dunlap (<a href="#" onclick="location.href='mai'+'lto:'+'roc'+'ky'+'.du'+'nl'+'ap@'+'no'+'aa.'+'go'+'v'; return false;">rocky<span style="display: none;">.nosp@m.</span>.dun<span style="display: none;">.nosp@m.</span>lap@n<span style="display: none;">.nosp@m.</span>oaa.<span style="display: none;">.nosp@m.</span>gov</a>) </dd></dl>
<dl class="section date"><dt>Date</dt><dd>5/10/13 Original documentation </dd>
<dd>
10/6/16 Moved to doxygen</dd></dl>
<h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p><b>This CICE cap has been tested with versions 4.0 and 5.0.2 of CICE.</b></p>
<p>This document describes the CICE "cap", which is a small software layer that is required when the <a href="http://oceans11.lanl.gov/trac/CICE">Los Alamos sea ice model</a> is used in <a href="http://www.earthsystemcog.org/projects/nuopc">National Unified Operation Prediction Capability</a> (NUOPC) coupled systems. The NUOPC Layer is a software layer built on top of the <a href="https://www.earthsystemcog.org/projects/esmf">Earth System Modeling Framework</a> (ESMF). ESMF is a high-performance modeling framework that provides data structures, interfaces, and operations suited for building coupled models from a set of components. NUOPC refines the capabilities of ESMF by providing a more precise definition of what it means for a model to be a component and how components should interact and share data in a coupled system. The NUOPC Layer software is designed to work with typical high-performance models in the Earth sciences domain, most of which are written in Fortran and are based on a distributed memory model of parallelism (MPI). A NUOPC "cap" is a Fortran module that serves as the interface to a model when it's used in a NUOPC-based coupled system. The term "cap" is used because it is a small software layer that sits on top of model code, making calls into it and exposing model data structures in a standard way. For more information about creating NUOPC caps in general, please see the <a href="http://www.earthsystemmodeling.org/esmf_releases/non_public/ESMF_7_0_0/NUOPC_howtodoc/">Building a NUOPC Model</a> how-to document.</p>
<p>The CICE cap package contains a single Fortran source file and two makefiles. The Fortran source file (<a class="el" href="cice__cap_8F90.html">cice_cap.F90</a>) implements a standard Fortran module that uses ESMF and NUOPC methods and labels to create a NUOPC cap for CICE. It also uses variables and subroutines from CICE modules to invoke CICE subroutines and exchange data. In the simplest terms, the CICE cap should be thought of as a thin translation layer between the CICE Fortran code and the NUOPC infrastrucutre. The source file can be built into a linkable library and Fortran module file (.mod) for inclusion in other Fortran programs.</p>
<div class="image">
<img src="CAP_Anatomy_small.jpg" alt="CAP_Anatomy_small.jpg"/>
<div class="caption">
Architecture diagram showing how the CICE cap is an interface layer between the model code and the NUOPC coupling infrastructure</div></div>
 <h2><a class="anchor" id="CapSubroutines"></a>
Cap Subroutines</h2>
<p>The CICE cap Fortran module contains a set of subroutines that are required by NUOPC. These subroutines are called by the NUOPC infrastructure according to a predefined calling sequence. Some subroutines are called during initialization of the coupled system, some during the run of the coupled system, and some during finalization of the coupled system. The initialization sequence is the most complex and is governed by the NUOPC technical rules. Details about the initialization sequence can be found in the <a href="http://www.earthsystemmodeling.org/esmf_releases/non_public/ESMF_7_0_0/NUOPC_refdoc/node3.html#SECTION00034000000000000000">NUOPC Reference Manual</a>.</p>
<p>A particularly important part of the NUOPC intialization sequence is to establish field connections between models. Simply put, a field connection is established when a field output by one model can be consumed by another. As an example, the CICE model is able to accept a precipitation rate when coupled to an atmosphere model. In this case a field connection will be established between the precipitation rate exported from the atmosphere and the precipitation rate imported into the CICE model. Because models may uses different variable names for physical quantities, NUOPC relies on a set of standard names and a built-in, extensible standard name dictionary to match fields between models. More information about the use of standard names can be found in the <a href="http://www.earthsystemmodeling.org/esmf_releases/non_public/ESMF_7_0_0/NUOPC_refdoc/node3.html#SECTION00032000000000000000">NUOPC Reference Manual</a>.</p>
<p>Two key initialization phases that appear in every NUOPC cap, including this CICE cap are the field "advertise" and field "realize" phases. <em>Advertise</em> is a special NUOPC term that refers to a model participating in a coupled system providing a list of standard names of required import fields and available export fields. In other words, each model will advertise to the other models which physical fields it needs and which fields it can provide when coupled. NUOPC compares all of the advertised standard names and creates a set of unidirectional links, each from one export field in a model to one import field in another model. When these connections have been established, all models in the coupled system need to provide a description of their geographic grid (e.g., lat-lon, tri-polar, cubed sphere, etc.) and allocate their connected fields on that grid. In NUOPC terms, this is refered to as <em>realizing</em> a set of fields. NUOPC relies on ESMF data types for this, such as the <a href="http://www.earthsystemmodeling.org/esmf_releases/public/last/ESMF_refdoc/node5.html#SECTION05080000000000000000">ESMF_Grid</a> type, which describes logically rectangular grids and the <a href="http://www.earthsystemmodeling.org/esmf_releases/public/last/ESMF_refdoc/node5.html#SECTION05030000000000000000">ESMF_Field</a> type, which wraps a models data arrays and provides basic metadata. Because ESMF supports interpolation between different grids (sometimes called "regridding" or "grid remapping"), it is not necessary that models share a grid. As you will see below the <em>advertise</em> and <em>realize</em> phases each have a subroutine in the CICE cap.</p>
<p>The following table summarizes the NUOPC-required subroutines that appear in the CICE cap. The "Phase" column says whether the subroutine is called during the initialization, run, or finalize part of the coupled system run.</p>
<table class="doxtable">
<tr>
<th>Phase </th><th>CICE Cap Subroutine </th><th>Description  </th></tr>
<tr>
<td>Init </td><td><a class="el" href="classcice__cap__mod.html#a6fff367383a101a74328ed28fb81af3f">InitializeP0</a> </td><td>Sets the Initialize Phase Definition (IPD) version to use </td></tr>
<tr>
<td>Init </td><td><a class="el" href="classcice__cap__mod.html#a6c072e6d9f3654ce41995de85aa02692">InitializeAdvertise</a> </td><td>Advertises standard names of import and export fields </td></tr>
<tr>
<td>Init </td><td><a class="el" href="classcice__cap__mod.html#a420af7f5b5ce7bc7a11b236b08438511">InitializeRealize</a> </td><td>Creates an ESMF_Grid for the CICE grid as well as ESMF_Fields for import and export fields </td></tr>
<tr>
<td>Init </td><td><a class="el" href="classcice__cap__mod.html#a3b1e7ea19e7649242ed2cac31ba1e2fb">SetClock</a> </td><td>Before the run, sets up the timestep interval </td></tr>
<tr>
<td>Run </td><td><a class="el" href="classcice__cap__mod.html#aba2a6b8bb1abbb72a532fd052dd72744">ModelAdvance_Slow</a> </td><td>Advances the model by a timestep by calling CICE_Run </td></tr>
<tr>
<td>Final </td><td><a class="el" href="classcice__cap__mod.html#a13ed49c66663b20170eb3da81fb23c39">CICE_Model_Finalize</a> </td><td>Cleans up by calling CICE_Finalize </td></tr>
</table>
<h1><a class="anchor" id="UnderlyingModelInterfaces"></a>
Underlying Model Interfaces</h1>
<p>The following diagram shows a diagram of how the CICE cap code is structured. Red boxes are subroutines that are registered with NUOPC. Light blue boxes are calls into CICE subroutines. Yellow boxes are calls into the ESMF/NUOPC library.</p>
<div class="image">
<img src="CICE_CAP_Methods_small.png" alt="CICE_CAP_Methods_small.png"/>
<div class="caption">
A high level view of the code organization of the CICE cap</div></div>
 <h2><a class="anchor" id="DomainCreation"></a>
Domain Creation</h2>
<p>As outlined in section 4.2 of the <a href="http://oceans11.lanl.gov/trac/CICE/attachment/wiki/WikiStart/cicedoc.pdf?format=raw">CICE user's guide</a>, the CICE model supports several kinds of grids: regular rectangular, regional, displaced_pole, and tripolar. The CICE cap currently only supports the tripolar grid with a single southern pole and a bipole in northern latitudes. The plots below show the latitude and longitude coordinate values (radians) for a 0.5 degree (720x410 cells) tripolar grid.</p>
<table  border="0">
<tr>
<td><div class="image">
<img src="cice_grid_ulat.png" alt="cice_grid_ulat.png"/>
<div class="caption">
Latitude coordinates of tripolar grid</div></div>
 </td><td><div class="image">
<img src="cice_grid_ulon.png" alt="cice_grid_ulon.png"/>
<div class="caption">
Longitude coordinates of tripolar grid</div></div>
 </td></tr>
</table>
<p>No changes were made to the native CICE mechanisms for setting up the grid. This procedure happens as part of the call to <code>CICE_Initialize()</code>. After CICE sets up its grid, the grid structure is translated into an <code>ESMF_Grid</code> object. Setting up the <code>ESMF_Grid</code> is handled as part of the <a class="el" href="classcice__cap__mod.html#a420af7f5b5ce7bc7a11b236b08438511">InitializeRealize</a> subroutine. All of the details of the tripolar grid must be provided to ESMF, including:</p>
<ul>
<li>the global number of cells in the X and Y directions,</li>
<li>how the global grid is decomposed into blocks,</li>
<li>the connectivity along the southern and northern rows (to set up the northern bipole),</li>
<li>the periodic boundary condition in the X direction,</li>
<li>the center (called "T cell" in the CICE manual) and corner coordinates ("U cell") for all grid points,</li>
<li>the grid cell areas, and</li>
<li>the grid cell land/sea mask.</li>
</ul>
<p>CICE already has data structures to represent all of these grid features. However, NUOPC infrastrucuture requires a standard representation of grids using ESMF types. Since the tripolar grid is a logically rectangular grid (there is an underlying X-Y index space), the <a href="http://www.earthsystemmodeling.org/esmf_releases/public/last/ESMF_refdoc/node5.html#SECTION05080000000000000000">ESMF_Grid</a> type is used. Setting up the <code>ESMF_Grid</code> requires accessing some of the ice domain variables inside CICE. Refer to the "use" statements at the top of the cap (listed below) to see which domain variables are accessed by the cap.</p>
<div class="fragment"><div class="line"><span class="keywordtype">use </span>ice_blocks<span class="keywordtype">, only</span>: nx_block, ny_block, nblocks_tot, block, get_block, &amp;</div>
<div class="line">                      get_block_parameter</div>
<div class="line"><span class="keywordtype">use </span>ice_domain_size<span class="keywordtype">, only</span>: max_blocks, nx_global, ny_global</div>
<div class="line"><span class="keywordtype">use </span>ice_domain<span class="keywordtype">, only</span>: nblocks, blocks_ice, distrb_info</div>
<div class="line"><span class="keywordtype">use </span>ice_distribution<span class="keywordtype">, only</span>: ice_distributiongetblockloc</div>
<div class="line"><span class="keywordtype">use </span>ice_constants<span class="keywordtype">, only</span>: tffresh, rad_to_deg</div>
<div class="line"><span class="keywordtype">use </span>ice_calendar<span class="keywordtype">,  only</span>: dt</div>
<div class="line"><span class="keywordtype">use </span>ice_flux</div>
<div class="line"><span class="keywordtype">use </span>ice_grid<span class="keywordtype">, only</span>: tlat, tlon, ulat, ulon, hm, tarea, anglet, angle, &amp;</div>
<div class="line">                    dxt, dyt, t2ugrid_vector</div>
<div class="line"><span class="keywordtype">use </span>ice_state</div>
<div class="line"><span class="keywordtype">use </span>cice_runmod</div>
<div class="line"><span class="keywordtype">use </span>cice_initmod</div>
<div class="line"><span class="keywordtype">use </span>cice_finalmod  </div>
</div><!-- fragment --><p>The ESMF_Grid is set up in several steps inside <a class="el" href="classcice__cap__mod.html#a420af7f5b5ce7bc7a11b236b08438511">InitializeRealize</a>. The <code>deBlockList</code> variables is used to store the min and max indices of each decomposition block. This is populated using index values from the CICE subroutine <code>get_block_parameters()</code>. The <code>petMap</code> array is used to store, for each block, the processor that is assigned to that block. This information is retrieved by calling the CICE subroutine <code>ice_distributionGetBlockLoc()</code>. The <code>petMap</code> is then used to create an <a href="http://www.earthsystemmodeling.org/esmf_releases/public/last/ESMF_refdoc/node6.html#SECTION060110000000000000000">ESMF_DELayout</a>, which describes how decomposition elements (blocks in CICE terms) are assigned to PETs (processors).</p>
<p>The global CICE grid index space (<code>nx_global</code> x <code>ny_global</code>) is set up as an <a href="http://www.earthsystemmodeling.org/esmf_releases/last_built/ESMF_refdoc/node5.html#SECTION050120000000000000000">ESMF_DistGrid</a> by passing it the <code>deBlockList</code>, <code>delayout</code>, and a <code>connectionList</code> which defines the periodic boundary condition in the X direction and bipole at the top. Finally, the <code>ESMF_Grid</code> is created from the <code>ESMF_DistGrid</code>. The <code>ESMF_Grid</code> will use the index space defined by the <code>ESMF_DistGrid</code> and geographic coordinates are assigned to cell centers and corners. The center coordinates are populating using the CICE <code>TLON</code> and <code>TLAT</code> arrays and the corners using the <code>ULON</code> and <code>ULAT</code> arrays. Also assigned are the cell areas (using the <code>tarea</code> array) and the grid mask (using the <code>hm</code> array). Details of how the CICE grid is set up internally in the model is beyond the scope of this cap documentation, however the reader is refered to section 4.2 of the <a href="http://oceans11.lanl.gov/trac/CICE/attachment/wiki/WikiStart/cicedoc.pdf?format=raw">CICE user's guide</a> for more information.</p>
<h2><a class="anchor" id="Initialization"></a>
Initialization</h2>
<p>The CICE cap calls into the native <code>CICE_Initialize()</code> subroutine in the <a class="el" href="classcice__cap__mod.html#a6c072e6d9f3654ce41995de85aa02692">InitializeAdvertise</a> subroutine. The only parameter passed is the MPI communicator. The global MPI communicator is managed by ESMF and is retrieved from the current <code>ESMF_VM</code>.</p>
<h2><a class="anchor" id="Run"></a>
Run</h2>
<p>The CICE cap calls into the native <code>CICE_Run()</code> subroutine in the <a class="el" href="classcice__cap__mod.html#aba2a6b8bb1abbb72a532fd052dd72744">ModelAdvance_Slow</a> subroutine. The internal CICE timestepping loop has been disabled when using the NUOPC cap since the main driver loop is provided by the NUOPC infrastructure at a level above the CICE model. Therefore, a call into <code>CICE_Run()</code> will only advance the CICE model by a single time step.</p>
<p>Prior to calling <code>CICE_Run()</code> the cap copies fields from the import <code>ESMF_State</code> into the corresponding data arrays inside the model. The import state contains a set of fields brought in through the NUOPC coupling infrastructure. These native model arrays are defined in the file ice_flux.F90. After copying in the import state fields, the call is made to <code>CICE_Run()</code>. After the run, model fields are copied into the export <code>ESMF_State</code> so that NUOPC can transfer these fields to other models as required.</p>
<p>Per field diagnostic output can be produced at the end of each run phase as described in the <a class="el" href="index.html#IO">I/O section</a>.</p>
<h3><a class="anchor" id="VectorRotations"></a>
Vector Rotations</h3>
<p>Vector rotation is done for import and export 2D vector fields in the NUOPC cap. In CICE cap, this happens inside of <a class="el" href="classcice__cap__mod.html#aba2a6b8bb1abbb72a532fd052dd72744">ModelAdvance_Slow</a>. The vector fields are rotated from a regular lat-lon grid to the CICE grid before <code>CICE_Run</code> and then rotated back to regular lat-lon grid after <code>CICE_Run</code>. The effect of this is most obvious in the northern polar region where CICE operates on a tripolar grid. Results on the T cell are also transformed to the U cell through CICE internal method t2ugrid_vector.</p>
<p>The following assumptions are made during vector rotation:</p>
<ul>
<li>The components of the 2D vector fields line up with local lat-lon direction where north and east are the local positive directions. The components are defined at cell center for all the grids.</li>
<li>The rotation angles are positive when measured counter clockwise (CCW) from local lat-lon directions. This is the conventional defintion for the angular dimension in a polar coordinate system.</li>
</ul>
<p>As such, the imported vector field V must be rotated locally as the model component local coordinate system is rotated CCW from well-defined lat-lon directions. The CCW rotation matrix M is </p>
<pre class="fragment">cos \theta         sin \theta
-sin \theta        cos \theta
</pre><p>Rotated vector V' = M V</p>
<p>The transpose of this matrix corresponding to a CW coordinate system rotation is applied to the exported 2D vector fields before they are exported.</p>
<h2><a class="anchor" id="Finalization"></a>
Finalization</h2>
<p>To finalize the model, the CICE cap simple calls into the native <code>CICE_Finalize()</code> subroutine.</p>
<h1><a class="anchor" id="ModelFields"></a>
Model Fields</h1>
<p>The following tables list the import and export fields currently set up in the CICE cap.</p>
<h2><a class="anchor" id="ImportFields"></a>
Import Fields</h2>
<table class="doxtable">
<tr>
<th>Standard Name </th><th>Units </th><th>Model Variable </th><th>File </th><th>Description </th><th>Notes  </th></tr>
<tr>
<td>air_density_height_lowest </td><td>kg m-3 </td><td>rhoa </td><td>ice_flux.F90 </td><td>air density </td><td></td></tr>
<tr>
<td>freezing_melting_potential </td><td>W m-2 </td><td>frzmlt </td><td>ice_flux.F90 </td><td>freezing/melting potential </td><td></td></tr>
<tr>
<td>inst_height_lowest </td><td>m </td><td>zlvl </td><td>ice_flux.F90 </td><td>height of lowest level </td><td></td></tr>
<tr>
<td>inst_merid_wind_height_lowest </td><td>m-2 </td><td>vatm </td><td>ice_flux.F90 </td><td>wind v component </td><td><a class="el" href="index.html#VectorRotations">vector rotation applied</a> </td></tr>
<tr>
<td>inst_pres_height_lowest </td><td>Pa </td><td>(none) </td><td></td><td>pressure at lowest level </td><td>used to calculate potT (potential temperature) </td></tr>
<tr>
<td>inst_spec_humid_height_lowest </td><td>kg kg-1 </td><td>Qa </td><td>ice_flux.F90 </td><td>specific humidity </td><td></td></tr>
<tr>
<td>inst_temp_height_lowest </td><td>K </td><td>Tair </td><td>ice_flux.F90 </td><td>near surface air temperature </td><td></td></tr>
<tr>
<td>inst_zonal_wind_height_lowest </td><td>m-2 </td><td>uatm </td><td>ice_flux.F90 </td><td>wind u component </td><td><a class="el" href="index.html#VectorRotations">vector rotation applied</a> </td></tr>
<tr>
<td>mean_down_lw_flx </td><td>W m-2 </td><td>flw </td><td>ice_flux.F90 </td><td>downward longwave flux </td><td></td></tr>
<tr>
<td>mean_down_sw_vis_dir_flx </td><td>W m-2 </td><td>swvdr </td><td>ice_flux.F90 </td><td>downward shortwave visible direct flux </td><td></td></tr>
<tr>
<td>mean_down_sw_vis_dif_flx </td><td>W m-2 </td><td>swvdf </td><td>ice_flux.F90 </td><td>downward shortwave visible diffuse flux </td><td></td></tr>
<tr>
<td>mean_down_sw_ir_dir_flx </td><td>W m-2 </td><td>swidr </td><td>ice_flux.F90 </td><td>downward shortwave near infrared direct flux </td><td></td></tr>
<tr>
<td>mean_down_sw_ir_dif_flx </td><td>W m-2 </td><td>swidf </td><td>ice_flux.F90 </td><td>downward shortwave near infrared diffuse flux </td><td></td></tr>
<tr>
<td>mean_fprec_rate </td><td>kg m-2 s-1 </td><td>fsnow </td><td>ice_flux.F90 </td><td>snowfall rate </td><td></td></tr>
<tr>
<td>mean_prec_rate </td><td>kg m-2 s-1 </td><td>frain </td><td>ice_flux.F90 </td><td>rainfall rate </td><td></td></tr>
<tr>
<td>(none) </td><td>W m-2 </td><td>fsw </td><td>ice_flux.F90 </td><td>downward shortwave flux </td><td>cap sets fsw as sum of shortwave components </td></tr>
<tr>
<td>ocn_current_merid </td><td>m-2 </td><td>vocn </td><td>ice_flux.F90 </td><td>ocean current v component </td><td><a class="el" href="index.html#VectorRotations">vector rotation applied</a> </td></tr>
<tr>
<td>ocn_current_zonal </td><td>m-2 </td><td>uocn </td><td>ice_flux.F90 </td><td>ocean current u component </td><td><a class="el" href="index.html#VectorRotations">vector rotation applied</a> </td></tr>
<tr>
<td>sea_surface_temperature </td><td>C </td><td>sst </td><td>ice_flux.F90 </td><td>sea surface temperature </td><td>converted from Kelvin to Celcius </td></tr>
<tr>
<td>s_surf </td><td>ppt </td><td>sss </td><td>ice_flux.F90 </td><td>sea surface salinity </td><td></td></tr>
<tr>
<td>sea_lev </td><td>m m-1 </td><td>ss_tltx, sstlty </td><td>ice_flux.F90 </td><td>sea surface slope in x &amp; y </td><td>sea_lev used to compute slope components, then <a class="el" href="index.html#VectorRotations">vector rotation applied</a>, then <code>t2ugrid_vectors()</code> called to move slope components to U grid </td></tr>
</table>
<p>These fields are advertised as imports but not currently used by the cap:</p>
<ul>
<li>inst_surface_height</li>
<li>inst_temp_height2m</li>
<li>inst_spec_humid_height2m</li>
<li>mean_merid_moment_flx</li>
<li>mean_zonal_moment_flx</li>
<li>mixed_layer_depth</li>
<li>sea_surface_slope_zonal</li>
<li>sea_surface_slope_merid</li>
</ul>
<h2><a class="anchor" id="ExportField"></a>
Export Fields</h2>
<table class="doxtable">
<tr>
<th>Standard Name </th><th>Units </th><th>Model Variable </th><th>File </th><th>Description </th><th>Notes  </th></tr>
<tr>
<td>ice_fraction </td><td>1 </td><td>aice </td><td>ice_state.F90 </td><td>concentration of ice </td><td></td></tr>
<tr>
<td>ice_mask </td><td></td><td>hm </td><td>ice_grid.F90 </td><td>ice mask </td><td>0.0 indicates land cell and 1.0 indicates ocean cell </td></tr>
<tr>
<td>inst_ice_ir_dif_albedo </td><td>1 </td><td>alidf </td><td>ice_flux.F90 </td><td>near infrared diffuse albedo </td><td></td></tr>
<tr>
<td>inst_ice_ir_dir_albedo </td><td>1 </td><td>alidr </td><td>ice_flux.F90 </td><td>near infrared direct albedo </td><td></td></tr>
<tr>
<td>inst_ice_vis_dif_albedo </td><td>1 </td><td>alvdf </td><td>ice_flux.F90 </td><td>visible diffuse albedo </td><td></td></tr>
<tr>
<td>inst_ice_vis_dir_albedo </td><td>1 </td><td>advdr </td><td>ice_flux.F90 </td><td>visible direct albedo </td><td></td></tr>
<tr>
<td>mean_evap_rate_atm_into_ice </td><td>kg m-2 s-1 </td><td>evap </td><td>ice_flux.F90 </td><td>evaporative water flux </td><td></td></tr>
<tr>
<td>mean_fresh_water_to_ocean_rate </td><td>kg m-2 s-1 </td><td>fresh </td><td>ice_flux.F90 </td><td>fresh water flux to ocean </td><td></td></tr>
<tr>
<td>mean_ice_volume </td><td>m </td><td>vice </td><td>ice_state.F90 </td><td>volume of ice per unit area </td><td></td></tr>
<tr>
<td>mean_laten_heat_flx_atm_into_ice </td><td>W m-2 </td><td>flat </td><td>ice_flux.F90 </td><td>latent heat flux </td><td></td></tr>
<tr>
<td>mean_net_sw_ir_dif_flx </td><td>W m-2 </td><td>fswthruidf </td><td>ice_flux.F90 </td><td>near infrared diffuse shortwave penetrating to ocean </td><td></td></tr>
<tr>
<td>mean_net_sw_ir_dir_flx </td><td>W m-2 </td><td>fswthruidr </td><td>ice_flux.F90 </td><td>near infrared direct shortwave penetrating to ocean </td><td></td></tr>
<tr>
<td>mean_net_sw_vis_dif_flx </td><td>W m-2 </td><td>fswthruvdf </td><td>ice_flux.F90 </td><td>visible diffuse shortwave penetrating to ocean </td><td></td></tr>
<tr>
<td>mean_net_sw_vis_dir_flx </td><td>W m-2 </td><td>fswthruvdr </td><td>ice_flux.F90 </td><td>visible direct shortwave penetrating to ocean </td><td></td></tr>
<tr>
<td>mean_salt_rate </td><td>kg m-2 s-1 </td><td>fsalt </td><td>ice_flux.F90 </td><td>salt flux to ocean </td><td></td></tr>
<tr>
<td>mean_sensi_heat_flx_atm_into_ice </td><td>W m-2 </td><td>fsens </td><td>ice_flux.F90 </td><td>sensible heat flux </td><td></td></tr>
<tr>
<td>mean_snow_volume </td><td>m </td><td>vsno </td><td>ice_state.F90 </td><td>volume of snow per unit area </td><td></td></tr>
<tr>
<td>mean_sw_pen_to_ocn </td><td>W m-2 </td><td>fswthru </td><td>ice_flux.F90 </td><td>shortwave penetrating to ocean </td><td></td></tr>
<tr>
<td>mean_up_lw_flx_ice </td><td>W m-2 </td><td>flwout </td><td>ice_flux.F90 </td><td>outgoing longwave radiation </td><td>average over ice fraction only </td></tr>
<tr>
<td>net_heat_flx_to_ocn </td><td>W m-2 </td><td>fhocn </td><td>ice_flux.F90 </td><td>net heat flux to ocean </td><td></td></tr>
<tr>
<td>sea_ice_temperature </td><td>K </td><td>trcr </td><td>ice_state.F90 </td><td>surface temperature of ice/snow </td><td>Celcius converted to Kelvin for export </td></tr>
<tr>
<td>stress_on_air_ice_merid </td><td>N m-2 </td><td>strairyT </td><td>ice_flux.F90 </td><td>y component of stress on ice by air </td><td><a class="el" href="index.html#VectorRotations">vector rotation applied</a> </td></tr>
<tr>
<td>stress_on_air_ice_zonal </td><td>N m-2 </td><td>strairxT </td><td>ice_flux.F90 </td><td>x component of stress on ice by air </td><td><a class="el" href="index.html#VectorRotations">vector rotation applied</a> </td></tr>
<tr>
<td>stress_on_ocn_ice_merid </td><td>N m-2 </td><td>strocnyT </td><td>ice_flux.F90 </td><td>y component of stress on ice by ocean </td><td><a class="el" href="index.html#VectorRotations">vector rotation applied</a> </td></tr>
<tr>
<td>stress_on_ocn_ice_zonal </td><td>N m-2 </td><td>strocnxT </td><td>ice_flux.F90 </td><td>x component of stress on ice by ocean </td><td><a class="el" href="index.html#VectorRotations">vector rotation applied</a> </td></tr>
</table>
<h2><a class="anchor" id="MemoryManagement"></a>
Memory Management</h2>
<p>For coupling fields, the CICE cap has the capability to either reference the internal CICE data arrays directly, or to allow ESMF to allocate separate memory for the coupling fields. Currently, the CICE cap is set up not to reference internal data arrays directly. During the <a class="el" href="classcice__cap__mod.html#aba2a6b8bb1abbb72a532fd052dd72744">ModelAdvance_Slow</a> phase, fields are copied from the import state into CICE internal data arrays. After the model integration timestep completes, internal data arrays are copied into the export state so they can be transferred for coupling.</p>
<h2><a class="anchor" id="IO"></a>
I/O</h2>
<p>The CICE cap implements a subroutine called <code>dumpCICEInternal</code> that writes the fields from ice_flux.F90 to NetCDF files. This is an optional diagnostic subroutine that allows the modeler to check the value of the fields and have a better idea of the state of CICE at each coupling time interval. This is useful to determine the impact of import and export Field connections made on the CICE model. Writing out of these fields during the run phase is controlled by the ESMF Attribute "DumpFields." This is read in during <a class="el" href="classcice__cap__mod.html#a6fff367383a101a74328ed28fb81af3f">InitializeP0</a>.</p>
<h1><a class="anchor" id="BuildingAndInstalling"></a>
Building and Installing</h1>
<p>Of the two independent makefiles, makefile.nuopc links in the ESMF/NUOPC library and LANL CICE library from external environment variables inherited from an external build system to create liblanl_cice.a; makefile is a generic makefile that allows liblanl_cice.a to be built with user customizable settings. The build system should pass pre-defined LANL CICE library and include path and INSTALLDIR settings into makefile.nuopc. Upon completion, liblanl_cice.a and cice_cap.mod will be copied to the INSTALLDIR and can be linked into a coupled application with other components.</p>
<h2><a class="anchor" id="Dependencies"></a>
Dependencies</h2>
<p>The CICE cap is only dependent on the CICE model itself, liblanl_cice.a.</p>
<h1><a class="anchor" id="RuntimeConfiguration"></a>
Runtime Configuration</h1>
<p>CICE cap accepts two runtime configuration parameters (DumpFields and ProfileMemory) though component level ESMF Attribute settings. By default, DumpFields is true. When turned on to true, diagnose NetCDF files of incoming and outgoing fields will be written. By default, ProfileMemory is true. When turned on to true, run time memory profiling information will be written to ESMF log files.</p>
<h1><a class="anchor" id="Repository"></a>
Repository</h1>
<p>The CICE NUOPC cap is maintained in a GitHub repository: <a href="https://github.com/feiliuesmf/lanl_cice_cap">https://github.com/feiliuesmf/lanl_cice_cap</a></p>
<h1><a class="anchor" id="References"></a>
References</h1>
<ul>
<li><a href="http://oceans11.lanl.gov/trac/CICE">Los Alamos CICE Home Page</a></li>
<li><a href="http://oceans11.lanl.gov/trac/CICE/attachment/wiki/WikiStart/cicedoc.pdf?format=raw">CICE User's Guide</a> </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
